<!doctype html>
<html lang="tr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zinciri Kırma Metodolojisi</title>

  <style id="base-theme-style">
    :root {
      /* tablonun hücre boyutu, tüm 'halkalar' buradan referans alır */
      --cell-size: 80px;
      /* 6 adet input ve gaplar, bu değeri kendine göre oranlar */
      --input-width: 480px;
      /* tablo çizgisi genel ayar */
      --chain-border: 1.5px solid var(--chain-border-color);
      --year-break-border: 3px double var(--year-break-bd-color);
      --month-break-border: 2px dashed var(--month-break-bd-color);
      /* tablo çizgisi rengi - tema paneli için ayrı tanımlandı */
      --chain-border-color: rgb(0, 0, 0);
      /* zincir kartı ve açık sekme stili */
      --chain-month-label: rgb(0, 0, 0);
      /* zincir kartı ve açık sekme stili */
      --chain-month-label-bg: rgb(150, 150, 180);
      /* ay geçişlerinde, geçiş çizgisi rengi */
      --month-break-bd-color: rgb(24, 8, 95);
      /* yıl geçişlerinde, geçiş çizgisi rengi */
      --year-break-bd-color: rgb(224, 16, 16);
      --app-card-bg: rgba(60,210,30, 0.575);
      --app-card-bd: rgba(10,29,2, 0.644);
      /* zincir kartı scrollbarı */
      --app-card-thumb: rgba(10,61,10, 0.603);
      /* track transparent yapılmıştır, isteğe bağlı etkinleştirilebilir */
      --app-card-track: rgba(0, 0, 0, 0);
      /* butonların hover veya active efektleri  */
      --btn-view-effect: rgba(127,67,10, 0.5);
      --btn-color-settings-effect: rgba(201, 84, 201, 0.5);
      --btn-add-chain-effect: rgba(102,102,102, 0.5);
      --btn-load-file-effect: rgba(138, 183, 224, 0.5);
      --btn-backup-download-effect: rgba(110, 204, 102, 0.5);
      --btn-reset-effect: rgba(236, 255, 61, 0.5);
      --btn-delete-effect: rgba(243, 68,68, 0.5);
      /* butonların genel arkplanı */
      --button-background: rgb(255, 255, 255);
      /* zincir svgsi ve diğer arkaplan ikonları */
      --background-icons: rgba(0, 0, 0, 0.2);
      /* en dış katman ve scrollbarlar */
      --outer-layer-bg: rgb(180,180,180);
      --outer-scroll-track: rgba(128, 154, 177, 0.7);
      --outer-scroll-thumb: rgb(111, 114, 100);
    }

    * {
      box-sizing: border-box;
    }

    /* sayfa genel scrollu. */
    html {
      scrollbar-width: auto;
      scrollbar-color: var(--outer-scroll-thumb) var(--outer-scroll-track);
    }

    body {
      background-color: var(--outer-layer-bg);
      margin: 0;
      padding: 0 12px;
    }

    /* ZİNCİR KISMI İLE İLGİLİ GENEL AYARLAR*/

    .x-mark {
      stroke: rgba(214, 5, 5, 0.85);
      stroke-width: 7px;
      position: absolute;
      pointer-events: none;
      width: 115%;
      height: 115%;
      top: -7%;
      left: -7%;
    }

    /* ilk hücre */
    .chain tr:first-child>th:first-child {
      background-color: transparent;
      border: 0;
      color: rgb(13, 94, 30);
    }

    /* satır başlıkları */
    .chain tr:not(:first-child)>th:first-child {
      width: calc(var(--cell-size)*0.75);
      white-space: wrap;
      background-color: var(--chain-month-label-bg);
      color: var(--chain-month-label);
      padding: 0 4px;
      /* çok fazla ay adı içeren başlıklar yüzünden sabit yükseklik artabilir. */
      /* white-space: nowrap yapılarak ve line-height sıfırlanarak önüne geçilebilir*/
    }

    /* sütun başlıkları */
    .chain tr:first-child>th:not(:first-child) {
      height: calc(var(--cell-size) * 0.5);
      /* başlık satırı normal bir hücrenin %50 yüksekliğinde ayarlanmıştır */
      background-color: rgb(180, 150, 150);
      color: rgb(0, 0, 0);
      padding: 4px 0;
    }

    /* veri içeren halkalar için ortak çatı */
    /* normal kareli tablo + çemberli yılan görünüm modu */
    .chain td,
    .circle-cell {
      background-color: rgb(255, 255, 255);
      color: rgb(5, 5, 5);
      border: var(--chain-border);
      position: relative;
      cursor: pointer;
      user-select: none;
    }

    .chain td.empty-cell {
      background-color: rgb(127, 127, 127);
      cursor: default;
    }

    /* ANA FORUM KARTI */
    /* GİRDİ VE AYARLARIN GENEL STİLİ */

    .main-title {
      color: rgb(230, 4, 4);
      font-size: 32px;
      font-weight: 700;
      font-family: 'Pacifico', cursive;
    }

    hr {
      border-color: rgb(126, 173, 170);
      width: 100vw;
      margin-left: calc(50% - 50vw);
    }

    .form-titles {
      color: rgb(45, 15, 82);
      font-weight: 700;
      font-size: 18px;
      text-shadow: 0 0 1px;
      font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
      display: inline-flex;
      flex-direction: column;
      gap: 8px;
    }

    .selections label {
      border: 1px solid rgb(75, 53, 67);
      color: rgb(0, 0, 0);
      border-radius: 14px;
      padding: 6px 12px;
    }

    input {
      background-color: rgb(255, 255, 255);
      border: 2px solid rgb(0, 0, 0);
      border-radius: 6px;
      padding: 8px;
      font-size: 14px;
    }

    input:focus, input:focus-visible {
      outline: 2px solid rgb(140, 255, 155);
    }

    .input-error {
      outline: 3px solid rgb(223, 73, 73);
    }

    input[type="radio"],
    input[type="checkbox"] {
      position: absolute;
      opacity: 0;
      /* modern tarz*/
    }

    label:has(input:checked) {
      border-style: inset;
      border-width: 2px;
      border-radius: 4px;
    }

    .radio-type label:has(input:checked) {
      background-color: rgba(107, 189, 221, 0.5);
      color: rgb(255, 255, 255);
    }

    #weekdays label:has(input:checked) {
      background-color: rgba(0, 200, 0, 0.5);
      color: rgb(255, 255, 255);
    }

    .helper-info {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 16px;
      font-weight: 600;
      color: rgb(15,15,0);
      text-shadow: 0 0 0;
    }

    .pad12 {
      padding: 12px !important;
      /* dekoratif spacer çemberler çapı */
    }

    .size-box>* {
      border: 1px solid rgb(75, 53, 67);
      border-radius: 16px;
      padding: 8px;
    }

    /* DOSYA İŞLEM BUTONLARI BU GENEL STİLİ KULLANIR */
    button {
      border: outset rgb(0, 0, 0);
      border-width: 0 5px 5px 0;
      border-radius: 0 5px;
      background-color: var(--button-background);
      padding: 8px 12px;
      cursor: pointer;
      font-size: 16px;
      gap: 4px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .error-info {
      color: rgb(204, 0, 0);
      background-color: rgb(223, 223, 113);
      border: 1px solid rgb(204, 0, 0);
      font-size: 16px;
      font-weight: 700;
      position: absolute;
      padding: 4px;
    }

    /* GENEL LAYOUT, Mimari */
    /* Element oluşum sırası */
    .main-frame {
      background-color: rgba(124, 172, 162, 0.734);
      border: outset rgba(92, 149, 173, 0.62);
      border-width: 0 16px 16px 0;
      border-radius: 4px 16px;
      padding: 0 48px 8px;
      position: relative;
      overflow: hidden;
      z-index: 0;
    }

    /* arka plan soluk zincir görseli */
    .chain-bg {
      fill: var(--background-icons);
      opacity: 0.5;
      width: 100%;
      height: 100%;
      position: absolute;
      z-index: -1;
      inset: 0;
      /* kullanım esnekliği için svg'den değerler çekilmiştir */
    }

    /* toggle buton ile görsel kirlilik azaltılır, kullanım kolaylaşır */
    .main-frame.collapsed>* {
      display: none;
    }

    .main-frame.collapsed>.head-box,
    .head-box {
      display: flex;
    }

    .description-part {
      display: flex;
      flex: 1;
      justify-content: flex-end;
      align-items: flex-end;
      gap: 8px;
      text-wrap: nowrap;
    }

    .question-mark {
      font-size: 16px;
      text-decoration-line: none;
      color: var(--background-icons);
      /* a elementinden gelen çizgi silinir */
    }

    .visual-buttons {
      display: flex;
      flex: 3;
      justify-content: space-between;
      align-items: center;
      padding: 8px 8px 0;
    }

    div.form-titles {
      margin-bottom: 24px;
    }

    .selections {
      display: inline-flex;
      flex-wrap: wrap;
      align-items: center;
      font-size: 17px;
      font-weight: normal;
      font-family: 'Times New Roman', Times, serif;
      width: fit-content;
      height: fit-content;
    }

    .basic-box {
      display: inline-flex;
      flex-wrap: wrap;
      column-gap: calc(var(--input-width)*0.2);
      row-gap: 24px;
      margin-bottom: 24px;
    }

    /* şuanlık sadece input text yani zincir adını etkiliyor */
    ::placeholder {
      color: initial;
    }

    #chain-name {
      width: calc(var(--input-width)*0.8);
    }

    #ring-count-input {
      width: calc(var(--input-width) * 0.25);
    }

    .date-together {
      display: inline-flex;
      column-gap: calc(var(--input-width)*0.2);
    }

    #start-date,
    #end-date {
      width: calc(var(--input-width) * 0.3);
    }

    .ring-number-box {
      background-color: rgba(207, 75, 190, 0.34);
      border: 2px groove rgba(182, 89, 146, 0.62);
      border-radius: 32px;
      display: flex;
      flex-wrap: wrap;
      padding: 8px 16px;
      gap: 16px;
      align-items: center;
      justify-content: center;
      width: fit-content;
      margin: 24px auto;
    }

    .text-total-ring {
      color: rgb(93, 38, 9);
      font-size: 28px;
    }

    #show-count {
      color: rgb(206, 238, 47);
      font-family: Verdana, Geneva, Tahoma, sans-serif;
      font-size: 28px;
      font-weight: 600;
      text-shadow: 0 0 16px;
    }

    .parenthesis {
      font-size: 20px;
      color: rgb(153, 0, 148);
    }

    .size-box {
      display: inline-flex;
      flex-wrap: wrap;
      align-items: center;
    }

    #rows-input,
    #cols-input {
      width: calc(var(--input-width) * 0.2);
    }

    .button-box {
      display: flex;
      width: 100%;
      justify-content: space-between;
      margin-top: 32px;
    }

    #backup-error {
      bottom: 48px;
    }

    .about-me {
      position: absolute;
      margin-top: 4px;
      color: var(--background-icons);
      font-size: 28px;
      z-index: -1;
      right: 40%;
    }

    .tab-box {
      display: flex;
      flex-wrap: wrap-reverse;
      /* oluşturulan sonraki sekmeler, yukarıda birikir */
      margin-top: 8px;
    }

    .chain-tab {
      padding: 6px 12px;
      background-color: rgba(0, 0, 0, 0);
      /* renklerini body background'dan alır, aynı şekilde hover efektini de */
      border: 2px solid rgba(0, 0, 0, 0.6);
      border-bottom: none;
      border-radius: 9px;
      font-size: 14px;
      color: rgb(56, 40, 19);
    }

    .chain-tab:hover {
      background-color: rgba(0, 0, 0, 0.2);
    }

    /* hoverdan sonra tanımlanması daha iyi olur .active */
    .chain-tab.active {
      background-color: var(--app-card-bg);
      border: 2px ridge var(--app-card-bd);
      border-bottom: transparent;
      font-weight: 700;
      border-radius: 6px 6px 0 0;
    }

    .chain {
      background-color: var(--app-card-bg);
      border: 8px ridge var(--app-card-bd);
      padding: 20px 4px;
      align-items: center;
    }

    .chain-head {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: nowrap;
      padding: 0 16px;
      margin-bottom: 16px;
    }

    /* child elementler istenen şekilde, satır başı yapar ya da aynı satırda kalır */
    .chain-head>div:first-child {
      flex: 1 1 auto;
      min-width: 0;
    }

    /* ekstra responsive ayarından tasarruf sağlar, bu ayar küçük ekranlara dönüktür */
    .chain-head>div:last-child {
      flex: 0 0 auto;
    }

    .chain-title {
      font-weight: 800;
      font-size: 21px;
      color: rgb(11, 7, 80);
      margin: 0 0 8px 32px;
      overflow-wrap: break-word;
      /* çok uzun kelimeler taşmaz, scroll-barı engeller güvenlik amaçlı */
    }

    .chain-info {
      color: rgb(39, 80, 114);
      font-size: 18px;
    }

    .table-container {
      display: flex;
      flex-direction: column;
      max-width: 100%;
      padding: 0 20px;
      font-family: "Inter", "Segoe UI", "Roboto", sans-serif;
    }

    .grid-wrap,
    .grid-scroll-bottom {
      overflow-y: hidden;
      max-width: 100%;
      overflow-x: auto;
      scrollbar-color: var(--app-card-thumb) var(--app-card-track);
    }

    .grid-scroll-inner {
      height: 1px;
    }

    .chain table {
      border-collapse: collapse;
      width: max-content;
      table-layout: fixed;
    }

    /* genel başlık düzeni */
    .chain th {
      border: var(--chain-border);
      line-height: 1.6;
      text-align: center;
      vertical-align: middle;
      font-size: 14px;
      overflow: hidden;
    }

    /* veri hücreleri */
    .chain td {
      width: var(--cell-size);
      height: var(--cell-size);
      vertical-align: center;
      /* üst */
      text-align: center;
      /* sol */
      font-size: 28px;
    }

    td.month-break-left {
      border-left: var(--month-break-border);
    }

    td.month-break-right {
      border-right: var(--month-break-border);
    }

    td.year-break-left {
      border-left: var(--year-break-border);
    }

    td.year-break-right {
      border-right: var(--year-break-border);
    }

    /* ------------------------------
       SNAKE (YILAN) GÖRÜNÜMÜ
       - Sadece görünüm düzenler: veri/iş mantığı aynı kalır
    ------------------------------ */
    .snake-container {
      --snake-gap: 0;
      /* halkalar arası boşluk */
      gap: var(--snake-gap);
      /* satırlar (row) arası boşluk */
      display: grid;
      padding: 0;
      /* düzenin konteynır ayarları buradan */
      margin: 0 auto;
    }

    .snake-row {
      display: flex;
      /* yatay boşluk (kolonlar arası - row) boşluğu */
      gap: var(--snake-gap);
      flex-wrap: nowrap;
    }

    .circle-cell {
      width: calc(var(--cell-size)*1.25);
      /* kare ve daire alan farkı kapatılır ~= 4/π */
      height: calc(var(--cell-size)*1.25);
      /* boyut değişimi hassastır, scriptle de paralel olmalıdır */
      border-radius: 50%;
      font-size: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* YILAN MODU: Ay etiketi */
    .month-label {
      position: absolute;
      white-space: nowrap;
      display: inline-block;
      font-weight: 700;
      color: var(--chain-month-label);
      background-color: var(--chain-month-label-bg);
      border: var(--chain-border);
      border-radius: 7px;
      width: max-content;
      padding: 6px;
      pointer-events: none;
      user-select: none;
      transform: translateX(-100%) rotate(270deg);
      /* yazı bitiş ucu */
      transform-origin: 100% 0%;
      left: 35%;
      top: 106%;
      font-size: 14px;
    }

    /* X işareti dairenin içine otursun */
    .circle-cell .x-mark {
      top: 0;
      left: 0;
      /* boyut ayarlaması eklenebilir */
      width: auto;
      height: auto;
    }

    /* TEMA ÜRETME / RENK AYARLAMA PANELİ */
    /* KAPSAMLI TABLO */
    #theme-panel {
      position: fixed;
      right: 2.5%;
      top: 7.5%;
      background-color: rgb(0, 0, 0);
      box-shadow: 0 0 0 4px rgba(184, 178, 202, 0.6);
      border-radius: 10px;
      /* width: max-content; */
      min-height: 300px;
      height: 480px;
      max-height: calc(100vh - 24px);
      display: none;
      /* sadece dikey resize */
      overflow: hidden;
      resize: vertical;
      font-family: Arial, Helvetica, sans-serif;
    }

    #theme-panel.is-open {
      display: flex;
      flex-direction: column;
    }

    #theme-panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    #theme-panel-draggable {
      user-select: none;
      cursor: move;
      touch-action: none;
      /* mobilde sürükleme için kritik */
      display: flex;
      flex: auto;
      padding: 8px 24px;
      align-items: center;
      justify-content: space-between;
    }

    #theme-panel-header .close {
      display: flex;
      width: max-content;
      padding: 8px;
    }

    #btn-theme-close {
      color: rgb(255, 0, 0);
      background-color: rgb(0, 0, 0);
      border: 2px solid rgb(255, 0, 0);
      font-weight: bolder;
      opacity: 0.7;
      border-radius: 50%;
      padding: 6px;
      width: calc(var(--cell-size)/3);
      height: calc(var(--cell-size)/3);
    }

    #theme-panel-header .title {
      font-weight: 600;
      color: rgb(212, 71, 212);
      font-size: 16px;
      text-shadow: 3px 3px 6px;
    }

    #theme-panel-header .hint {
      color: rgb(168, 157, 37);
      font-size: 12px;
    }

    /* THEME PRESET BAR (inline temalar burada) */
    #theme-panel-presets {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 0 16px 8px;
    }

    #theme-panel-presets .label {
      font-size: 16px;
      font-weight: 720;
      color: rgb(243, 245, 247);
    }

    #theme-preset-select {
      border-radius: 6px;
      padding: 8px 4px;
      font-size: 16px;
      background-color: rgb(0, 0, 0);
      color: rgb(236, 246, 255);
    }

    #btn-theme-apply-preset {
      color: rgb(255, 255, 255);
    }

    #theme-panel-body {
      overflow-y: auto;
      overflow-x: hidden;
      /* yatay scroll yok */
      scrollbar-color: rgba(255, 0, 0, 0.5) rgb(0, 0, 0);
      scrollbar-width: thick;
      padding-right: 4px;
    }

    #theme-panel table {
      max-width: min-content;
      margin: 4px;
      border: 2px solid rgb(196, 22, 22);
    }

    /* modern sticky başlık */
    #theme-panel thead th {
      color: rgba(245, 245, 220, 0.50);
      border: 1.5px solid rgb(196, 22, 22);
      border-top: 0;
      background-color: rgb(31, 3, 3, 0.8);
      padding: 12px;
      font-size: 16px;
      line-height: 1.6;
      position: sticky;
      z-index: 1;
      top: -2px;
      /* mobilde wrap açılsın */
      white-space: nowrap;
    }

    /* sabit label sütunu (ilk kolondaki tüm thler) */
    .col-label {
      text-align: left;
      white-space: nowrap;
    }

    /* etiketler, yani başlık kolonu */
    #theme-panel tbody th {
      border: 1px solid rgb(127, 127, 127);
      padding: 16px;
      font-size: 14px;
      color: rgb(245, 255, 219);
    }

    /* sadece input ve bilgi hücreleri */
    #theme-panel td {
      border: 1px solid rgb(127, 127, 127);
      text-shadow: 1px 1px 3px;
      text-align: center;
      padding: 12px;
      /* üsttekiler ortak, alttakiler sadece yazı için */
      color: rgb(212, 230, 245);
      font-size: 16px;
      font-weight: bolder;
    }

    #theme-panel td input {
      padding: 0;
      border: none;
      background-color: transparent;
      width: 32px;
      height: 24px;
    }

    /* tekli ara başlık (sub-title) td hücreleri */
    #theme-panel tr>td:first-child {
      background-color: rgb(32, 8, 8);
    }

    /* yine tekli td hücreleri ama override için ek class tanımlandı  */
    #theme-panel tr td.warning-info {
      font-size: 12px;
      font-weight: normal;
      text-shadow: 0 0 0;
      text-decoration: underline;
      text-align: left;
      line-height: 1.5;
      color: rgba(255, 255, 155, 0.685);
      letter-spacing: 0.1ch;
      background-color: transparent;
    }

    #theme-panel-footer {
      padding: 8px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    #theme-panel-footer .rightside {
      display: flex;
      gap: 16px;
    }

    #theme-panel button {
      padding: 8px 10px;
      border-radius: 8px;
      background-color: rgb(48, 45, 45);
      font-size: 14px;
      font-weight: 600;
      text-shadow: 0 0 16px;
    }

    #btn-theme-reset-all {
      color: rgb(247, 255, 156);
    }

    #btn-theme-cancel {
      color: rgb(209, 54, 54);
    }

    #btn-theme-ok {
      color: rgb(75, 255, 105);
    }

    /* BUTONLAR */

    #btn-toggle-menu {
      font-size: 16px;
      color: rgb(221, 29, 29);
      border: 2px ridge rgb(255, 38, 38);
      border-radius: 4px;
      width: 50px;
      height: 20px;
      background-color: transparent;
    }

    #btn-view {
      width: 52px;
      height: 28px;
      padding: 2px;
      border-radius: 99px;
      background-color: transparent;
      color: rgb(111, 54, 17);
      border: 3px ridge rgb(89, 38, 8);
      display: flex;
      align-items: center;
      text-align: center;
    }

    #btn-view .knob {
      width: 24px;
      height: 24px;
      display: grid;
      place-items: center;
      background-color: var(--button-background);
      border-radius: 50%;
      transform: translateX(-12px);
      transition: transform 0.3s ease;
    }

    #btn-view.alt .knob {
      transform: translateX(12px);
    }

    #btn-color-settings {
      color: var(--button-background);
      border: 4px ridge rgb(180, 24, 180);
      border-radius: 50%;
      padding: 6px;
      font-size: 16px;
      background-color: transparent;
    }

    #btn-load-file {
      color: rgb(38,39,103);
      border-color: rgb(69, 71, 187);
    }

    #btn-backup-download {
      color: rgb(41,94,5);
      border-color: rgb(78,178,10);
    }

    #btn-reset {
      color: rgb(171, 160, 0);
      border-color: rgb(255, 238, 0);
    }

    #btn-delete {
      color: rgb(171,24,24);
      border-color: rgb(255,36,36);
    }

    #btn-toggle-menu:active {
      background-color: var(--button-background);
    }

    #btn-view:active {
      background-color: var(--btn-view-effect);
    }

    #btn-color-settings:active {
      background-color: var(--btn-color-settings-effect);
    }

    #btn-add-chain:active {
      background-color: var(--btn-add-chain-effect);
      /* background defaultu rgba(0,0,0,0), opacity tema vermeyi engeller */
      /* tema değişikliği debug etmek içni ekstra (opacity 0'dan farklı) */
    }

    #btn-load-file:active {
      background-color: var(--btn-load-file-effect);
    }

    #btn-backup-download:active {
      background-color: var(--btn-backup-download-effect);
    }

    #btn-reset:active {
      background-color: var(--btn-reset-effect);
    }

    #btn-delete:active {
      background-color: var(--btn-delete-effect);
    }

    /* active efektleri dokunmatik cihazlarda kapatılan hover efektleri için */
    @media (hover: hover) {

      #btn-toggle-menu:hover {
        background-color: var(--button-background);
      }

      #btn-view:hover {
        background-color: var(--btn-view-effect);
      }

      #btn-color-settings:hover {
        background-color: var(--btn-color-settings-effect);
      }

      #btn-add-chain:hover {
        background-color: var(--btn-add-chain-effect);
      }

      #btn-load-file:hover {
        background-color: var(--btn-load-file-effect);
      }

      #btn-backup-download:hover {
        background-color: var(--btn-backup-download-effect);
      }

      #btn-reset:hover {
        background-color: var(--btn-reset-effect);
      }

      #btn-delete:hover {
        background-color: var(--btn-delete-effect);
      }

    }

    /* ========================================
   TABLET (max-width: 900px)
   - Tablet + küçük laptoplar
   - 900px ve altı cihazlar
======================================== */
    @media (max-width: 900px) {
      :root {
        --cell-size: 70px;
        --input-width: 400px;
      }

      /* arka plan svg resmi dikey döndürülüp, büyütülür */
      .chain-bg {
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(90deg);
        transform-origin: center center;
        width: 480vh;
        height: 100vw;
      }

      /* masaüstüne özel olan spacerlar, kaybolur*/
      .only-for-desktop {
        display: none;
      }

      /* dokunmatik cihazlarda üst scroll silinip daha temiz görüntü elde edilir */
      .grid-scroll-inner {
        height: 0;
      }

      .main-frame {
        border-width: 0 12px 12px 0;
        border-bottom-left-radius: 12px;
        padding: 8px 24px;
      }

      .question-mark {
        font-size: 14px;
      }

      .main-title {
        font-size: 28px;
      }

      .form-titles {
        gap: 6px;
        font-size: 16px;
      }

      .selections label {
        font-size: 15px;
      }

      input {
        padding: 6px;
        font-size: 12px;
      }

      .helper-info {
        font-size: 14px;
      }

      .text-total-ring {
        font-size: 20px;
      }

      #show-count {
        font-size: 22px;
      }

      .parenthesis {
        font-size: 18px;
      }

      button {
        padding: 6px 8px;
        font-size: 15px;
        gap: 3px;
      }

      #backup-error {
        bottom: 42px;
      }

      .about-me {
        font-size: 24px;
      }

      .chain-tab {
        padding: 5px 10px;
        font-size: 13px;
      }

      .chain-tab.active {
        border-radius: 5px 5px 0 0;
      }

      .chain {
        border-width: 8px;
      }

      .chain-head {
        padding: 0 14px;
      }

      .chain-title {
        font-size: 18px;
      }

      .chain-info {
        font-size: 16px;
      }

      .table-container {
        padding: 0 16px;
      }

      .chain th {
        font-size: 12px;
      }

      .chain tr:first-child>th:not(:first-child) {
        padding: 3px 0;
      }

      .chain tr:not(:first-child)>th:first-child {
        padding: 0 3px;
      }

      .chain td {
        font-size: 24px;
      }

      .circle-cell {
        font-size: 28px;
      }

      .circle-cell .month-label {
        font-size: 12px;
      }

      #btn-toggle-menu {
        font-size: 14px;
        width: 40px;
        height: 20px;
      }

      #btn-view {
        width: 54px;
        height: 28px;
      }

      #btn-view .knob {
        height: 22px;
        width: 22px;
        transform: translateX(-13px);
        font-size: 12px;
      }

      #btn-view.alt .knob {
        transform: translateX(13px);
      }

      #btn-color-settings {
        font-size: 14px;
        padding: 5px;
      }

      #theme-panel {
        min-height: 240px;
        height: 360px;
      }

      #theme-panel-draggable {
        padding: 8px 20px;
      }

      #btn-theme-close {
        padding: 5px;
      }

      #theme-panel-header .hint {
        font-size: 12px;
      }

      #theme-panel-presets {
        gap: 12px;
        padding: 0 12px 8px;
      }

      #theme-panel-presets .label {
        font-size: 14px;
      }

      #theme-preset-select {
        font-size: 14px;
        padding: 6px 3px;
      }

      #theme-panel thead th {
        padding: 10px;
        font-size: 14px;
        line-height: 1.4;
      }

      .col-label {
        white-space: wrap;
        /* width: fit-content; */
      }

      #theme-panel tbody th {
        padding: 12px;
        font-size: 12px;
      }

      #theme-panel td {
        font-size: 14px;
        padding: 10px;
      }

      #theme-panel tr td.warning-info {
        font-size: 10px;
      }

      #theme-panel-footer {
        padding: 8px 10px;
      }

      #theme-panel button {
        padding: 8px;
        font-size: 12px;
      }


    }

    /* ========================================
    MOBILE (max-width: 600px)
   - Telefonlar
   - 600px ve altı cihazlar
======================================== */
    @media (max-width:600px) {
      :root {
        --cell-size: 56px;
        --input-width: 320px;
      }

      body {
        padding: 2px;
      }

      button {
        flex-direction: column;
        /* buton dikeyleşir, ikon ve kelimeler satır-satır konumlanır */
        border-width: 0 3px 3px 0;
        border-radius: 0 3px;
        padding: 3px;
        font-weight: 500;
        font-size: 12px;
        gap: 2px;
      }

      /* panel sağ-üst ek bilgi kaybolur */
      #theme-panel-header .hint {
        display: none;
      }

      .main-frame {
        padding: 16px;
        border-width: 0 0 8px 0;
        /* sağ border silinip daha geniş alan elde edilir */
        border-radius: 0 8px;
      }

      .question-mark {
        font-size: 12px;
      }

      .main-title {
        font-size: 24px;
      }

      .visual-buttons {
        padding: 8px 4px 0;
      }

      .form-titles {
        font-size: 14px;
      }

      .selections label {
        padding: 6px 9px;
        font-size: 12px;
      }

      .date-together {
        column-gap: 57px;
      }

      input {
        font-size: 10px;
      }

      .error-info {
        padding: 3px;
        font-size: 12px;
      }

      .helper-info {
        font-size: 12px;
      }

      .ring-number-box {
        padding: 4px 8px;
        gap: 8px;
      }

      .text-total-ring {
        font-size: 18px;
      }

      #show-count {
        font-size: 20px;
      }

      .parenthesis {
        font-size: 16px;
      }

      #backup-error {
        bottom: 69px;
      }

      .about-me {
        font-size: 20px;
        right: 16px;
      }

      .chain-tab {
        padding: 4px 8px;
        font-size: 12px;
      }

      .chain {
        border-width: 6px;
        padding: 16px 4px;
      }

      .chain-head {
        padding: 0 12px;
      }

      .chain-title {
        font-size: 16px;
      }

      .chain-info {
        font-size: 14px;
      }

      .table-container {
        padding: 0 12px;
      }

      .chain th {
        font-size: 8px;
      }

      .chain tr:first-child>th:not(:first-child) {
        padding: 2px 0;
      }

      .chain tr:not(:first-child)>th:first-child {
        padding: 0 2px;
      }

      .chain td {
        font-size: 20px;
      }

      .circle-cell {
        font-size: 24px;
      }

      .circle-cell .month-label {
        font-size: 10px;
        padding: 3px;
        top: 100%;
      }

      #btn-toggle-menu {
        font-size: 12px;
        width: 32px;
        height: 16px;
      }

      #btn-view {
        width: 40px;
        height: 22px;
        padding: 1px;
      }

      #btn-view .knob {
        width: 16px;
        transform: translateX(-9px);
        font-size: 10px;
      }

      #btn-view.alt .knob {
        transform: translateX(9px);
      }

      #btn-color-settings {
        font-size: 12px;
        padding: 4px;
      }

      #theme-panel {
        min-height: 200px;
        height: 280px;
      }

      #theme-panel-draggable {
        padding: 8px;
        justify-content: center;
      }

      #btn-theme-close {
        padding: 4px;
        border-width: 1px;
      }

      #theme-panel-header .title {
        font-size: 14px;
        padding-left: 16px;
      }

      /* THEME PRESET BAR (inline temalar burada) */
      #theme-panel-presets {
        justify-content: center;
        padding: 0 0 8px;
        gap: 8px;
      }

      #theme-panel-presets .label {
        font-size: 12px;
      }

      #theme-preset-select {
        font-size: 12px;
        padding: 4px 2px;
      }

      #theme-panel table {
        border-width: 1px;
      }

      #theme-panel thead th {
        padding: 8px;
        font-size: 12px;
        line-height: 1.2;
        white-space: wrap;
      }

      #theme-panel tbody th {
        padding: 8px;
        font-size: 10px;
      }

      #theme-panel td {
        font-size: 12px;
        padding: 8px;
      }

      #theme-panel td input {
        width: 24px;
        height: 18px;
      }

      #theme-panel tr td.warning-info {
        font-size: 8px;
      }

      #theme-panel-footer {
        padding: 8px;
      }

      #theme-panel button {
        padding: 6px;
        font-size: 10px;
      }

    }

    /* ========================================
  MICRO-MOBILE (max-width: 300px)
   - Çok küçük ekranlar
   - 300px ve altı cihazlar
======================================== */
    @media (max-width:300px) {
      :root {
        --cell-size: 40px;
        --input-width: 240px;
      }

      .main-frame {
        padding: 8px;
        border-bottom-width: 4px;
      }

      .question-mark {
        font-size: 10px;
      }

      .main-title {
        font-size: 20px;
      }

      .form-titles {
        font-size: 12px;
        gap: 6px;
      }

      .selections label {
        font-size: 10px;
        padding: 4px 6px;
      }

      input {
        font-size: 8px;
      }

      .error-info {
        padding: 2px;
        font-size: 9px;
      }

      .helper-info {
        font-size: 10px;
      }

      .text-total-ring {
        font-size: 14px;
      }

      #show-count {
        font-size: 14px;
      }

      .parenthesis {
        font-size: 12px;
      }

      button {
        font-size: 9px;
        border-width: 0 2px 2px 0;
        border-radius: 0 2px;
        padding: 2px;
        gap: 1px;
      }

      #backup-error {
        bottom: 45px;
      }

      .about-me {
        font-size: 16px;
      }

      .chain-tab {
        padding: 3px 6px;
        font-size: 10px;
      }

      .chain {
        border-width: 4px;
      }

      .chain-head {
        padding: 0 8px;
      }

      .chain-title {
        font-size: 13px;
      }

      .chain-info {
        font-size: 12px;
      }

      .table-container {
        padding: 0 8px;
      }

      .chain th {
        font-size: 6px;
      }

      .chain tr:first-child>th:not(:first-child) {
        padding: 1px 0;
      }

      .chain tr:not(:first-child)>th:first-child {
        padding: 0 1px;
      }

      .chain td {
        font-size: 16px;
      }

      .circle-cell {
        font-size: 20px;
      }

      .circle-cell .month-label {
        font-size: 8px;
      }

      #btn-toggle-menu {
        font-size: 10px;
        width: 24px;
        height: 12px;
      }

      #btn-view {
        width: 28px;
        height: 16px;
      }

      #btn-view .knob {
        width: 10px;
        height: 10px;
        transform: translateX(-6px);
        font-size: 8px;
      }

      #btn-view.alt .knob {
        transform: translateX(6px);
      }

      #btn-color-settings {
        font-size: 8px;
        padding: 3px;
      }

      #theme-panel {
        min-height: 140px;
        height: 200px;
      }

      #btn-theme-close {
        padding: 3px;
      }

      #theme-panel-header .title {
        font-size: 12px;
        padding-left: 12px;
      }

      #theme-panel-presets {
        gap: 4px;
      }

      #theme-panel-presets .label {
        font-size: 9px;
      }

      #theme-preset-select {
        font-size: 9px;
        padding: 3px 2px;
      }

      #theme-panel thead th {
        padding: 6px;
        font-size: 10px;
        line-height: 1;
      }

      #theme-panel tbody th {
        padding: 4px;
        font-size: 8px;
      }

      #theme-panel td {
        padding: 6px;
        font-size: 10px;
      }

      #theme-panel tr td.warning-info {
        font-size: 6px;
      }

      #theme-panel-footer {
        padding: 8px 4px;
      }

      #theme-panel button {
        padding: 4px;
        font-size: 8px;
      }

    }

    /* ========================================
   MICRO-MOBILE (max-width: 240px)
   - Çok küçük ekranlar
   - 240px ve altı cihazlar için destek yok
======================================== */
    .unsupported-display {
      display: none;
    }

    @media (max-width: 240px) {

      body * {
        display: none;
      }

      .unsupported-display,
      br {
        display: block;
        font-size: 24px;
        text-align: center;
        font-weight: bold;
        padding: 20px;
        color: rgb(235, 29, 29);
      }
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
    crossorigin="anonymous" />

</head>

<body>
  <div class="main-frame" id="main-frame">
    <svg class="chain-bg" aria-hidden="true"> <!--inline svg, 35 kB civarı yer kaplar, isteğe bağlı silinebilir-->
      <?xml version="1.0" standalone="no"?>
      <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
      <svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1280.000000 612.000000"
        preserveAspectRatio="slice">
        <metadata>
          Created by potrace 1.15, written by Peter Selinger 2001-2017
        </metadata>
        <g transform="translate(0.000000,612.000000) scale(0.100000,-0.100000)">
          <path d="M453 5365 c-102 -22 -190 -70 -264 -144 -82 -82 -104 -138 -97 -242
9 -119 87 -218 228 -289 89 -45 172 -63 290 -63 175 -1 310 48 420 149 58 54
60 55 97 45 58 -17 127 -13 194 9 l60 20 62 -62 c107 -109 246 -161 427 -161
173 -1 311 49 419 149 59 54 61 55 98 45 58 -17 127 -13 194 9 l60 20 62 -62
c108 -110 246 -162 427 -161 173 0 313 50 419 150 l56 54 42 -11 c63 -15 127
-12 193 10 l60 20 62 -62 c110 -110 247 -162 428 -161 174 0 317 52 419 151
l54 54 43 -11 c64 -16 128 -13 194 9 l60 20 63 -64 c109 -109 246 -160 427
-159 174 0 317 52 419 151 l54 54 43 -11 c64 -16 128 -13 194 9 l60 20 62 -63
c108 -109 245 -161 428 -160 172 0 324 56 423 155 l50 50 43 -11 c64 -16 128
-13 194 9 l60 20 62 -63 c108 -109 245 -161 428 -160 172 0 321 55 422 156
l49 49 44 -11 c65 -16 128 -13 195 9 l58 20 64 -63 c109 -110 246 -161 428
-160 172 0 321 55 421 155 48 48 49 48 91 38 67 -15 133 -12 198 10 l58 20 64
-63 c109 -110 246 -161 428 -160 172 0 322 55 420 155 48 49 48 49 91 39 68
-16 134 -13 199 9 l58 20 64 -63 c70 -70 153 -116 258 -143 79 -21 243 -23
320 -5 92 22 210 84 267 141 l51 51 43 -10 c73 -17 179 -12 179 9 0 5 -27 6
-59 3 -60 -6 -115 1 -139 16 -11 7 -11 14 4 42 13 24 18 56 18 109 0 53 -5 85
-18 109 -15 28 -15 35 -4 42 24 15 79 22 139 16 32 -3 59 -2 59 3 0 21 -119
27 -182 10 -37 -11 -39 -10 -91 42 -170 170 -488 209 -726 88 -59 -29 -147
-105 -168 -143 -9 -18 -12 -18 -71 2 -67 23 -146 27 -203 11 -36 -10 -38 -9
-91 42 -176 172 -497 210 -731 86 -60 -32 -144 -104 -164 -141 -9 -18 -12 -18
-71 2 -67 23 -146 27 -204 11 -35 -10 -37 -9 -90 42 -172 172 -498 209 -731
86 -60 -32 -144 -104 -164 -141 -9 -18 -12 -18 -71 2 -67 23 -146 27 -204 11
-35 -10 -37 -9 -90 42 -209 207 -625 212 -837 9 -27 -25 -53 -54 -58 -64 -9
-18 -12 -18 -71 2 -67 23 -146 27 -204 11 -35 -10 -37 -9 -91 44 -168 168
-499 207 -728 85 -59 -32 -132 -93 -161 -137 l-16 -23 -60 20 c-66 23 -146 27
-203 11 -34 -10 -37 -8 -91 45 -175 168 -500 206 -729 84 -59 -32 -132 -93
-161 -137 l-16 -23 -60 20 c-66 23 -146 27 -203 11 -34 -10 -37 -8 -91 45
-234 226 -694 202 -885 -48 l-21 -28 -61 21 c-65 22 -132 25 -198 10 -42 -10
-42 -10 -88 39 -121 129 -366 191 -578 146 -126 -27 -251 -102 -313 -188 l-20
-29 -62 21 c-68 23 -131 26 -195 10 l-42 -10 -60 58 c-236 228 -705 196 -888
-60 -12 -18 -15 -18 -75 2 -67 23 -136 27 -195 10 -38 -10 -39 -10 -100 48
-72 67 -146 106 -254 134 -89 22 -226 24 -320 4z m321 -42 c98 -24 197 -83
247 -147 l20 -26 -35 -33 c-59 -56 -71 -118 -36 -186 10 -21 32 -48 46 -59
l28 -19 -50 -50 c-266 -266 -858 -131 -857 196 0 241 320 404 637 324z m1261
0 c83 -20 163 -65 219 -122 l47 -47 -40 -42 c-68 -71 -68 -155 0 -223 l40 -40
-51 -49 c-154 -150 -446 -183 -661 -75 -57 30 -159 125 -159 149 0 9 9 30 20
48 26 43 26 113 0 156 -11 18 -20 39 -20 48 0 8 23 40 52 70 75 79 172 123
328 148 40 7 160 -4 225 -21z m1240 6 c82 -18 185 -73 239 -128 l49 -50 -32
-27 c-81 -68 -83 -167 -5 -241 l35 -33 -51 -50 c-158 -153 -455 -184 -671 -69
-60 32 -149 119 -149 145 0 7 9 28 20 46 26 43 26 113 0 153 -29 44 -25 61 30
119 122 129 324 180 535 135z m1260 0 c82 -18 185 -73 239 -128 l49 -50 -32
-27 c-81 -67 -83 -167 -6 -240 l35 -33 -50 -50 c-190 -190 -593 -185 -775 10
-51 54 -54 68 -24 116 27 43 22 116 -9 160 -20 29 -20 30 -3 59 27 43 103 109
158 137 120 61 269 78 418 46z m1260 0 c82 -18 185 -73 239 -128 l49 -50 -32
-27 c-69 -58 -82 -142 -31 -212 17 -23 35 -42 40 -42 23 0 7 -33 -36 -74 -183
-176 -556 -180 -746 -8 -23 20 -49 50 -59 66 -17 29 -17 30 4 60 31 44 31 129
-1 174 l-23 32 20 28 c113 159 342 231 576 181z m1260 -1 c79 -17 175 -67 233
-121 l53 -51 -34 -35 c-46 -48 -57 -72 -57 -121 0 -48 11 -73 52 -117 l31 -32
-21 -26 c-54 -69 -160 -127 -275 -152 -84 -17 -235 -12 -308 11 -106 33 -209
103 -250 170 -17 29 -17 30 3 59 34 47 35 107 4 162 -26 47 -26 47 -7 74 113
159 342 230 576 179z m1295 -10 c36 -11 85 -31 109 -45 53 -31 131 -101 131
-118 0 -6 -12 -22 -26 -36 -37 -34 -54 -72 -54 -119 0 -48 11 -73 53 -118 l31
-32 -48 -49 c-96 -98 -247 -147 -416 -137 -52 3 -116 12 -141 20 -104 32 -200
97 -250 168 l-20 28 22 31 c34 49 37 109 5 165 l-26 46 28 39 c117 159 374
226 602 157z m1260 0 c36 -11 85 -31 109 -45 53 -31 131 -101 131 -118 0 -6
-12 -22 -26 -36 -37 -34 -54 -72 -54 -119 0 -48 11 -73 53 -118 l31 -32 -44
-45 c-206 -210 -646 -185 -810 46 l-20 27 25 44 c32 55 32 100 -1 155 -24 42
-25 45 -9 69 44 68 151 143 245 173 106 34 256 33 370 -1z m1260 0 c36 -11 85
-31 109 -45 50 -29 131 -100 131 -116 0 -5 -15 -27 -34 -48 -66 -72 -65 -146
1 -220 l36 -40 -43 -44 c-83 -85 -202 -133 -350 -141 -166 -10 -301 32 -405
128 -77 70 -80 78 -50 130 32 55 31 93 -1 153 l-25 48 29 41 c36 50 131 117
206 145 117 43 270 47 396 9z m1240 5 c30 -7 78 -25 107 -39 56 -27 153 -108
153 -128 0 -7 -16 -27 -35 -46 -68 -66 -67 -145 3 -222 l35 -39 -43 -44 c-148
-151 -442 -189 -654 -85 -62 31 -131 88 -161 134 -15 22 -14 27 10 71 32 60
32 90 0 150 l-26 48 27 39 c104 150 357 220 584 161z m-10790 -172 c39 -14 44
-20 41 -41 -2 -14 -3 -63 -3 -110 0 -47 1 -96 3 -110 4 -22 -2 -27 -46 -43
-55 -19 -187 -19 -207 1 -8 8 -6 22 6 52 20 51 21 149 1 197 -9 20 -14 42 -11
49 10 27 151 31 216 5z m1260 0 c39 -15 44 -20 40 -42 -7 -40 -5 -182 3 -210
8 -23 4 -27 -35 -45 -31 -14 -65 -19 -125 -19 -101 0 -112 8 -89 65 20 51 21
149 1 197 -9 20 -14 42 -11 49 10 27 151 31 216 5z m1260 0 c39 -15 44 -20 40
-42 -7 -40 -5 -182 3 -210 8 -23 4 -27 -35 -45 -49 -22 -199 -27 -218 -8 -9 9
-8 24 4 58 9 26 16 69 16 96 0 27 -7 70 -16 96 -8 25 -12 50 -7 54 25 24 153
25 213 1z m1255 1 c54 -18 53 -16 37 -97 -10 -46 -6 -87 12 -156 7 -23 3 -27
-36 -45 -49 -22 -199 -27 -218 -8 -9 9 -8 24 4 58 9 26 16 69 16 96 0 27 -7
70 -16 96 -8 25 -12 50 -7 54 24 24 142 25 208 2z m1253 3 c28 -9 53 -19 56
-23 2 -4 -2 -33 -11 -65 -14 -57 -12 -87 12 -172 13 -44 -140 -81 -231 -56
l-42 11 19 50 c23 60 24 132 4 190 -8 23 -15 47 -15 52 0 29 127 37 208 13z
m1260 0 c28 -9 53 -19 56 -23 2 -4 -3 -34 -11 -66 -15 -58 -12 -97 12 -171 5
-17 -1 -24 -32 -39 -48 -23 -146 -32 -199 -17 l-42 11 19 50 c24 64 24 136 0
199 l-19 50 27 10 c40 15 132 13 189 -4z m1285 -10 c28 -13 36 -22 31 -34 -26
-63 -26 -153 1 -222 14 -38 -146 -73 -231 -50 l-41 11 18 52 c23 67 23 129 0
195 l-18 52 26 11 c40 15 170 6 214 -15z m1260 -1 c27 -13 36 -22 31 -33 -26
-63 -26 -153 1 -222 15 -38 -147 -73 -233 -50 -35 10 -42 16 -36 29 39 93 43
149 15 229 l-18 52 26 11 c40 15 170 6 214 -16z m1258 2 l35 -18 -15 -58 c-15
-57 -10 -122 13 -181 16 -38 -146 -73 -232 -50 -35 10 -42 16 -36 29 40 94 43
146 15 227 l-19 54 26 10 c40 16 171 7 213 -13z m-10333 -85 c13 -53 5 -135
-17 -170 -15 -23 -56 11 -76 63 -14 36 -15 51 -6 79 14 42 56 90 74 84 6 -2
18 -27 25 -56z m1252 28 c26 -61 8 -209 -25 -209 -18 0 -51 43 -65 86 -14 41
-1 89 35 128 31 33 40 33 55 -5z m1260 -5 c23 -70 7 -204 -25 -204 -18 0 -62
57 -70 93 -13 49 38 147 76 147 4 0 13 -16 19 -36z m1259 5 c23 -67 6 -209
-25 -209 -20 0 -64 65 -71 103 -5 34 13 83 45 120 22 25 39 21 51 -14z m1260
0 c23 -66 4 -209 -28 -209 -5 0 -23 17 -38 37 -21 28 -28 47 -28 83 0 36 7 55
28 83 34 45 52 47 66 6z m1260 0 c23 -66 4 -209 -28 -209 -17 0 -60 60 -67 94
-7 42 1 71 33 114 30 40 48 41 62 1z m1260 0 c23 -66 4 -209 -28 -209 -14 0
-60 58 -67 86 -10 38 4 90 32 124 33 38 49 38 63 -1z m1260 -6 c21 -75 4 -203
-28 -203 -14 0 -60 58 -67 86 -10 38 4 90 32 124 34 40 51 38 63 -7z m1259 -2
c15 -47 15 -104 2 -153 -13 -47 -26 -55 -52 -32 -62 57 -64 137 -5 202 29 31
42 28 55 -17z m1260 0 c15 -47 15 -104 2 -153 -13 -47 -26 -55 -52 -32 -62 57
-64 137 -5 202 29 31 42 28 55 -17z m-10963 -80 c0 -51 -20 -90 -38 -72 -12
12 -14 122 -2 140 15 25 40 -16 40 -68z m1252 48 c22 -42 8 -116 -23 -126 -15
-5 -26 67 -18 117 7 44 22 48 41 9z m1252 18 c20 -25 23 -72 7 -110 -8 -20
-19 -37 -24 -37 -14 0 -23 74 -16 120 7 42 15 48 33 27z m1270 -33 c12 -34 11
-44 -2 -76 -9 -21 -20 -38 -26 -38 -14 0 -24 74 -16 121 8 49 25 47 44 -7z
m1260 0 c12 -34 11 -44 -2 -76 -9 -21 -20 -38 -26 -38 -14 0 -24 74 -16 121 8
49 25 47 44 -7z m1257 10 c13 -31 13 -42 2 -77 -17 -53 -35 -58 -44 -13 -8 43
3 126 17 126 6 0 17 -16 25 -36z m1261 -7 c10 -29 10 -45 0 -74 -22 -66 -47
-46 -47 37 0 83 25 103 47 37z m1253 24 c16 -30 12 -104 -7 -131 l-17 -24 -7
24 c-15 54 -7 150 12 150 4 0 13 -9 19 -19z m1260 0 c16 -30 12 -104 -7 -131
l-17 -24 -7 24 c-15 54 -7 150 12 150 4 0 13 -9 19 -19z" />
          <path d="M735 3898 c-38 -5 -89 -11 -112 -11 -22 -1 -37 -5 -32 -8 5 -3 -10
-11 -33 -18 -24 -7 -63 -24 -87 -37 -24 -13 -46 -22 -48 -20 -3 3 17 16 44 30
26 14 44 25 38 25 -17 1 -88 -43 -88 -54 1 -5 -12 -25 -28 -43 -52 -59 -51
-108 6 -170 35 -40 109 -81 183 -103 28 -8 38 -15 30 -20 -7 -5 5 -6 27 -4 29
4 34 3 20 -4 -36 -16 68 -26 250 -25 139 1 184 5 247 22 98 27 173 62 225 107
51 43 92 46 135 9 38 -31 109 -68 166 -85 30 -8 39 -15 30 -21 -8 -5 3 -7 27
-3 31 4 35 3 20 -5 -15 -8 -10 -9 25 -5 31 3 39 2 25 -4 -33 -14 104 -24 244
-18 193 9 325 48 417 123 64 53 101 57 148 17 42 -35 138 -80 204 -95 42 -9
50 -14 36 -20 -11 -4 1 -6 31 -3 34 3 42 2 25 -4 -41 -13 117 -25 250 -18 182
9 336 57 417 131 50 45 91 48 137 9 42 -35 138 -80 204 -95 42 -9 50 -14 36
-20 -11 -4 1 -6 31 -3 33 3 42 2 25 -3 -21 -7 -16 -9 30 -15 247 -30 524 25
637 127 53 47 87 47 152 1 55 -40 145 -79 206 -91 33 -6 36 -8 20 -15 -13 -6
-2 -7 30 -4 34 3 42 2 25 -4 -40 -13 114 -24 249 -19 186 9 355 63 425 137 42
44 94 43 148 -3 42 -37 138 -79 203 -92 32 -6 36 -9 20 -14 -41 -15 156 -33
295 -27 200 8 359 57 438 137 39 39 94 42 131 6 31 -29 109 -69 169 -87 28 -8
38 -15 30 -20 -7 -5 5 -6 27 -4 29 4 34 3 20 -4 -36 -16 68 -26 250 -25 139 1
184 5 247 22 100 27 179 65 225 108 45 43 91 46 135 8 38 -31 109 -68 166 -85
30 -8 39 -15 30 -21 -8 -5 3 -7 27 -3 31 4 35 3 20 -5 -15 -8 -10 -9 25 -5 31
3 39 2 25 -4 -33 -14 103 -24 244 -18 193 8 335 52 428 132 51 44 92 46 137 8
42 -35 138 -80 204 -95 42 -9 50 -14 36 -20 -11 -4 1 -6 31 -3 34 3 42 2 25
-4 -42 -14 98 -24 239 -18 193 8 344 55 428 131 50 45 91 48 137 9 42 -35 138
-80 204 -95 42 -9 50 -14 36 -20 -11 -4 1 -6 31 -3 33 3 42 2 25 -3 -21 -7
-16 -9 30 -15 247 -30 524 25 637 127 52 47 90 48 144 5 45 -35 154 -84 214
-95 33 -6 36 -8 20 -15 -13 -6 -2 -7 30 -4 34 3 42 2 25 -4 -40 -13 114 -24
249 -19 186 9 355 63 425 137 24 25 38 31 71 31 22 0 46 5 53 12 16 16 16 130
0 146 -7 7 -39 12 -76 12 -52 0 -69 4 -96 25 -45 35 -135 70 -231 91 -108 23
-341 23 -446 0 -42 -9 -83 -15 -90 -13 -8 2 -10 2 -6 -1 7 -3 -106 -62 -119
-62 -3 0 -2 5 2 12 4 7 3 8 -5 4 -6 -4 -9 -11 -6 -16 11 -17 -28 -33 -94 -38
-63 -4 -72 -2 -104 22 -144 110 -505 146 -744 75 -37 -12 -78 -22 -90 -22 -11
-1 -19 -6 -15 -11 3 -5 -2 -6 -12 -3 -9 4 -15 3 -12 -2 3 -5 -5 -16 -19 -25
-35 -23 -45 -19 -15 5 l25 21 -25 -14 c-14 -9 -25 -21 -25 -29 0 -9 -19 -14
-67 -17 -61 -3 -71 -1 -112 27 -114 79 -362 124 -557 102 -149 -17 -207 -34
-343 -99 -5 -3 -6 0 -2 7 11 17 0 13 -15 -6 -12 -15 -12 -16 1 -8 12 7 13 6 3
-6 -7 -9 -35 -15 -76 -17 -57 -3 -70 0 -113 27 -135 86 -364 126 -569 100 -55
-7 -117 -13 -137 -13 -21 0 -33 -3 -27 -6 5 -4 -10 -12 -33 -19 -24 -7 -63
-24 -87 -37 -49 -27 -55 -29 -45 -12 4 7 3 8 -5 4 -6 -4 -9 -11 -6 -16 3 -4
-3 -14 -12 -21 -15 -12 -16 -12 -9 5 6 19 6 19 -12 3 -31 -28 -109 -22 -160
13 -124 83 -363 125 -567 99 -55 -7 -117 -13 -137 -13 -21 0 -33 -3 -28 -6 6
-4 -14 -14 -44 -24 -30 -9 -78 -32 -106 -51 -29 -19 -50 -29 -48 -23 2 6 31
27 64 45 32 18 55 33 49 33 -15 0 -109 -56 -124 -74 -9 -11 -30 -16 -63 -16
-39 0 -62 8 -114 39 -127 77 -344 113 -542 91 -64 -8 -132 -14 -150 -14 -20 1
-28 -2 -20 -8 10 -6 10 -8 1 -8 -24 0 -122 -41 -158 -66 -21 -14 -39 -23 -42
-21 -2 3 12 15 31 27 20 12 36 24 36 27 0 7 -49 -25 -76 -48 -32 -29 -116 -26
-158 6 -45 35 -135 70 -231 91 -108 23 -341 23 -446 0 -42 -9 -83 -15 -90 -13
-8 2 -10 2 -6 -1 7 -3 -106 -62 -119 -62 -3 0 -2 5 2 12 4 7 3 8 -5 4 -6 -4
-9 -11 -6 -16 11 -17 -28 -33 -94 -38 -63 -4 -72 -2 -104 22 -144 110 -505
146 -744 75 -37 -12 -78 -22 -90 -22 -11 -1 -19 -6 -15 -11 3 -5 -2 -6 -12 -3
-9 4 -15 3 -12 -2 3 -5 -5 -16 -19 -25 -35 -23 -45 -19 -15 5 l25 21 -25 -14
c-14 -9 -25 -21 -25 -29 0 -9 -19 -14 -67 -17 -60 -3 -71 -1 -110 25 -24 16
-56 35 -73 42 -121 53 -329 80 -486 62 -149 -17 -207 -34 -343 -99 -5 -3 -5 1
0 9 7 12 5 12 -9 0 -20 -16 -23 -26 -4 -15 9 6 9 5 0 -7 -7 -9 -35 -15 -76
-17 -57 -3 -70 0 -113 27 -135 86 -366 127 -569 100 -55 -7 -117 -13 -137 -13
-21 0 -33 -3 -27 -6 5 -4 -10 -12 -33 -19 -24 -7 -63 -24 -87 -37 -49 -27 -55
-29 -45 -12 4 7 3 8 -5 4 -6 -4 -9 -11 -6 -16 3 -4 -3 -14 -12 -21 -15 -12
-16 -12 -9 5 6 19 6 19 -12 3 -31 -28 -109 -22 -160 13 -54 36 -133 66 -224
85 -92 20 -276 26 -363 13z m265 -99 c-19 -7 -15 -8 17 -4 49 6 140 -24 168
-55 14 -16 16 -30 11 -67 -7 -56 -24 -73 -102 -102 -163 -62 -441 -35 -526 50
-38 38 -35 58 16 97 66 49 144 72 281 81 163 11 165 11 135 0z m1100 0 c-19
-7 -15 -8 17 -4 49 6 140 -24 168 -55 14 -16 16 -29 11 -67 -3 -26 -14 -56
-24 -65 -27 -27 -121 -57 -214 -67 -231 -26 -468 66 -408 159 5 8 10 10 10 3
0 -6 14 2 31 18 44 41 144 69 279 78 158 11 160 11 130 0z m1167 -3 c28 -8 70
-24 92 -37 35 -19 41 -28 41 -55 0 -46 -11 -94 -22 -94 -5 0 -6 5 -2 12 4 7 3
8 -5 4 -6 -4 -9 -12 -6 -17 9 -14 -85 -51 -115 -44 -17 4 -21 3 -11 -4 19 -12
-72 -25 -181 -23 -151 1 -282 49 -308 112 -12 29 -9 45 9 45 4 0 15 8 25 18
50 50 142 77 291 87 61 4 117 8 125 8 8 1 38 -4 67 -12z m1038 3 c-23 -6 -19
-7 20 -4 36 4 46 2 35 -5 -11 -8 -9 -9 11 -5 18 5 43 -2 78 -20 l52 -26 -3
-61 c-2 -41 -8 -63 -17 -66 -9 -3 -11 0 -6 8 5 9 4 11 -4 6 -6 -4 -9 -12 -5
-17 9 -15 -84 -52 -114 -45 -20 5 -23 4 -12 -4 8 -5 13 -10 10 -10 -3 0 -42
-4 -87 -10 -146 -16 -314 15 -377 70 -37 33 -48 60 -35 81 5 8 9 10 9 5 0 -6
12 2 28 16 59 55 132 78 287 88 61 4 121 7 135 7 22 1 22 0 -5 -8z m1118 4
c-7 -2 -19 -2 -25 0 -7 3 -2 5 12 5 14 0 19 -2 13 -5z m1087 -4 c-19 -7 -15
-8 17 -4 48 6 140 -24 168 -55 25 -28 12 -115 -20 -136 -142 -93 -473 -88
-589 8 -27 22 -36 37 -36 59 0 17 4 28 9 25 4 -3 17 4 27 15 47 52 137 79 294
89 161 10 160 10 130 -1z m1100 0 c-19 -7 -15 -8 17 -4 49 6 140 -24 168 -55
14 -16 16 -30 11 -67 -7 -56 -24 -73 -102 -102 -163 -62 -441 -35 -526 50 -38
38 -35 58 16 97 67 50 145 73 281 81 165 11 165 11 135 0z m1100 0 c-19 -7
-15 -8 17 -4 49 6 140 -24 168 -55 27 -29 14 -108 -22 -137 -60 -49 -232 -78
-370 -62 -173 19 -286 93 -243 159 5 8 10 10 10 3 0 -6 14 2 30 17 46 43 144
71 278 80 161 10 162 10 132 -1z m1167 -3 c28 -8 70 -24 92 -37 35 -19 41 -28
41 -55 0 -46 -11 -94 -22 -94 -5 0 -6 5 -2 12 4 7 3 8 -5 4 -6 -4 -9 -12 -6
-17 4 -5 -14 -18 -38 -28 -193 -83 -531 -42 -577 69 -12 28 -9 45 9 45 3 0 20
12 36 28 44 40 142 67 275 76 63 5 122 9 130 9 8 1 38 -4 67 -12z m1038 3
c-23 -6 -19 -7 20 -4 36 4 46 2 35 -5 -11 -8 -9 -9 11 -5 18 5 43 -2 78 -20
l52 -26 -3 -61 c-2 -41 -8 -63 -17 -66 -9 -3 -11 0 -6 8 5 9 4 11 -4 6 -6 -4
-9 -12 -5 -17 9 -15 -84 -52 -114 -45 -18 5 -22 4 -13 -3 21 -14 -58 -24 -174
-23 -155 2 -286 47 -314 109 -11 24 -5 56 9 48 4 -2 16 5 26 16 24 26 76 53
134 69 38 11 202 26 290 27 22 1 22 0 -5 -8z m1118 4 c-7 -2 -19 -2 -25 0 -7
3 -2 5 12 5 14 0 19 -2 13 -5z m-6489 -33 c54 -25 65 -46 58 -108 -5 -50 -31
-71 -117 -98 -221 -67 -535 -4 -535 108 0 16 4 27 9 24 4 -3 17 4 27 15 57 63
170 89 365 85 128 -3 152 -6 193 -26z m6523 17 c-7 -4 0 -5 14 -2 26 6 112
-26 125 -47 3 -5 5 -26 5 -46 -1 -20 -2 -45 -2 -55 0 -22 -47 -52 -114 -73
-221 -67 -535 -4 -535 108 0 16 4 27 9 24 4 -3 17 4 27 15 27 30 88 59 158 74
65 15 333 16 313 2z m-10627 -73 c0 -2 -9 -4 -20 -4 -11 0 -20 4 -20 9 0 5 9
7 20 4 11 -3 20 -7 20 -9z m3300 6 c0 -5 -8 -10 -17 -10 -15 0 -16 2 -3 10 19
12 20 12 20 0z m1100 0 c0 -5 -8 -10 -17 -10 -15 0 -16 2 -3 10 19 12 20 12
20 0z m1106 -3 c4 -4 -2 -7 -14 -7 -12 0 -22 4 -22 9 0 10 26 9 36 -2z m1104
-3 c0 -2 -9 -4 -20 -4 -11 0 -20 4 -20 9 0 5 9 7 20 4 11 -3 20 -7 20 -9z
m3300 6 c0 -5 -8 -10 -17 -10 -15 0 -16 2 -3 10 19 12 20 12 20 0z m1138 -37
c3 -38 1 -43 -17 -43 -12 0 -21 5 -21 10 0 6 5 10 10 10 6 0 10 11 10 25 0 21
-5 25 -27 25 -22 0 -25 2 -13 10 8 6 24 9 35 8 16 -2 21 -12 23 -45z m28 -59
c-6 -16 -76 -20 -76 -4 0 6 14 10 30 10 29 0 30 2 30 43 0 24 3 47 8 51 8 9
16 -80 8 -100z m-9983 89 c-7 -2 -19 -2 -25 0 -7 3 -2 5 12 5 14 0 19 -2 13
-5z m1104 1 c-3 -3 -12 -4 -19 -1 -8 3 -5 6 6 6 11 1 17 -2 13 -5z m5506 -1
c-7 -2 -19 -2 -25 0 -7 3 -2 5 12 5 14 0 19 -2 13 -5z m1104 1 c-3 -3 -12 -4
-19 -1 -8 3 -5 6 6 6 11 1 17 -2 13 -5z m-8792 -64 c3 -5 -1 -10 -9 -10 -9 0
-16 5 -16 10 0 6 4 10 9 10 6 0 13 -4 16 -10z m1105 0 c0 -5 -7 -10 -15 -10
-8 0 -15 5 -15 10 0 6 7 10 15 10 8 0 15 -4 15 -10z m1100 0 c0 -5 -4 -10 -10
-10 -5 0 -10 5 -10 10 0 6 5 10 10 10 6 0 10 -4 10 -10z m1100 0 c0 -5 -4 -10
-10 -10 -5 0 -10 5 -10 10 0 6 5 10 10 10 6 0 10 -4 10 -10z m1100 0 c0 -5 -4
-10 -10 -10 -5 0 -10 5 -10 10 0 6 5 10 10 10 6 0 10 -4 10 -10z m1100 0 c0
-5 -4 -10 -10 -10 -5 0 -10 5 -10 10 0 6 5 10 10 10 6 0 10 -4 10 -10z m1105
0 c3 -5 -1 -10 -9 -10 -9 0 -16 5 -16 10 0 6 4 10 9 10 6 0 13 -4 16 -10z
m1105 0 c0 -5 -7 -10 -15 -10 -8 0 -15 5 -15 10 0 6 7 10 15 10 8 0 15 -4 15
-10z m1100 0 c0 -5 -4 -10 -10 -10 -5 0 -10 5 -10 10 0 6 5 10 10 10 6 0 10
-4 10 -10z m1100 0 c0 -5 -4 -10 -10 -10 -5 0 -10 5 -10 10 0 6 5 10 10 10 6
0 10 -4 10 -10z m-9900 -30 c0 -5 -11 -10 -25 -10 -14 0 -25 5 -25 10 0 6 11
10 25 10 14 0 25 -4 25 -10z m1100 0 c0 -5 -12 -10 -26 -10 -14 0 -23 4 -19
10 3 6 15 10 26 10 10 0 19 -4 19 -10z m1100 0 c0 -5 -9 -10 -20 -10 -11 0
-20 5 -20 10 0 6 9 10 20 10 11 0 20 -4 20 -10z m1100 0 c0 -5 -9 -10 -20 -10
-11 0 -20 5 -20 10 0 6 9 10 20 10 11 0 20 -4 20 -10z m1105 0 c4 -6 -5 -10
-19 -10 -14 0 -26 5 -26 10 0 6 9 10 19 10 11 0 23 -4 26 -10z m1100 0 c4 -6
-5 -10 -19 -10 -14 0 -26 5 -26 10 0 6 9 10 19 10 11 0 23 -4 26 -10z m1105 0
c0 -5 -11 -10 -25 -10 -14 0 -25 5 -25 10 0 6 11 10 25 10 14 0 25 -4 25 -10z
m1100 0 c0 -5 -12 -10 -26 -10 -14 0 -23 4 -19 10 3 6 15 10 26 10 10 0 19 -4
19 -10z m1100 0 c0 -5 -9 -10 -20 -10 -11 0 -20 5 -20 10 0 6 9 10 20 10 11 0
20 -4 20 -10z m1100 0 c0 -5 -9 -10 -20 -10 -11 0 -20 5 -20 10 0 6 9 10 20
10 11 0 20 -4 20 -10z m-10667 -167 c-7 -2 -19 -2 -25 0 -7 3 -2 5 12 5 14 0
19 -2 13 -5z m5510 0 c-7 -2 -19 -2 -25 0 -7 3 -2 5 12 5 14 0 19 -2 13 -5z
m1100 0 c-7 -2 -19 -2 -25 0 -7 3 -2 5 12 5 14 0 19 -2 13 -5z m-6520 -10 c-7
-2 -21 -2 -30 0 -10 3 -4 5 12 5 17 0 24 -2 18 -5z m1100 0 c-7 -2 -19 -2 -25
0 -7 3 -2 5 12 5 14 0 19 -2 13 -5z m1100 0 c-7 -2 -19 -2 -25 0 -7 3 -2 5 12
5 14 0 19 -2 13 -5z m1100 0 c-7 -2 -19 -2 -25 0 -7 3 -2 5 12 5 14 0 19 -2
13 -5z m1100 0 c-7 -2 -19 -2 -25 0 -7 3 -2 5 12 5 14 0 19 -2 13 -5z m1100 0
c-7 -2 -19 -2 -25 0 -7 3 -2 5 12 5 14 0 19 -2 13 -5z m1110 0 c-7 -2 -21 -2
-30 0 -10 3 -4 5 12 5 17 0 24 -2 18 -5z m1100 0 c-7 -2 -21 -2 -30 0 -10 3
-4 5 12 5 17 0 24 -2 18 -5z m1100 0 c-7 -2 -19 -2 -25 0 -7 3 -2 5 12 5 14 0
19 -2 13 -5z m1100 0 c-7 -2 -19 -2 -25 0 -7 3 -2 5 12 5 14 0 19 -2 13 -5z
m1100 0 c-7 -2 -19 -2 -25 0 -7 3 -2 5 12 5 14 0 19 -2 13 -5z" />
          <path d="M1154 3614 c-18 -14 -18 -15 4 -4 12 6 22 13 22 15 0 8 -5 6 -26 -11z" />
          <path d="M2254 3614 c-18 -14 -18 -15 4 -4 12 6 22 13 22 15 0 8 -5 6 -26 -11z" />
          <path d="M3193 3793 c9 -2 23 -2 30 0 6 3 -1 5 -18 5 -16 0 -22 -2 -12 -5z" />
          <path d="M4430 3600 c-9 -6 -10 -10 -3 -10 6 0 15 5 18 10 8 12 4 12 -15 0z" />
          <path d="M6635 3604 c-22 -13 -35 -24 -30 -24 12 0 75 38 75 45 0 6 2 7 -45
-21z" />
          <path d="M8864 3614 c-18 -14 -18 -15 4 -4 12 6 22 13 22 15 0 8 -5 6 -26 -11z" />
          <path d="M9803 3793 c9 -2 23 -2 30 0 6 3 -1 5 -18 5 -16 0 -22 -2 -12 -5z" />
          <path d="M11040 3600 c-9 -6 -10 -10 -3 -10 6 0 15 5 18 10 8 12 4 12 -15 0z" />
          <path d="M5545 3609 c-16 -10 -25 -19 -19 -19 7 0 22 9 35 20 30 24 23 24 -16
-1z" />
          <path d="M12155 3609 c-16 -10 -25 -19 -19 -19 7 0 22 9 35 20 30 24 23 24
-16 -1z" />
          <path d="M4910 3860 c-8 -5 -10 -10 -5 -10 6 0 17 5 25 10 8 5 11 10 5 10 -5
0 -17 -5 -25 -10z" />
          <path d="M11520 3860 c-8 -5 -10 -10 -5 -10 6 0 17 5 25 10 8 5 11 10 5 10 -5
0 -17 -5 -25 -10z" />
          <path d="M1568 3844 c-39 -21 -35 -28 5 -8 37 19 44 24 31 24 -5 -1 -21 -8
-36 -16z" />
          <path d="M8178 3844 c-39 -21 -35 -28 5 -8 37 19 44 24 31 24 -5 -1 -21 -8
-36 -16z" />
          <path d="M2654 3834 c-18 -14 -18 -14 6 -3 31 14 36 19 24 19 -6 0 -19 -7 -30
-16z" />
          <path d="M9264 3834 c-18 -14 -18 -14 6 -3 31 14 36 19 24 19 -6 0 -19 -7 -30
-16z" />
          <path d="M379 3783 c-13 -16 -12 -17 4 -4 16 13 21 21 13 21 -2 0 -10 -8 -17
-17z" />
          <path d="M2808 3463 c7 -3 16 -2 19 1 4 3 -2 6 -13 5 -11 0 -14 -3 -6 -6z" />
          <path d="M3908 3463 c7 -3 16 -2 19 1 4 3 -2 6 -13 5 -11 0 -14 -3 -6 -6z" />
          <path d="M5008 3463 c7 -3 16 -2 19 1 4 3 -2 6 -13 5 -11 0 -14 -3 -6 -6z" />
          <path d="M9418 3463 c7 -3 16 -2 19 1 4 3 -2 6 -13 5 -11 0 -14 -3 -6 -6z" />
          <path d="M10518 3463 c7 -3 16 -2 19 1 4 3 -2 6 -13 5 -11 0 -14 -3 -6 -6z" />
          <path d="M11618 3463 c7 -3 16 -2 19 1 4 3 -2 6 -13 5 -11 0 -14 -3 -6 -6z" />
          <path d="M485 2685 c-131 -24 -232 -73 -311 -152 -136 -137 -134 -324 6 -461
183 -181 544 -211 784 -67 55 33 57 33 148 28 51 -3 113 0 138 6 43 10 48 8
110 -29 211 -127 498 -129 704 -5 55 33 57 33 148 28 51 -3 113 0 138 6 43 10
48 8 110 -29 205 -122 453 -130 675 -21 l100 49 85 -5 c47 -2 105 0 130 6 43
10 48 8 110 -29 211 -125 469 -131 687 -15 81 43 81 43 165 38 48 -3 107 -1
138 6 49 10 57 10 80 -8 197 -145 522 -157 740 -26 54 32 56 33 150 28 52 -3
115 0 139 5 42 10 48 9 109 -28 206 -125 498 -129 695 -10 l64 39 94 -6 c52
-3 114 0 138 5 42 10 48 9 102 -25 211 -130 506 -133 713 -8 55 33 57 33 148
28 51 -3 113 0 137 5 42 10 48 9 110 -28 214 -127 499 -129 705 -5 55 33 57
33 148 28 51 -3 113 0 138 6 43 10 48 8 110 -29 141 -84 304 -114 468 -87 99
16 201 54 260 96 25 17 39 19 123 14 52 -3 114 0 139 6 43 10 48 8 110 -29
211 -125 469 -131 687 -15 81 43 81 43 165 38 48 -3 107 -1 138 6 49 10 57 10
80 -8 197 -145 523 -157 740 -26 54 32 57 33 146 28 140 -8 261 28 338 103
201 195 -4 462 -339 441 -88 -6 -90 -6 -145 28 -75 45 -168 75 -275 88 -155
18 -334 -25 -456 -109 -34 -23 -39 -24 -90 -13 -31 7 -87 9 -134 6 l-80 -6
-100 50 c-80 39 -120 53 -200 66 -168 27 -339 -4 -473 -88 -62 -38 -63 -38
-115 -28 -29 7 -89 9 -139 6 -86 -6 -89 -5 -144 28 -73 44 -157 72 -260 86
-149 21 -334 -18 -450 -95 -52 -35 -54 -35 -111 -25 -32 6 -95 9 -140 6 -80
-6 -84 -5 -139 28 -204 123 -495 121 -701 -3 -70 -42 -70 -42 -124 -31 -31 7
-88 9 -136 6 -82 -6 -83 -6 -149 33 -204 119 -490 115 -697 -10 -65 -40 -67
-40 -119 -29 -31 7 -88 9 -137 6 -83 -6 -85 -6 -140 28 -205 125 -500 121
-711 -9 -57 -36 -59 -36 -111 -25 -32 7 -88 9 -138 6 -83 -6 -86 -6 -140 27
-211 128 -509 122 -722 -15 -45 -28 -48 -29 -100 -18 -31 7 -87 9 -134 6 l-80
-6 -100 50 c-227 112 -479 102 -681 -28 -50 -33 -53 -33 -105 -22 -32 7 -88 9
-140 6 -86 -7 -88 -6 -144 28 -74 44 -158 72 -261 86 -149 21 -334 -18 -450
-95 -53 -35 -54 -36 -106 -25 -30 7 -90 9 -140 6 -86 -6 -89 -5 -144 28 -204
123 -495 121 -701 -3 -70 -42 -70 -42 -124 -31 -31 7 -88 9 -137 6 -81 -6 -84
-5 -140 28 -135 82 -310 111 -477 80z m293 -184 c50 -23 64 -42 41 -57 -22
-13 -49 -90 -49 -139 0 -47 20 -104 52 -147 17 -23 -7 -41 -83 -62 -212 -60
-449 50 -449 209 0 83 78 171 184 205 85 28 229 23 304 -9z m1076 8 c37 -11
69 -26 72 -34 3 -7 -7 -32 -23 -56 -24 -37 -28 -52 -28 -114 0 -62 4 -77 28
-114 16 -24 26 -49 23 -56 -2 -7 -35 -23 -71 -35 -95 -32 -224 -26 -312 14
-35 16 -63 34 -63 40 0 6 11 33 25 60 15 29 25 66 25 91 0 25 -10 62 -25 91
-14 27 -25 54 -25 60 0 11 93 57 135 67 54 13 176 6 239 -14z m1127 -7 c51
-22 66 -37 48 -48 -21 -13 -59 -109 -59 -150 0 -26 11 -64 32 -104 30 -61 30
-63 12 -77 -68 -49 -263 -57 -361 -14 -73 32 -78 41 -52 91 35 66 36 127 5
195 -14 31 -23 61 -20 66 7 12 61 40 109 56 60 20 227 11 286 -15z m1063 14
c26 -8 58 -21 71 -30 l24 -16 -32 -52 c-27 -43 -32 -61 -32 -113 0 -52 5 -70
32 -114 l33 -52 -33 -19 c-78 -48 -257 -53 -354 -11 -75 33 -78 40 -48 96 34
65 34 135 0 199 -14 26 -23 52 -19 57 8 13 61 40 109 55 54 17 191 17 249 0z
m1144 -15 c28 -13 52 -27 52 -30 0 -4 -11 -22 -24 -40 -14 -18 -30 -55 -36
-82 -14 -59 -2 -119 36 -171 13 -17 24 -35 24 -39 0 -3 -24 -17 -52 -30 -46
-21 -68 -24 -168 -24 -99 0 -122 3 -167 24 -74 33 -78 40 -48 92 34 60 34 137
0 204 -13 27 -22 52 -19 57 7 12 62 39 109 55 65 21 228 12 293 -16z m1100 0
c49 -22 64 -42 42 -56 -15 -9 -42 -65 -51 -105 -10 -45 5 -112 36 -158 14 -20
25 -40 25 -43 0 -4 -24 -17 -52 -30 -108 -46 -279 -36 -375 23 l-33 19 27 50
c35 68 35 136 0 206 l-26 51 27 18 c89 58 275 70 380 25z m1100 0 c50 -23 64
-42 41 -57 -22 -13 -49 -90 -49 -139 0 -49 27 -126 49 -139 46 -29 -57 -77
-176 -84 -88 -5 -152 6 -220 39 -49 24 -51 33 -21 85 31 52 31 133 1 195 -13
25 -23 50 -23 55 0 14 38 35 100 56 79 26 225 20 298 -11z m1076 8 c37 -11 69
-26 72 -34 3 -7 -7 -32 -23 -56 -24 -37 -28 -52 -28 -114 0 -62 4 -77 28 -114
16 -24 26 -49 23 -56 -3 -8 -37 -24 -76 -36 -100 -30 -220 -24 -307 15 -35 16
-63 33 -63 39 0 5 12 34 26 64 22 45 26 62 21 104 -4 28 -15 67 -27 86 -11 19
-20 40 -20 47 0 12 90 58 135 69 54 13 176 6 239 -14z m1129 -7 c26 -12 47
-24 47 -28 0 -4 -14 -35 -31 -70 -43 -87 -37 -148 21 -241 19 -29 10 -38 -66
-64 -80 -29 -224 -24 -301 10 -75 33 -78 39 -48 102 31 68 31 120 0 187 -14
30 -22 58 -19 63 7 12 61 40 109 56 61 20 227 11 288 -15z m1061 14 c26 -8 58
-21 71 -30 l24 -16 -32 -51 c-27 -44 -32 -62 -32 -114 0 -52 5 -70 32 -114
l33 -52 -33 -19 c-78 -48 -257 -53 -354 -11 -75 33 -78 40 -48 96 34 65 34
135 0 199 -14 26 -23 52 -19 57 8 13 61 40 109 55 54 17 191 17 249 0z m1144
-15 c28 -13 52 -27 52 -31 0 -4 -9 -19 -21 -33 -57 -73 -60 -169 -9 -251 17
-26 30 -48 30 -50 0 -2 -24 -14 -52 -27 -46 -21 -68 -24 -168 -24 -99 0 -122
3 -167 24 -74 33 -77 39 -48 96 33 65 33 135 0 200 -13 27 -22 52 -19 57 7 12
62 39 109 55 65 21 228 12 293 -16z m-10593 -58 c-37 -87 -40 -177 -9 -251 16
-40 18 -37 -21 -45 -50 -9 -56 1 -35 63 28 80 24 139 -15 233 -6 15 -1 17 40
17 41 0 46 -2 40 -17z m1100 -5 c-40 -126 -41 -133 -18 -210 12 -40 21 -73 20
-74 -11 -7 -66 -11 -76 -5 -10 7 -9 15 4 41 35 67 31 151 -10 253 -6 15 -1 17
40 17 45 0 47 -1 40 -22z m1100 0 c-40 -132 -40 -133 0 -264 6 -18 1 -22 -24
-27 -54 -11 -60 -3 -40 56 23 66 23 138 0 205 l-18 52 45 0 c41 0 44 -1 37
-22z m1105 13 c0 -5 -7 -28 -15 -51 -8 -23 -15 -54 -15 -68 0 -36 -12 -20 -27
36 -7 26 -15 57 -19 70 -6 20 -3 22 35 22 23 0 41 -4 41 -9z m1100 -3 c0 -7
-7 -31 -15 -53 -19 -54 -19 -122 2 -184 18 -57 18 -56 -17 -64 -44 -11 -55 5
-38 50 33 81 32 117 -7 241 -7 20 -4 22 34 22 26 0 41 -4 41 -12z m1102 7 c3
-3 -3 -29 -13 -58 -23 -66 -23 -118 0 -185 19 -56 19 -56 -19 -65 -46 -11 -50
2 -27 81 21 70 21 75 5 135 -9 34 -20 70 -23 80 -6 14 -1 17 32 17 22 0 42 -2
45 -5z m1103 -12 c-16 -37 -35 -119 -35 -148 1 -16 9 -55 20 -85 10 -30 18
-55 17 -56 -1 -1 -16 -4 -32 -7 -50 -9 -56 1 -35 63 28 80 24 139 -15 233 -6
15 -1 17 40 17 41 0 46 -2 40 -17z m1100 0 c-3 -10 -14 -46 -23 -80 -16 -60
-16 -65 5 -135 12 -40 21 -73 20 -74 -1 -1 -16 -4 -32 -7 -50 -9 -56 1 -35 63
28 80 24 139 -15 233 -6 15 -1 17 40 17 41 0 46 -2 40 -17z m1100 -5 c-40
-132 -40 -140 0 -264 6 -18 2 -22 -24 -27 -54 -11 -60 -3 -40 56 24 68 24 134
0 202 l-19 55 45 0 c42 0 45 -1 38 -22z m1101 0 c-4 -13 -12 -44 -19 -70 -6
-27 -14 -48 -17 -48 -3 0 -11 21 -17 48 -7 26 -15 57 -19 70 -6 20 -3 22 36
22 39 0 42 -2 36 -22z m1147 10 c23 -7 61 -31 84 -54 39 -36 43 -45 43 -87 0
-40 -6 -53 -36 -86 -36 -40 -89 -66 -155 -74 -56 -8 -65 3 -45 52 20 52 21
160 1 208 -8 19 -15 39 -15 44 0 13 76 11 123 -3z m-11323 -144 c0 -21 -4 -33
-10 -29 -17 10 -11 65 7 65 2 0 3 -16 3 -36z m1100 0 c0 -21 -4 -33 -10 -29
-17 10 -11 65 7 65 2 0 3 -16 3 -36z m1100 -1 c-1 -31 -3 -35 -11 -20 -6 9 -7
26 -4 37 10 30 15 24 15 -17z m1104 -16 c-7 -21 -7 -21 -14 -2 -4 11 -5 28 -2
38 4 17 6 18 14 3 5 -9 6 -26 2 -39z m1106 18 c0 -13 -4 -27 -10 -30 -6 -4
-10 8 -10 30 0 22 4 34 10 30 6 -3 10 -17 10 -30z m1100 -6 c0 -16 -4 -29 -10
-29 -5 0 -10 16 -10 36 0 21 4 33 10 29 6 -3 10 -19 10 -36z m1100 5 c0 -21
-4 -33 -10 -29 -17 10 -11 65 7 65 2 0 3 -16 3 -36z m1100 0 c0 -21 -4 -33
-10 -29 -17 10 -11 65 7 65 2 0 3 -16 3 -36z m1100 -1 c0 -27 -3 -34 -11 -26
-7 7 -9 23 -5 37 9 37 16 32 16 -11z m1102 -16 c-4 -17 -6 -18 -14 -3 -5 9 -6
26 -2 39 7 21 7 21 14 2 4 -11 5 -28 2 -38z m1108 18 c0 -13 -4 -27 -10 -30
-6 -4 -10 8 -10 30 0 22 4 34 10 30 6 -3 10 -17 10 -30z m-7461 -108 c16 -40
14 -44 -19 -50 -54 -11 -59 -3 -37 66 11 34 22 69 25 77 3 8 8 -3 13 -25 4
-22 12 -53 18 -68z m6598 46 c7 -27 15 -57 18 -69 6 -18 1 -22 -24 -27 -55
-11 -61 -2 -40 54 11 27 19 58 19 69 0 36 15 21 27 -27z" />
          <path d="M1220 1200 c-71 -9 -184 -36 -213 -51 -13 -7 -36 -4 -80 10 -277 92
-651 10 -753 -164 -87 -150 34 -311 287 -381 101 -28 339 -26 442 4 95 27 113
27 224 1 74 -18 110 -20 223 -17 88 3 158 11 202 23 l66 19 94 -30 c86 -27
104 -29 248 -29 122 0 169 4 220 19 100 29 122 30 222 6 124 -30 286 -30 415
-1 l93 21 77 -22 c66 -19 102 -23 233 -23 131 0 167 4 233 23 90 26 115 27
179 7 134 -40 337 -38 485 6 l75 22 91 -24 c131 -34 344 -34 464 0 89 25 110
24 233 -4 99 -22 314 -17 412 10 67 19 67 19 135 -3 37 -12 95 -27 128 -33 83
-15 294 -6 370 17 75 23 139 23 235 0 105 -26 277 -24 395 3 l91 20 79 -22
c117 -32 357 -32 468 1 91 26 115 27 182 7 132 -41 332 -38 483 7 l74 21 91
-24 c130 -34 343 -34 464 0 88 25 111 24 228 -3 103 -23 276 -21 387 5 l89 21
97 -29 c88 -25 111 -28 252 -28 132 0 167 4 237 24 87 24 101 24 223 -4 105
-24 269 -23 391 3 l96 21 74 -22 c62 -18 100 -21 239 -21 143 0 174 3 230 22
81 27 107 27 206 1 103 -27 287 -29 394 -4 87 20 199 71 252 114 40 34 88 121
88 160 0 127 -135 244 -336 292 -127 30 -332 24 -449 -14 l-80 -26 -63 19
c-143 45 -294 48 -463 9 l-87 -20 -73 23 c-65 20 -94 23 -244 23 -159 0 -175
-2 -248 -28 l-78 -27 -66 20 c-151 47 -344 47 -492 1 -36 -11 -64 -15 -73 -10
-30 20 -142 48 -229 58 -118 13 -253 0 -353 -33 l-73 -25 -63 20 c-158 49
-348 48 -509 -3 l-74 -23 -71 25 c-66 23 -85 25 -246 24 -163 0 -181 -2 -255
-27 l-80 -26 -63 19 c-144 45 -297 48 -462 8 l-86 -20 -69 22 c-55 18 -101 24
-215 27 -134 4 -152 2 -240 -22 -118 -33 -127 -33 -225 -5 -115 32 -295 32
-419 1 l-88 -23 -79 26 c-158 52 -370 53 -525 1 l-71 -24 -63 20 c-35 11 -105
25 -157 31 -111 14 -246 1 -352 -35 l-68 -22 -74 23 c-142 46 -388 41 -526
-10 -52 -19 -53 -19 -118 1 -148 46 -299 49 -465 9 l-86 -20 -69 22 c-52 17
-104 24 -202 27 -140 6 -212 -3 -315 -38 -56 -20 -56 -20 -120 0 -145 46 -303
49 -465 10 l-82 -20 -81 25 c-44 14 -120 30 -168 36 -95 11 -98 11 -192 0z
m263 -129 l38 -12 -35 -40 c-63 -74 -71 -165 -21 -241 l25 -38 -27 -12 c-37
-16 -259 -16 -296 0 l-27 12 27 41 c50 76 43 169 -19 248 -10 13 -16 26 -13
29 30 30 264 39 348 13z m3839 -2 l37 -12 -31 -35 c-38 -44 -58 -91 -58 -137
0 -40 22 -100 47 -127 14 -16 14 -18 -13 -30 -38 -16 -259 -16 -297 0 l-27 12
31 55 c42 74 39 143 -10 211 -18 26 -30 49 -27 52 32 31 266 39 348 11z m3795
11 c76 -17 82 -24 51 -57 -14 -15 -33 -43 -43 -62 -24 -47 -17 -140 13 -181
12 -16 22 -33 22 -39 0 -14 -91 -31 -165 -31 -69 0 -162 16 -170 30 -3 5 6 25
20 45 47 70 45 139 -6 219 -16 27 -27 51 -24 55 27 27 213 40 302 21z m-8304
-11 c20 -5 37 -12 37 -15 0 -2 -12 -22 -26 -44 -49 -74 -42 -168 18 -235 28
-33 28 -34 9 -44 -11 -6 -54 -16 -96 -23 -102 -16 -216 0 -302 43 -236 115
-92 328 222 329 55 0 117 -5 138 -11z m1907 0 c27 -6 50 -14 50 -18 0 -4 -10
-16 -21 -27 -32 -28 -59 -93 -59 -142 0 -43 17 -87 52 -131 13 -18 16 -27 8
-35 -16 -16 -269 -14 -297 2 l-22 12 30 58 c39 73 36 129 -10 203 -17 29 -29
54 -27 57 28 27 207 40 296 21z m1260 0 c73 -16 75 -17 57 -37 -25 -27 -57
-104 -57 -137 0 -36 33 -111 62 -142 l20 -22 -43 -13 c-55 -16 -273 -16 -312
0 l-29 12 26 31 c57 67 57 157 0 239 -19 28 -31 50 -27 50 5 1 31 7 58 15 59
16 182 19 245 4z m663 2 c21 -5 41 -11 43 -14 3 -3 -7 -22 -21 -43 -32 -47
-39 -73 -33 -133 3 -32 15 -63 36 -94 18 -25 32 -48 32 -50 0 -14 -109 -32
-195 -32 -84 1 -175 16 -175 30 0 2 11 21 25 41 48 70 46 155 -4 228 l-31 45
47 15 c54 16 217 20 276 7z m1945 -8 l23 -9 -38 -48 c-36 -46 -38 -53 -38
-121 0 -66 3 -77 33 -118 l33 -46 -43 -12 c-51 -13 -229 -7 -271 10 l-29 11
26 31 c55 65 57 154 4 234 -17 25 -28 49 -24 52 3 3 27 12 53 19 52 15 231 13
271 -3z m1269 -3 l32 -11 -32 -46 c-28 -39 -32 -53 -32 -108 0 -56 4 -69 33
-111 39 -54 37 -57 -47 -75 -64 -13 -223 -7 -265 10 -26 10 -27 13 -14 29 66
74 64 184 -4 271 -10 13 -16 26 -13 29 29 29 272 38 342 12z m636 7 l37 -12
-25 -37 c-51 -74 -49 -159 4 -234 17 -24 31 -46 31 -49 0 -2 -34 -11 -77 -21
-54 -12 -98 -15 -152 -11 -69 6 -141 22 -141 33 0 3 11 22 25 43 47 71 46 147
-5 222 -16 24 -26 47 -22 51 26 26 255 36 325 15z m1906 2 l51 -11 -35 -45
c-65 -85 -68 -157 -9 -244 l33 -49 -27 -7 c-42 -12 -254 -8 -284 5 l-28 11 25
37 c54 80 53 149 -4 235 -17 24 -28 45 -26 48 3 2 28 9 57 17 67 16 182 17
247 3z m1325 -19 c67 -25 128 -76 146 -121 29 -69 -34 -155 -146 -200 -50 -20
-77 -23 -184 -23 -77 -1 -136 4 -153 12 l-27 12 27 42 c24 35 28 52 28 109 0
60 -4 72 -33 114 -18 26 -31 50 -28 52 3 3 29 12 58 19 80 20 238 12 312 -16z
m-9634 9 c48 -10 61 -21 40 -34 -24 -15 -50 -86 -50 -139 0 -45 6 -62 35 -106
20 -29 33 -55 31 -58 -12 -12 -128 -32 -186 -32 -60 0 -174 20 -186 33 -4 3 6
21 20 39 61 80 70 147 31 224 -14 27 -25 52 -25 56 0 25 198 37 290 17z m1287
-5 l22 -9 -29 -43 c-53 -79 -49 -158 12 -235 17 -21 28 -40 26 -42 -2 -3 -33
-12 -69 -21 -71 -18 -230 -15 -269 6 -21 11 -21 11 10 47 61 70 70 153 23 231
-34 58 -35 64 -3 74 33 9 249 3 277 -8z m2553 5 l51 -11 -17 -26 c-66 -101
-63 -191 9 -269 11 -13 18 -25 16 -28 -3 -2 -34 -12 -70 -21 -77 -20 -224 -15
-283 10 l-38 16 35 40 c62 73 68 168 15 243 -11 15 -19 30 -17 32 24 23 214
32 299 14z m1258 0 l49 -12 -29 -47 c-16 -26 -32 -66 -35 -89 -7 -50 17 -118
52 -151 14 -13 25 -27 25 -30 0 -31 -289 -49 -339 -21 l-23 13 25 26 c69 74
76 176 19 257 l-31 45 32 9 c46 13 197 13 255 0z m2580 0 l49 -12 -29 -47
c-16 -25 -31 -62 -34 -81 -8 -49 12 -113 46 -153 17 -18 30 -36 30 -39 0 -2
-21 -11 -47 -18 -70 -20 -257 -18 -307 4 l-39 17 25 28 c64 68 77 163 33 241
-14 24 -23 46 -21 49 22 21 216 29 294 11z m1258 0 c24 -6 44 -13 44 -15 0 -3
-12 -23 -27 -45 -19 -29 -28 -57 -31 -97 -3 -51 0 -63 32 -116 20 -32 34 -61
32 -64 -12 -11 -127 -32 -183 -32 -58 0 -163 17 -163 26 0 2 16 24 35 49 56
74 59 147 9 233 -15 26 -28 49 -28 52 -3 19 212 26 280 9z m-4260 -111 c19
-36 18 -88 -3 -117 -15 -23 -17 -23 -30 -6 -17 25 -17 85 2 112 13 19 13 24
-7 49 l-22 29 23 -20 c13 -11 29 -32 37 -47z m-3824 -31 c5 -28 -3 -66 -19
-92 -13 -20 -13 -20 -28 -1 -19 25 -19 86 -1 112 13 16 13 22 0 44 -10 17 -6
15 15 -8 16 -19 31 -44 33 -55z m7653 46 c27 -41 32 -84 12 -122 -19 -38 -35
-36 -46 5 -8 27 -7 47 4 77 10 28 11 46 4 59 -17 32 -1 19 26 -19z m-9585 -73
c0 -21 -4 -41 -9 -45 -12 -7 -26 59 -17 81 10 26 26 5 26 -36z m650 14 c0 -32
-18 -66 -31 -59 -12 8 -12 51 2 76 13 25 29 15 29 -17z m2540 -14 c0 -45 -15
-61 -24 -25 -8 30 3 77 15 69 5 -3 9 -23 9 -44z m650 7 c0 -41 -14 -66 -24
-42 -8 21 -8 70 0 78 13 13 24 -5 24 -36z m642 -19 c-12 -47 -32 -48 -32 -1 0
45 19 73 32 48 5 -8 5 -29 0 -47z m2548 12 c0 -14 -4 -32 -9 -39 -8 -12 -11
-9 -16 12 -9 36 3 87 16 66 5 -7 9 -25 9 -39z m645 30 c8 -26 -4 -82 -16 -74
-12 7 -12 94 0 94 5 0 13 -9 16 -20z m645 -14 c0 -40 -8 -66 -21 -66 -10 0
-12 60 -3 84 11 28 24 17 24 -18z m-7030 -23 c0 -30 -10 -54 -21 -47 -10 6
-12 77 -2 87 9 10 23 -13 23 -40z m1255 19 c3 -16 2 -39 -4 -53 l-9 -24 -11
28 c-11 29 -5 77 9 77 5 0 11 -13 15 -28z m2581 3 c3 -13 2 -37 -4 -52 l-10
-28 -11 28 c-11 29 -5 77 10 77 5 0 11 -11 15 -25z m1254 -25 c0 -21 -4 -41
-9 -44 -12 -8 -24 48 -16 74 10 31 25 13 25 -30z m2583 23 c3 -15 0 -38 -5
-52 l-10 -26 -10 28 c-10 29 -4 77 11 77 5 0 11 -12 14 -27z m1257 -23 c0 -41
-14 -61 -24 -34 -8 21 -8 69 0 77 14 13 24 -6 24 -43z" />
        </g>
      </svg>
    </svg>
    <div class="head-box">
      <div class="description-part">
        <a href=""
          title="“Zinciri kırma” metodolojisi, hem yeni bir ALIŞKANLIK oluşturmayı hem de zararlı alışkanlıkları bırakmayı destekleyen; bir hedefi her gün küçük adımlarla ilerleterek süreklilik alışkanlığı oluşturmaya odaklanan bir yaklaşımdır. Temeli, yapılan her günlük adımı takvimde bir “X” ile işaretleyip zamanla ortaya çıkan çizgiyi, yani zinciri bozmamaya çalışmak üzerine kuruludur. Psikolojik olarak, beynimiz tamamlanmış işleri görmekten haz duyar ve bu görsel ilerleme motivasyonumuzu artırır. Ayrıca, büyük ve göz korkutucu hedefleri küçük ve yönetilebilir parçalara bölmek; erteleme döngüsünü kırar, BAŞARI hissini sıklaştırır ve süreci daha SÜRDÜRÜLEBİLİR hâle getirir. Bu yüzden yöntem, hem kişisel hem profesyonel hedeflerde odaklanmayı artıran ve alışkanlık kazandırmada oldukça etkili bir sistem olarak bilinir."
          class="question-mark"> <i class="fa-solid fa-clipboard-question"></i>
          <!--uzun title açıklaması yerine href ya da inline page eklenecek--></a>
        <span class="main-title">
          Zinciri Kırma!
        </span>
      </div>
      <div class="visual-buttons">
        <button id="btn-toggle-menu" title="Form kartını / gösterir">▲</button>
        <button id="btn-view" class="switch"
          title="Zincirin görünüm şeklini (kareli tablo veya kıvrımlı yılan) değiştirir">
          <span class="knob">
            <i class="fa-solid fa-table-cells"></i>
          </span>
        </button>
        <button type="button" id="btn-color-settings"><i class="fa-solid fa-palette"
            title="Renk ve tema ayarları panelini açar"></i></button>
      </div>
    </div>
    <hr>
    <br>
    <div class="form-titles">Zincir türü:
      <div class="selections radio-type">
        <label data-aesthetics class="only-for-desktop pad12"></label>
        <label>
          <input type="radio" name="chain-kind" value="dated" checked />
          Takvimli (Klasik Versiyon)
        </label>
        <label data-aesthetics class="only-for-desktop pad12"></label>
        <label data-aesthetics class="only-for-desktop pad12"></label>
        <label>
          <input type="radio" name="chain-kind" value="count" />
          Tarihsiz (Sade Tablo)
        </label>
        <label data-aesthetics class="only-for-desktop pad12"></label>
      </div>
    </div>
    <div break-block></div>
    <div class="basic-box">
      <label class="form-titles">
        Hedefim:
        <input id="chain-name" type="text" maxlength="75" placeholder="Örnek: Her gün 1 saat kitap okuyacağım!" />
        <span id="name-error" class="error-info" style="display: none;"></span>
      </label>
      <label class="form-titles" style="display: none;" id="chain-count-label">
        Halka sayısı:
        <input id="ring-count-input" type="number" min="1" step="1" max="10080" value="37" />
      </label>
      <div class="date-together"> <!-- küçük ekranlarda, aynı anda satır başı yapması için gruplandırılmıştır-->
        <label class="form-titles">
          Başlangıç tarihi:
          <input id="start-date" type="date" />
          <span id="date-errors" class="error-info" style="display: none;"></span>
        </label>
        <label class="form-titles">
          Bitiş tarihi:
          <input id="end-date" type="date" />
        </label>
      </div>
    </div>
    <div class="form-titles" id="weekdays-label">Haftada hangi günler?
      <span id="weekdays-error" class="error-info" style="display: none;"></span>
      <div class="selections" id="weekdays">
        <label data-aesthetics class="only-for-desktop pad12"></label>
        <label>
          <input type="checkbox" id="wd0" checked />
          Pazartesi
        </label>
        <label data-aesthetics class="only-for-desktop pad12"></label>
        <label>
          <input type="checkbox" id="wd1" checked />
          Salı
        </label>
        <label data-aesthetics class="only-for-desktop pad12"></label>
        <label>
          <input type="checkbox" id="wd2" checked />
          Çarşamba
        </label>
        <label data-aesthetics class="only-for-desktop pad12"></label>
        <label>
          <input type="checkbox" id="wd3" checked />
          Perşembe
        </label>
        <label data-aesthetics class="only-for-desktop pad12"></label>
        <label>
          <input type="checkbox" id="wd4" checked />
          Cuma
        </label>
        <label data-aesthetics class="only-for-desktop pad12"></label>
        <label>
          <input type="checkbox" id="wd5" checked />
          Cumartesi
        </label>
        <label data-aesthetics class="only-for-desktop pad12"></label>
        <label>
          <input type="checkbox" id="wd6" checked />
          Pazar
        </label>
        <label data-aesthetics class="only-for-desktop pad12"></label>
        <label>
          <span id="all-selected-note" class="helper-info">
            Varsayılan olarak
            <span style="text-decoration-line: underline">tüm günler</span>
            seçili.
          </span>
        </label>
      </div>
    </div>
    <hr>
    <div class="ring-number-box">
      <strong class="text-total-ring">
        Toplam halka:
      </strong>
      <span id="show-count">
        0
      </span> <span class="parenthesis">
        (zincirin içerdiği gün sayısı)</span>
    </div>
    <div class="size-box">
      <label class="form-titles">Satır:</label>
      <span data-spacer></span>
      <input type="number" id="rows-input" min="1" step="1" max="10080" />
      <span data-aesthetics class="only-for-desktop pad12"></span>
      <span data-spacer class="pad12"></span>
      <span data-aesthetics class="only-for-desktop pad12"></span>
      <label class="form-titles">Sütun:</label>
      <span data-spacer></span>
      <input type="number" id="cols-input" min="1" step="1" max="10080" />
      <span data-aesthetics class="only-for-desktop"></span>
      <span data-spacer class="pad12"></span>
      <span data-aesthetics class="only-for-desktop"></span>
      <span class="helper-info" id="layout-info"></span>
    </div>
    <div class="button-box">
      <button id="btn-add-chain" title="Seçtiğiniz özelliklere göre zincir oluşturmak için hemen tıklayın!">
        <i class="fa-solid fa-plus"></i>
        Zinciri <span data-line-break>oluştur</span>
      </button>
      <span data-spacer></span>
      <button id="btn-load-file" title="Bilgisayarınızdan ana sunucuya dosya aktarımı yapar">
        <i class="fa-solid fa-folder-plus"></i>
        Karşıya <span data-line-break>yükle</span>
      </button>
      <button id="btn-backup-download"
        title="Var olan tüm tabloları veya tema değişikliklerini json formatında aygıtınıza indirir">
        <i class="fa-solid fa-download"></i>
        Yedek <span data-line-break>indir</span>
        <span id="backup-error" class="error-info" style="display: none;"></span>
      </button>
      <button id="btn-reset" title="Formda girilmiş değerlerin hepsini varsayılan haline döndürür">
        <i class="fa-solid fa-broom"></i>
        Temizle
      </button>
      <span data-spacer class="only-for-desktop"></span>
    </div>
  </div>
  <div class="about-me"> <i class="fa-brands fa-github"></i>/<i class="fa-brands fa-instagram"></i>:cuneytinann </div>
  <div id="chain-list"></div> <!-- zincir eklendiğinde sekmelerle, tabloyla her şeyle birlikte burada görünür-->
  <input type="file" id="file-input" accept=".json,application/json" style="display: none" />

  <script type="application/json" id="builtin-themes-json">{
    "gece": {"label": "Gece", "css": ":root {\n  --button-background: rgb(164, 183, 113);\n  --btn-view-effect: rgba(106, 71, 32, 0.5);\n  --btn-delete-effect: rgba(188, 32, 32, 0.5);\n  --chain-month-label: rgb(207, 199, 89);\n  --chain-month-label-bg: rgb(134, 65, 9);\n  --app-card-bd: rgba(142, 140, 87, 0.644);\n  --app-card-bg: rgba(100, 78, 38, 0.575);\n  --chain-border-color: rgb(58, 43, 3);\n  --btn-color-settings-effect: rgba(95, 53, 94, 0.5);\n  --btn-reset-effect: rgba(169, 186, 13, 0.5);\n  --btn-load-file-effect: rgba(201, 92, 3, 0.5);\n  --outer-layer-bg: rgb(0, 0, 0);\n  --outer-scroll-track: rgb(219, 159, 57);\n  --outer-scroll-thumb: rgb(56, 44, 11);\n  --app-card-thumb: rgba(95, 45, 5, 0.8);\n  --btn-backup-download-effect: rgba(34, 162, 22, 0.5);\n  --month-break-bd-color: rgb(38, 104, 8);\n  --year-break-bd-color: rgb(111, 18, 11);\n}\n\n.x-mark {\n  stroke: rgba(38, 34, 34, 0.85);\n}\n\n.chain-title {\n  color: rgb(193, 103, 1);\n}\n\n.chain-tab {\n  color: rgb(186, 198, 93);\n}\n\ninput {\n  background-color: rgb(195, 206, 115);\n  border-color: rgb(169, 99, 20);\n}\n\n.ring-number-box {\n  background-color: rgba(49, 66, 0, 0.34);\n  border-color: rgba(75, 73, 1, 0.62);\n}\n\n#show-count {\n  color: rgb(199, 103, 51);\n}\n\n.parenthesis {\n  color: rgb(187, 162, 93);\n}\n\n.form-titles {\n  color: rgb(0, 0, 0);\n}\n\n#btn-load-file {\n  color: rgb(149, 65, 9);\n  border-color: rgb(162, 89, 22);\n}\n\n.selections label {\n  color: rgb(13, 12, 12);\n  border-color: rgb(188, 107, 32);\n}\n\n.size-box > * {\n  border-color: rgb(175, 118, 18);\n}\n\n.helper-info {\n  color: rgb(182, 191, 59);\n}\n\n#btn-delete {\n  color: rgb(146, 17, 17);\n  border-color: rgb(148, 10, 10);\n}\n\n.chain td.empty-cell {\n  background-color: rgb(29, 15, 2);\n}\n\n.chain tr:first-child > th:not(:first-child) {\n  color: rgb(225, 246, 121);\n  background-color: rgb(16, 60, 33);\n}\n\n.chain tr:first-child > th:first-child {\n  color: rgb(0, 0, 0);\n}\n\n.chain-info {\n  color: rgb(142, 116, 21);\n}\n\n.main-title {\n  color: rgb(119, 3, 3);\n}\n\n.radio-type label:has(input:checked) {\n  color: rgb(170, 166, 60);\n  background-color: rgba(0, 0, 0, 0.5);\n}\n\n#weekdays label:has(input:checked) {\n  color: rgb(201, 202, 109);\n  background-color: rgba(0, 0, 0, 0.5);\n}\n\n.chain td, .circle-cell {\n  color: rgb(74, 79, 8);\n  background-color: rgb(221, 208, 120);\n}\n\n.text-total-ring {\n  color: rgb(43, 143, 15);\n}\n\n#btn-backup-download {\n  color: rgb(38, 95, 27);\n  border-color: rgb(60, 128, 15);\n}\n\n#btn-reset {\n  color: rgb(141, 136, 7);\n  border-color: rgb(180, 174, 4);\n}\n\n#btn-toggle-menu {\n  color: rgb(119, 3, 3);\n  border-color: rgb(87, 0, 0);\n}\n\n#btn-color-settings {\n  border-color: rgb(75, 53, 75);\n}\n\n#btn-view {\n  color: rgb(100, 72, 32);\n  border-color: rgb(101, 61, 37);\n}\n\n.main-frame {\n  background-color: rgba(136, 155, 85, 0.733);\n  border-color: rgba(72, 96, 42, 0.62);\n}\n\nhr {\n  border-color: rgb(143, 77, 15);\n}\n\ninput:focus, input:focus-visible {\n  outline-color: rgb(236, 211, 67)\n}\n\n.input-error {\n  outline-color: rgb(169,15,15)\n}\n\n::-webkit-inner-spin-button {\n  filter: invert(1);\n}\n\n.about-me {\n  color: rgba(231, 201, 65, 0.4);\n}"},
    "matrix": {"label": "Matrix", "css": ".x-mark {\n  stroke: rgba(0, 255, 0, 0.85);\n}\n\n.chain td, .circle-cell {\n  color: rgb(15, 161, 10);\n  background-color: rgb(0, 0, 0);\n}\n\n:root {\n  --chain-border-color: rgb(21, 202, 18);\n  --background-icons: rgba(50, 255, 50, 0.2);\n  --button-background: rgb(0, 0, 0);\n  --btn-view-effect: rgba(55, 255, 0, 0.5);\n  --btn-color-settings-effect: rgba(55, 255, 0, 0.5);\n  --btn-add-chain-effect: rgba(55, 255, 0, 0.5);\n  --btn-load-file-effect: rgba(55, 255, 0, 0.5);\n  --btn-backup-download-effect: rgba(55, 255, 0, 0.5);\n  --btn-reset-effect: rgba(55, 255, 0, 0.5);\n  --btn-delete-effect: rgba(55, 255, 0, 0.5);\n  --app-card-bd: rgba(52, 215, 20, 0.644);\n  --app-card-bg: rgba(0, 0, 0, 0.575);\n  --chain-month-label-bg: rgb(0, 0, 0);\n  --chain-month-label: rgb(11, 214, 37);\n  --btn-toggle-menu-effect: rgba(55,255,0,0.5);\n  --outer-layer-bg: rgb(0, 0, 0);\n  --outer-scroll-track: rgb(0, 0, 0);\n  --outer-scroll-thumb: rgb(20, 185, 28);\n  --app-card-thumb: rgba(0, 255, 0, 0.6);\n  --month-break-bd-color: rgb(0, 255, 0);\n  --year-break-bd-color: rgb(0, 255, 0);\n}\n\n.main-frame {\n  background-color: rgba(0, 0, 0, 0.733);\n  border-color: rgba(19, 181, 8, 0.62);\n}\n\n.main-title {\n  color: rgb(64, 231, 4);\n}\n\nhr {\n  border-color: rgb(55, 255, 0);\n}\n\n.selections label {\n  color: rgb(10, 103, 4);\n  border-color: rgb(52, 255, 26);\n}\n\n#btn-toggle-menu {\n  color: rgb(81, 255, 0);\n  border-color: rgb(85, 242, 28);\n}\n\n#btn-view {\n  color: rgb(81, 255, 0);\n  border-color: rgb(85, 242, 28);\n}\n\n#btn-color-settings {\n  color: rgb(81, 255, 0);\n  border-color: rgb(85, 242, 28);\n}\n\n#btn-add-chain {\n  color: rgb(81, 255, 0);\n  border-color: rgb(85, 242, 28);\n}\n\n#btn-load-file {\n  color: rgb(81, 255, 0);\n  border-color: rgb(85, 242, 28);\n}\n\n#btn-backup-download {\n  color: rgb(81, 255, 0);\n  border-color: rgb(85, 242, 28);\n}\n\n#btn-reset {\n  color: rgb(81, 255, 0);\n  border-color: rgb(85, 242, 28);\n}\n\n#btn-delete {\n  color: rgb(81, 255, 0);\n  border-color: rgb(85, 242, 28);\n}\n\n.chain-title {\n  color: rgb(35, 201, 13);\n}\n\n.chain-info {\n  color: rgb(38, 132, 26);\n}\n\n.chain-tab {\n  color: rgb(0, 255, 8);\n}\n\n.chain tr:first-child > th:not(:first-child) {\n  background-color: rgb(0, 0, 0);\n  color: rgb(37, 214, 11);\n}\n\n.chain tr:first-child > th:first-child {\n  color: rgb(17, 120, 17);\n}\n\n.chain td.empty-cell {\n  background-color: rgb(0, 0, 0);\n  border-color: rgb(0, 0, 0);\n}\n\n.text-total-ring {\n  color: rgb(85,225,9);\n}\n\n#show-count {\n  color: rgb(30, 255, 0);\n}\n\n.parenthesis {\n  color: rgb(47, 162, 32);\n}\n\n.ring-number-box {\n  background-color: rgba(0, 0, 0, 0.34);\n  border-color: rgba(61, 214, 31, 0.62);\n}\n\n.helper-info {\n  color: rgb(25, 210, 31);\n}\n\n.size-box > * {\n  border-color: rgb(61, 255, 68);\n}\n\n.radio-type label:has(input:checked) {\n  color: rgb(0, 255, 0);\n  background-color: rgba(10, 75, 0, 0.5);\n}\n\n#weekdays label:has(input:checked) {\n  color: rgb(15, 255, 15);\n  background-color: rgba(3, 10, 0, 0.5);\n}\n\ninput {\n  color: rgb(3, 204, 0);\n  background-color: rgb(3, 10, 0);\n  border-color: rgb(18, 105, 7);\n}\n\n.error-info {\n  color: rgb(0, 255, 0);\n  background-color: rgb(0, 0, 0);\n  border-color: rgb(94, 255, 36);\n}\n\n.form-titles {\n  color: rgb(48, 225, 20);\n}\n\n#btn-toggle-menu:active {\n  background-color: var(--btn-toggle-menu-effect);\n}\n\n#btn-view .knob {\n  background-color: rgb(47, 97, 41);\n}\n\n.input-error {\n  outline-color: rgb(0, 255, 13);\n}\n\ninput:focus, input:focus-visible {\n  outline-color: rgb(0, 255, 13);\n  color: rgb(3, 204, 0);\n  background-color: rgb(3, 10, 0);\n  border-color: rgb(0, 218, 91);\n}\n\n::placeholder {\n  color: rgb(16, 214, 16);\n  opacity: 1;\n}\n\n::-webkit-calendar-picker-indicator {\n  filter: invert(48%) sepia(79%) saturate(451%) hue-rotate(90deg) brightness(95%) contrast(95%);\n}\n\n::-webkit-inner-spin-button {\n  filter: invert(1);\n}\n\n:not(i):not(#theme-panel):not(#theme-panel *) {\n  font-family: \"Courier New\", Courier, monospace;\n}\n\n.size-box .form-titles, .month-label, .main-title {\n  letter-spacing: -0.15ch;\n}"},
    "karanlik": {"label": "Karanlık", "css": ":root {\n  --outer-layer-bg: rgb(39, 37, 37);\n  --chain-border-color: rgb(108, 101, 101);\n  --chain-month-label: rgb(202, 68, 68);\n  --chain-month-label-bg: rgb(0, 0, 0);\n  --app-card-bd: rgba(34, 76, 16, 0.644);\n  --app-card-bg: rgba(17, 70, 6, 0.575);\n  --year-break-bd-color: rgb(240, 112, 112);\n  --month-break-bd-color: rgb(101, 177, 215);\n  --app-card-thumb: rgba(55, 154, 55, 0.603);\n  --outer-scroll-thumb: rgb(62, 84, 101);\n  --outer-scroll-track: rgba(16, 40, 60, 0.7);\n  --background-icons: rgba(203, 175, 175, 0.2);\n  --button-background: rgb(13, 13, 13);\n  --btn-view-effect: rgba(206, 117, 34, 0.5);\n  --btn-color-settings-effect: rgba(210, 65, 210, 0.5);\n  --btn-add-chain-effect: rgba(87, 87, 87, 0.5);\n  --btn-load-file-effect: rgba(41, 64, 87, 0.5);\n  --btn-backup-download-effect: rgba(73, 114, 70, 0.5);\n  --btn-reset-effect: rgba(85, 94, 8, 0.5);\n  --btn-delete-effect: rgba(157, 42, 42, 0.5);\n}\n\n::placeholder {\n  color: rgb(197, 180, 180);\n}\n\n::-webkit-calendar-picker-indicator {\n  filter: invert(1);\n}\n\n.chain td, .circle-cell {\n  color: rgb(205, 193, 193);\n  background-color: rgb(31, 30, 30);\n}\n\n.chain tr:first-child > th:not(:first-child) {\n  color: rgb(104, 104, 223);\n  background-color: rgb(0, 0, 0);\n}\n\nhr {\n  border-color: rgb(126, 134, 133);\n}\n\n.form-titles {\n  color: rgb(255, 255, 240);\n}\n\n.chain td.empty-cell {\n  background-color: rgb(15, 15, 15);\n}\n\n.x-mark {\n  stroke: rgba(102, 0, 0, 0.85);\n}\n\n.chain tr:first-child > th:first-child {\n  color: rgb(92, 155, 75);\n}\n\n.chain-title {\n  color: rgb(105, 176, 206);\n}\n\n.chain-info {\n  color: rgb(77, 128, 124);\n}\n\n.chain-tab {\n  color: rgb(75, 170, 91);\n}\n\n.main-frame {\n  background-color: rgba(63, 85, 80, 0.733);\n  border-color: rgba(74, 85, 94, 0.62);\n}\n\n.main-title {\n  color: rgb(255, 82, 82);\n}\n\n#btn-toggle-menu {\n  color: rgb(255, 82, 82);\n  border-color: rgb(255, 82, 82);\n}\n\n#btn-view {\n  color: rgb(255, 148, 87);\n  border-color: rgb(255, 148, 87);\n}\n\n#btn-color-settings {\n  color: rgb(255, 143, 255);\n  border-color: rgb(255, 143, 255);\n}\n\n#btn-add-chain {\n  color: rgb(171, 171, 171);\n  border-color: rgb(255, 255, 255);\n}\n\n#btn-load-file {\n  color: rgb(99, 100, 171);\n  border-color: rgb(148, 150, 255);\n}\n\n#btn-backup-download {\n  color: rgb(105, 171, 61);\n  border-color: rgb(157, 255, 92);\n}\n\n#btn-reset {\n  color: rgb(171, 164, 65);\n  border-color: rgb(255, 244, 97);\n}\n\n#btn-delete {\n  color: rgb(171, 68, 68);\n  border-color: rgb(255, 102, 102);\n}\n\ninput {\n  color: rgb(197, 180, 180);\n  background-color: rgb(26, 26, 26);\n  border-color: rgb(110, 110, 110);\n}\n\n.selections label {\n  color: rgb(242, 212, 212);\n  border-color: rgb(182, 175, 175);\n}\n\n.size-box > * {\n  border-color: rgb(190, 177, 178);\n}\n\n.ring-number-box {\n  background-color: rgba(154, 200, 208, 0.34);\n  border-color: rgba(146, 193, 217, 0.62);\n}\n\n.text-total-ring {\n  color: rgb(113, 57, 20);\n}\n\n#show-count {\n  color: rgb(0, 0, 0);\n}\n\n.radio-type label:has(input:checked) {\n  color: rgb(112, 177, 194);\n  background-color: rgba(104, 115, 120, 0.5);\n}\n\n#weekdays label:has(input:checked) {\n  color: rgb(93, 205, 71);\n  background-color: rgba(102, 133, 106, 0.5);\n}\n\n.helper-info {\n  color: rgb(207, 212, 140);\n}\n\n.error-info {\n  color: rgb(163, 15, 15);\n  background-color: rgb(219, 219, 107);\n  border-color: rgb(185, 24, 24);\n}\n\n.parenthesis {\n  color: rgb(110, 7, 107);\n}\n\ninput:focus, input:focus-visible {\n  outline-color: rgb(21, 193, 44);\n}\n\n.input-error {\n  outline-color: rgb(170, 3, 3);\n}"}
  }</script>
  <script>
    (function () {

      'use strict';

      // Ana frame ve form elemanları
      var mainFrame = qs('#main-frame');
      var modeRadios = document.getElementsByName('chain-kind');
      var toggleMenu = qs('#btn-toggle-menu');
      var chainName = qs('#chain-name');
      var nameError = qs('#name-error');
      var chainCountLabel = qs('#chain-count-label');
      var chainCount = qs('#ring-count-input');
      var startDate = qs('#start-date');
      var dateErrors = qs('#date-errors');
      var endDate = qs('#end-date');
      var weekdaysLabel = qs('#weekdays-label');
      var weekdaysError = qs('#weekdays-error');
      var weekdays = qs('#weekdays');
      var showCount = qs('#show-count');
      var rowsInput = qs('#rows-input');
      var colsInput = qs('#cols-input');
      var layoutInfo = qs('#layout-info');
      var btnAddChain = qs('#btn-add-chain');
      var btnLoadFile = qs('#btn-load-file');
      var btnBackupDownload = qs('#btn-backup-download');
      var backupError = qs('#backup-error');
      var btnReset = qs('#btn-reset');
      var btnView = qs('#btn-view');

      var chainList = qs('#chain-list');
      var fileInput = qs('#file-input');

      // Global durum değişkenleri
      var activeChainId = null;
      var currentKind = 'dated'; // 'dated' | 'count'
      // Görünüm modu: 'table' | 'snake'
      var viewMode = 'table';
      var MAX_RINGS = 10080;     // Global halka üst limiti
      var n = 0;                 // Toplam halka sayısı
      var cols = 1;
      var rows = 1;
      var currentDates = [];     // Tarihli mod için aktif tarih listesi
      var hasValidationTriggered = false;
      var errorHideTimeout = null;
      var lastTrigger = null;

      // Haftanın gün isimleri (Pazartesi bazlı index)
      const DAY_NAMES = [
        'Pazartesi',
        'Salı',
        'Çarşamba',
        'Perşembe',
        'Cuma',
        'Cumartesi',
        'Pazar',
      ];

      /* ---------------- CONFIG ---------------- */
      /* IDLER satır sırasını belirlemez, Aynı ID çakışma yaratmaz. Sadece override için ID önem taşır */
      /* IDLER override yaparken önem taşır. O yüzden override tablosuyla birebir eşleşmelidir */
      /* fieldslar text,bd,bg ve info anlamlıdır. infoyla diğer özellikler aynı anda bulunamaz */
      // Ara başlık veya bilgilendirmeler fieldsa 'info' flagı ile eklenebilir
      const COLOR_ROWS = [
        { id: '01', label: 'Uygulama Kartı Renk Düzeni', fields: 'sub' },
        { id: '02', label: 'X İşareti Dolgusu', selector: '.x-mark', fields: ['text'] },
        { id: '03', label: 'Tüm Halkalar', selector: '.chain td, .circle-cell', fields: ['text', 'bd', 'bg'] },
        { id: '04', label: 'Satır Başlıkları', selector: ':root', fields: ['text', 'bg'] },
        { id: '05', label: 'Sütun Başlıkları', selector: '.chain tr:first-child > th:not(:first-child)', fields: ['text', 'bg'] },
        { id: '06', label: 'Yıl Metni', selector: '.chain tr:first-child > th:first-child', fields: ['text'] },
        { id: '07', label: 'Boş Hücre', selector: '.chain td.empty-cell', fields: ['bg'] },
        { id: '08', label: 'Ay Geçişi Belirteç', selector: ':root', fields: ['bd'] },
        { id: '09', label: 'Yıl Geçişi Belirteç', selector: ':root', fields: ['bd'] },
        { id: '10', label: 'Zincir Başlığı', selector: '.chain-title', fields: ['text'] },
        { id: '11', label: 'Zincir Bilgileri', selector: '.chain-info', fields: ['text'] },
        { id: '12', label: 'Uygulama Kartı', selector: ':root', fields: ['text', 'bd', 'bg'] },
        { id: '13', label: 'Uygulama Sekmesi', selector: '.chain-tab', fields: ['text'] },

        { id: '14', label: 'Not: Uygulama Kartının ve En Dış Katmanının kaydırma çubuğu, İkon alan adı altında eklenmiştir. En Dış Katmanda ek olarak, Çerçeve alan adı altında kaydırma çubuğunun hat rengi ayarlanabilir.', fields: 'warn' },

        { id: '15', label: 'Menü Forum Kartı Renk Düzeni', fields: 'sub' },
        { id: '16', label: 'En Dış Katman', selector: ':root', fields: ['text', 'bd', 'bg'] },
        { id: '17', label: 'Menü Kartı', selector: '.main-frame', fields: ['bd', 'bg'] },
        { id: '18', label: 'Arka Plan İkonları', selector: ':root', fields: ['text'] },
        { id: '19', label: 'Ana Başlık', selector: '.main-title', fields: ['text'] },
        { id: '20', label: 'Menü Bölme Çizgileri', selector: 'hr', fields: ['bd'] },
        { id: '21', label: 'Form Başlıkları', selector: '.form-titles', fields: ['text'] },
        { id: '22', label: 'Seçmeli Girdiler (GENEL)', selector: '.selections label', fields: ['text', 'bd'] },
        { id: '23', label: 'Türün Seçilmiş Hali', selector: '.radio-type label:has(input:checked)', fields: ['text', 'bg'] },
        { id: '24', label: 'Form Girdileri', selector: 'input', fields: ['text', 'bd', 'bg'] },
        { id: '25', label: 'Form Girdi Odak Efekti', selector: 'input:focus, input:focus-visible', fields: ['bd'] },
        { id: '26', label: 'Form Girdi Hata Efekti', selector: '.input-error', fields: ['bd'] },
        { id: '27', label: 'Hata Kutucukları', selector: '.error-info', fields: ['text', 'bd', 'bg'] },
        { id: '28', label: 'Ek Bilgi Kutusu', selector: '.helper-info', fields: ['text'] },
        { id: '29', label: 'Günlerin Seçilmiş Hali', selector: '#weekdays label:has(input:checked)', fields: ['text', 'bg'] },
        { id: '30', label: 'Halka Sayacı', selector: '.ring-number-box', fields: ['bd', 'bg'] },
        { id: '31', label: 'Toplam Halka Yazısı', selector: '.text-total-ring', fields: ['text'] },
        { id: '32', label: 'Sayı Göstergesi', selector: '#show-count', fields: ['text'] },
        { id: '33', label: 'Parantez Bilgi', selector: '.parenthesis', fields: ['text'] },
        { id: '34', label: 'Satır / Sütun Girdileri', selector: '.size-box > *', fields: ['bd'] },

        { id: '35', label: 'Tüm Butonlar', fields: 'sub' },
        { id: '36', label: 'Butonlar Arka Plan', selector: ':root', fields: ['bg'] },
        { id: '37', label: 'Not: Özel butonlar için arka plan rengi demek, tıklama veya üzerine gelince beliren efekttir. Değişikliğin gözlemi için ilgili butonla işlem yapın.', fields: 'warn' },

        { id: '38', label: 'Menü Daraltma Düğmesi', selector: '#btn-toggle-menu', fields: ['text', 'bd'] },
        { id: '39', label: 'Görünüm Düğmesi', selector: '#btn-view', fields: ['text', 'bd', 'bg'] },
        // Renk yarı butonu ikonu - butonların genel arka planından geldiği için harici edildi.
        { id: '40', label: 'Renk ve Tema Ayarı Butonu ;)', selector: '#btn-color-settings', fields: ['bd', 'bg'] },
        { id: '41', label: 'Zinciri Oluştur Butonu', selector: '#btn-add-chain', fields: ['text', 'bd', 'bg'] },
        { id: '42', label: 'Karşıya Yükle Butonu', selector: '#btn-load-file', fields: ['text', 'bd', 'bg'] },
        { id: '43', label: 'Yedek İndir Butonu', selector: '#btn-backup-download', fields: ['text', 'bd', 'bg'] },
        { id: '44', label: 'Temizle Butonu', selector: '#btn-reset', fields: ['text', 'bd', 'bg'] },
        { id: '45', label: 'Zinciri Sil Butonu', selector: '#btn-delete', fields: ['text', 'bd', 'bg'] },
      ];

      // id → field → partial override
      const FIELD_OVERRIDES = {
        // svg rengi farklı attribute
        '02': { text: { prop: 'stroke' } },
        // th hücrelerini de kapsaması için override edilmiştir 
        '03': { bd: { selector: ':root', prop: '--chain-border-color' } },
        '04': { text: { prop: '--chain-month-label' }, bg: { prop: '--chain-month-label-bg' } },
        '08': { bd: { prop: '--month-break-bd-color' } },
        // --- TEK TARAFLI BORDERLAR ---
        '09': { bd: { prop: '--year-break-bd-color' } },
        '12': { text: { prop: '--app-card-thumb' }, bd: { prop: '--app-card-bd' }, bg: { prop: '--app-card-bg' } },
        '16': { text: { prop: '--outer-scroll-thumb' }, bd: { prop: '--outer-scroll-track' }, bg: { prop: '--outer-layer-bg' } },
        '18': { text: { prop: '--background-icons' } },

        '25': { bd: { prop: 'outline-color' } },
        '26': { bd: { prop: 'outline-color' } },

        '36': { bg: { prop: '--button-background' } },
        // BUTON EFEKTLERİ - :active veya :hover
        '39': { bg: { selector: ':root', prop: '--btn-view-effect' } },
        '40': { bg: { selector: ':root', prop: '--btn-color-settings-effect' } },
        '41': { bg: { selector: ':root', prop: '--btn-add-chain-effect' } },
        '42': { bg: { selector: ':root', prop: '--btn-load-file-effect' } },
        '43': { bg: { selector: ':root', prop: '--btn-backup-download-effect' } },
        '44': { bg: { selector: ':root', prop: '--btn-reset-effect' } },
        '45': { bg: { selector: ':root', prop: '--btn-delete-effect' } },

      };

      // STORAGE_KEY moved to THEME STYLE LAYERS (v2)

      /* ---------------- UTIL: Color parse/format ---------------- */
      function clamp255(n) { n = Number(n); return Number.isFinite(n) ? Math.max(0, Math.min(255, Math.round(n))) : 0; }
      function clamp01(n) { n = Number(n); return Number.isFinite(n) ? Math.max(0, Math.min(1, n)) : 1; }

      function hexToRgb(hex) {
        const h = String(hex).trim().replace('#', '');
        if (h.length !== 6) return { r: 0, g: 0, b: 0 };
        return {
          r: parseInt(h.slice(0, 2), 16),
          g: parseInt(h.slice(2, 4), 16),
          b: parseInt(h.slice(4, 6), 16)
        };
      }
      function rgbToHex({ r, g, b }) {
        const rr = clamp255(r).toString(16).padStart(2, '0');
        const gg = clamp255(g).toString(16).padStart(2, '0');
        const bb = clamp255(b).toString(16).padStart(2, '0');
        return `#${rr}${gg}${bb}`;
      }

      // Returns { rgb:{r,g,b}, a:number, kind:'rgb'|'rgba'|'transparent'|'nonRGB'|'undefined' }
      function parseCssColor(value) {
        if (value == null) return { rgb: { r: 0, g: 0, b: 0 }, a: 1, kind: 'undefined' };
        const v = String(value).trim().toLowerCase();
        if (!v) return { rgb: { r: 0, g: 0, b: 0 }, a: 1, kind: 'undefined' };
        if (v === 'transparent') return { rgb: { r: 0, g: 0, b: 0 }, a: 0, kind: 'transparent' };

        const rgbaMatch = v.match(/^rgba\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*\)$/);
        if (rgbaMatch) {
          const r = clamp255(rgbaMatch[1]);
          const g = clamp255(rgbaMatch[2]);
          const b = clamp255(rgbaMatch[3]);
          const a = clamp01(rgbaMatch[4]);
          return { rgb: { r, g, b }, a, kind: 'rgba' };
        }

        const rgbMatch = v.match(/^rgb\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*\)$/);
        if (rgbMatch) {
          const r = clamp255(rgbMatch[1]);
          const g = clamp255(rgbMatch[2]);
          const b = clamp255(rgbMatch[3]);
          return { rgb: { r, g, b }, a: 1, kind: 'rgb' };
        }

        // canvastext/currentColor/others: UI’de siyah göstereceğiz ama semantiği "other/undefined" olarak tutacağız
        return { rgb: { r: 0, g: 0, b: 0 }, a: 1, kind: 'nonRGB' };
      }

      function formatCssColor(rgb, a) {
        if (a == null) a = 1;
        a = clamp01(a);
        const r = clamp255(rgb.r), g = clamp255(rgb.g), b = clamp255(rgb.b);
        if (a < 1) return `rgba(${r}, ${g}, ${b}, ${a})`;
        return `rgb(${r}, ${g}, ${b})`;
      }

      function sameRgb(a, b) {
        return clamp255(a.r) === clamp255(b.r) && clamp255(a.g) === clamp255(b.g) && clamp255(a.b) === clamp255(b.b);
      }

      /* ---------------- UTIL: CSSOM parse from style element ---------------- */
      function normalizeSelectorText(s) {
        // minimal normalization: trim + collapse spaces + normalize comma spacing
        return String(s)
          .trim()
          .replace(/\s+/g, ' ')
          .replace(/\s*,\s*/g, ', ');
      }

      // Parse a <style> element into map: selector -> { prop: value }
      function parseStyleElement(styleEl) {
        const map = new Map();
        if (!styleEl) return map;

        // Create a temporary stylesheet by injecting text to a new <style> to reliably access cssRules
        const tmp = document.createElement('style');
        tmp.textContent = styleEl.textContent || '';
        document.head.appendChild(tmp);

        let rules = [];
        try { rules = Array.from(tmp.sheet?.cssRules || []); } catch { rules = []; }
        for (const rule of rules) {
          if (!rule || rule.type !== CSSRule.STYLE_RULE) continue;
          const sel = normalizeSelectorText(rule.selectorText || '');
          if (!sel) continue;
          const decl = {};
          for (let i = 0; i < rule.style.length; i++) {
            const prop = rule.style[i];
            decl[prop] = rule.style.getPropertyValue(prop).trim();
          }
          // FIX (bd): border-color bazen CSSOM enumerate edilmez; yine de varsayılanı doğru okumak için manuel çek
          const bc = rule.style.getPropertyValue('border-color').trim();
          if (bc && !decl['border-color']) {
            decl['border-color'] = bc;
          }

          // merge if repeated selectors
          const prev = map.get(sel) || {};
          map.set(sel, { ...prev, ...decl });
        }

        tmp.remove();
        return map;
      }

      // Parse raw CSS text (theme overrides) into map
      function parseCssText(cssText) {
        const styleEl = document.createElement('style');
        styleEl.textContent = cssText || '';
        document.head.appendChild(styleEl);
        const map = parseStyleElement(styleEl);
        styleEl.remove();
        return map;
      }

      // Build CSS text from map: selector -> {prop: value}
      function buildCssText(map) {
        const blocks = [];
        for (const [selector, decl] of map.entries()) {
          const props = Object.entries(decl)
            .filter(([_, v]) => v != null && String(v).trim() !== '')
            .map(([k, v]) => `  ${k}: ${v};`);
          if (!props.length) continue;
          blocks.push(`${selector} {\n${props.join('\n')}\n}`);
        }
        return blocks.join('\n\n');
      }


function mergeMaps(a, b) {
  const out = new Map();
  for (const [k, v] of (a || new Map()).entries()) out.set(k, { ...v });
  for (const [k, v] of (b || new Map()).entries()) {
    const prev = out.get(k) || {};
    out.set(k, { ...prev, ...v });
  }
  return out;
}

      /* ---------------- PROPERTY RESOLUTION ---------------- */
      /* ---------------- TARGET RESOLUTION (selector + property) ---------------- */

      // sabit field->property map (bg/border/text)
      function defaultPropForField(field) {
        if (field === 'bg') return 'background-color';
        if (field === 'bd') return 'border-color';
        if (field === 'text') return 'color';
        return field; // gelecekte yeni bir field gelirse doğrudan property sayılabilir
      }
      function getFieldOverride(rowId, field) {
        return FIELD_OVERRIDES[rowId]?.[field] || null;
      }

      /**
       * Tüm sistemin tek kaynağı:
       * - bg/bd/text => row.selector + sabit map
       * - excp          => Exceptions[id] => {selector, property}
       */
      function resolveTargetForCell(row, field) {
        const baseSelector = row.selector || null;
        const baseProp = defaultPropForField(field);

        const ov = getFieldOverride(row.id, field);

        if (!baseSelector && !ov) return null;

        return {
          selector: ov?.selector ?? baseSelector,
          prop: ov?.prop ?? baseProp
        };
      }


      /* ---------------- THEME STYLE LAYERS ---------------- */
function ensureStyleEl(id) {
  let el = document.getElementById(id);
  if (!el) {
    el = document.createElement('style');
    el.id = id;
    document.head.appendChild(el);
  }
  return el;
}

// Layer order (low -> high):
// 1) base-theme-style (inline default in HTML)
// 2) theme-base-style (selected preset base)
// 3) theme-overrides-style (user overrides, persisted)
// 4) theme-preview-style (panel live preview)
const baseThemeStyleEl = ensureStyleEl('theme-base-style');
const themeStyleEl = ensureStyleEl('theme-overrides-style');
const previewStyleEl = ensureStyleEl('theme-preview-style');

// Storage keys (v2)
const THEME_BASE_KEY = 'theme_base_v2';              // 'default' | 'gece' | 'karanlik' | 'matrix'
const STORAGE_KEY = 'theme_overrides_css_v2';        // override CSS only
const LEGACY_OVERRIDES_KEY = 'theme_css_overrides_v1'; // legacy (used to store full preset css)

function getStoredBaseTheme() {
  const v = (localStorage.getItem(THEME_BASE_KEY) || 'default').trim();
  return v || 'default';
}
function setStoredBaseTheme(baseId) {
  const b = (baseId || 'default').trim() || 'default';
  if (b === 'default') localStorage.removeItem(THEME_BASE_KEY);
  else localStorage.setItem(THEME_BASE_KEY, b);
}

function loadThemeFromStorage() {
  const css = (localStorage.getItem(STORAGE_KEY) || '').trim();
  themeStyleEl.textContent = css;
  return css;
}
function saveThemeToStorage(css) {
  localStorage.setItem(STORAGE_KEY, (css || '').trim());
}
function clearThemeStorage() {
  localStorage.removeItem(STORAGE_KEY);
}

// Built-in theme presets (inline JSON in HTML)
function readBuiltinThemes() {
  const el = document.getElementById('builtin-themes-json');
  if (!el) return {};
  try {
    const obj = JSON.parse(el.textContent || '{}');
    return obj && typeof obj === 'object' ? obj : {};
  } catch (e) {
    console.warn('Built-in themes JSON parse error:', e);
    return {};
  }
}
const BUILTIN_THEMES = readBuiltinThemes();

function recomputeBaseMap() {
  // baseMap = inline default + selected preset base
  const baseInlineEl = document.getElementById('base-theme-style');
  const basePresetEl = document.getElementById('theme-base-style');
  baseMap = mergeMaps(
    parseStyleElement(baseInlineEl),
    parseStyleElement(basePresetEl)
  );
}

function setPresetSelectToBaseOnly() {
  // Override yokmuş gibi "baz tema"ya dönmüş görünmeli
  try {
    const presetSel = document.getElementById('theme-preset-select');
    if (!presetSel) return;
    const baseId = getStoredBaseTheme();
    if (baseId && baseId !== 'default') presetSel.value = baseId;
    else presetSel.value = '__default__';
  } catch { }
}

function setPresetSelectToCurrentState() {
  // Overrides varsa "Mevcut (Özel)", yoksa baz temaya göre.
  try {
    const presetSel = document.getElementById('theme-preset-select');
    if (!presetSel) return;
    const baseId = getStoredBaseTheme();
    const hasOverrides = ((themeStyleEl.textContent || '').trim().length > 0);
    if (hasOverrides) presetSel.value = '__current__';
    else if (baseId && baseId !== 'default') presetSel.value = baseId;
    else presetSel.value = '__default__';
  } catch { }
}

function applyBaseTheme(baseId) {
  const b = (baseId || 'default').trim() || 'default';

  if (b === 'default') {
    baseThemeStyleEl.textContent = '';
    setStoredBaseTheme('default');
  } else {
    const entry = BUILTIN_THEMES[b];
    if (!entry || !entry.css) {
      // geçersiz bir base id kaldıysa güvenli şekilde varsayılana dön
      baseThemeStyleEl.textContent = '';
      setStoredBaseTheme('default');
    } else {
      baseThemeStyleEl.textContent = String(entry.css);
      setStoredBaseTheme(b);
    }
  }

  // base değişti: baseMap'i yeniden üret ve panel açıksa inputları yeni effective değere çek
  recomputeBaseMap();

  // state’i sıfırla (baz değişti; eski baseRgb’ler geçersiz)
  cellState?.clear?.();
  clearPreview?.();

  if (typeof tableEl !== 'undefined' && tableEl) {
    renderTable();
    refreshInputsFromEffective();
  }
}

function migrateLegacyThemeIfNeeded() {
  // Legacy: v1 key'de bazen preset css komple saklanıyordu.
  // v2 yoksa, legacy varsa ve eşleşen preset bulunursa onu base'e çevir.
  const hasV2 = (localStorage.getItem(STORAGE_KEY) || '').trim().length > 0 || localStorage.getItem(THEME_BASE_KEY);
  if (hasV2) return;

  const legacyCss = (localStorage.getItem(LEGACY_OVERRIDES_KEY) || '').trim();
  if (!legacyCss) return;

  let matchedBase = null;
  for (const [k, v] of Object.entries(BUILTIN_THEMES)) {
    if (!v || !v.css) continue;
    if (String(v.css).trim() === legacyCss) {
      matchedBase = k;
      break;
    }
  }

  if (matchedBase) {
    applyBaseTheme(matchedBase);
    // overrides boş kalsın
    saveThemeToStorage('');
    themeStyleEl.textContent = '';
  } else {
    // match edemedik: varsayılan base + overrides olarak taşı
    applyBaseTheme('default');
    saveThemeToStorage(legacyCss);
    themeStyleEl.textContent = legacyCss;
  }

  // legacy key'i temizle (isterseniz tutabilirsiniz)
  try { localStorage.removeItem(LEGACY_OVERRIDES_KEY); } catch { }
}

function applyThemeFromStorage() {
  migrateLegacyThemeIfNeeded();
  applyBaseTheme(getStoredBaseTheme());
  const css = loadThemeFromStorage();
  // aktif map’leri güncelle
  themeMap = parseCssText(css);
}

function applyThemeOverridesCss(cssText) {
  const css = (cssText || '').trim();
  themeStyleEl.textContent = css;

  if (css) saveThemeToStorage(css);
  else {
    clearThemeStorage();
    saveThemeToStorage(''); // bazı tarayıcılarda key’in boş kalması tercih edilebilir
  }

  // aktif map’leri güncelle
  themeMap = parseCssText(css);

  // panelin "reset-all cancel" snapshot’ı artık yeni override olmalı
  initialThemeCssSnapshot = css;
  pendingResetAll = false;

  // state’i sıfırla (yeni override ile effective değerler değişti)
  cellState.clear();
  clearPreview();
  renderTable();
  refreshInputsFromEffective();
  setPresetSelectToCurrentState();
}

/* ---------------- PANEL UI ---------------- */
      var panelEl = null;
      var tableEl = null;
      var bodyEl = null;

      var baseMap = null;     // original CSS map
      var themeMap = null;    // current theme overrides map
      var previewMap = new Map();

      var initialThemeCssSnapshot = ''; // varsayılanlara dön iptali için
      var pendingResetAll = false;

      // per-cell state: key = `${rowId}::${field}`
      var cellState = new Map();

      function cellKey(rowId, field) { return `${rowId}::${field}`; }

      function getDecl(map, selector) {
        return map.get(normalizeSelectorText(selector)) || null;
      }
      function getEffectiveRawValue(row, field) {
        const target = resolveTargetForCell(row, field);
        if (!target) return ''; // hedef yoksa tanımsız

        const selector = normalizeSelectorText(target.selector);
        const prop = target.prop;

        // Preview > Added > Base > semantic default
        const pDecl = getDecl(previewMap, selector);
        if (pDecl && prop in pDecl) return pDecl[prop];

        const tDecl = getDecl(themeMap, selector);
        if (tDecl && prop in tDecl) return tDecl[prop];

        const bDecl = getDecl(baseMap, selector);
        if (bDecl && prop in bDecl) return bDecl[prop];

        // semantic defaults (string)
        if (prop === 'background-color') return 'transparent';
        if (prop === 'border-color') return 'currentColor';
        if (prop === 'color') return 'canvastext';
        return '';
      }
      function initCellState(row, field) {
        const key = cellKey(row.id, field);

        const target = resolveTargetForCell(row, field);
        if (!target) return null;

        const raw = getEffectiveRawValue(row, field);
        const parsed = parseCssColor(raw);

        const baseRgb = { ...parsed.rgb };

        let a = parsed.a;
        if (parsed.kind === 'nonRGB') a = 1;

        const st = {
          rowId: row.id,
          selector: normalizeSelectorText(target.selector),
          field,
          prop: target.prop,
          baseRgb,
          rgb: { ...parsed.rgb },
          a,
          touched: false
        };

        cellState.set(key, st);
        return st;
      }
      function setPreviewValue(row, field, rgb) {
        const target = resolveTargetForCell(row, field);
        if (!target) return;

        const selector = normalizeSelectorText(target.selector);
        const prop = target.prop;

        const st = cellState.get(cellKey(row.id, field));
        const a = st?.a ?? 1;

        const decl = previewMap.get(selector) || {};
        decl[prop] = formatCssColor(rgb, a);
        previewMap.set(selector, decl);

        previewStyleEl.textContent = buildCssText(previewMap);
      }

      function clearPreview() {
        previewMap = new Map();
        previewStyleEl.textContent = '';
      }

      function applyResetAllPreview() {
  // "Varsayılanlara dön": mevcut baz temaya (varsayılan/gece/karanlık/matrix) dönmek demek.
  // Yani override’ları yokmuş gibi davranacağız; base değişmeyecek.
  clearPreview();
  pendingResetAll = true;

  // UI: artık "Özel" değil, baz tema seçili görünsün
  setPresetSelectToBaseOnly();

  // UI’de effective değer base+semantic olacak; inputları o hale getir
  refreshInputsFromEffective();
}

      function refreshInputsFromEffective() {
        // tüm inputları effective değere (pendingResetAll varsa theme yok sayılarak) döndür
        for (const row of COLOR_ROWS) {
          for (const field of row.fields) {
            const key = cellKey(row.id, field);
            const input = document.querySelector(`input[data-cell="${key}"]`);
            const codeSpan = document.querySelector(`span[data-code="${key}"]`);
            if (!input) continue;

            // pendingResetAll true ise Theme katmanı yok sayılır: geçici olarak themeMap'i boş map gibi düşün
            const savedThemeMap = themeMap;
            const tempThemeMap = pendingResetAll ? new Map() : themeMap;
            const target = resolveTargetForCell(row, field);
            if (!target) continue;

            const selector = normalizeSelectorText(target.selector);
            const prop = target.prop;

            const pDecl = getDecl(previewMap, selector);
            const raw =
              (pDecl && prop in pDecl) ? pDecl[prop] :
                (() => {
                  const tDecl = getDecl(tempThemeMap, selector);
                  if (tDecl && prop in tDecl) return tDecl[prop];
                  const bDecl = getDecl(baseMap, selector);
                  if (bDecl && prop in bDecl) return bDecl[prop];
                  if (prop === 'background-color') return 'transparent';
                  if (prop === 'border-color') return 'currentColor';
                  if (prop === 'color') return 'canvastext';
                  return '';
                })();

            // restore
            themeMap = savedThemeMap;

            const parsed = parseCssColor(raw);
            const rgb = parsed.rgb;
            input.value = rgbToHex(rgb);
            if (codeSpan) codeSpan.textContent = formatCssColor(rgb, (parsed.kind === 'rgba' || parsed.kind === 'transparent') ? parsed.a : 1);

            // state’i de güncelle (touched false’a çekmeden sadece “görünen”i düzeltelim)
            const st = cellState.get(key);
            if (st) {
              st.rgb = { ...rgb };
              // alpha: transparent ->0, rgba->a, diğer->1
              st.a = (parsed.kind === 'rgba' || parsed.kind === 'transparent') ? parsed.a : 1;
            }
          }
        }
      }

      /* ---------------- COMMIT LOGIC ---------------- */
      function commitChanges() {
        // pendingResetAll: "baz tema"ya dön (override'ları temizle) (Tamam ile)
        if (pendingResetAll) {
          // base aynı kalır; sadece overrides temizlenir.
          themeMap = new Map();
          themeStyleEl.textContent = '';
          saveThemeToStorage('');
          clearThemeStorage();
          pendingResetAll = false;
          clearPreview();

          // panel açıksa select'i state'e göre düzelt
          setPresetSelectToCurrentState();
          return;
        }

        // normal commit: touched + rgb changed -> write
        const nextThemeMap = parseCssText(themeStyleEl.textContent || '');
        let didChange = false;

        for (const [key, st] of cellState.entries()) {
          if (!st.touched) continue;

          // sadece RGB karşılaştır
          if (sameRgb(st.rgb, st.baseRgb)) continue;

          const selector = st.selector;
          const decl = nextThemeMap.get(selector) || {};

          // alpha korunur (st.a)
          decl[st.prop] = formatCssColor(st.rgb, st.a);
          nextThemeMap.set(selector, decl);
          didChange = true;
        }

        if (didChange) {
          // Boş property temizliği (opsiyonel)
          const cssText = buildCssText(nextThemeMap);
          themeStyleEl.textContent = cssText;
          saveThemeToStorage(cssText);
        }

        clearPreview();
      }

      /* ---------------- CANCEL / RESET ---------------- */
      function cancelChanges() {
        // pending reset geri al
        if (pendingResetAll) {
          pendingResetAll = false;
          // theme snapshot geri yükle
          themeStyleEl.textContent = initialThemeCssSnapshot;
          saveThemeToStorage(initialThemeCssSnapshot);
          // themeMap güncelle
          themeMap = parseCssText(initialThemeCssSnapshot);
        }
        clearPreview();
      }

      /* ---------------- PANEL BUILD ---------------- */
      function buildPanel() {
        if (panelEl) return;

        panelEl = document.createElement('div');
        panelEl.id = 'theme-panel';

        panelEl.innerHTML = `
    <div id="theme-panel-header">

      <div id="theme-panel-draggable">
      <div class="title">Renk ve Tema Ayarları</div>
      <div class="hint">Sürükleyin • Dikey boyutlandırın • RGB değiştirin</div>     
      </div>
     
      
      <div class="close">
      <button id="btn-theme-close" type="button" title="Değişiklikleri kaydetmeden panelden çıkar"> ✕ </button>
      </div>

      </div>


    <div id="theme-panel-presets">
      <span class="label">Hazır Tema:</span>
      <select id="theme-preset-select" title="Hazır tema seçimi. Seçilen tema, mevcut tema override’larını tamamen değiştirir">
        <option value="__current__">Mevcut (Özel)</option>
        <option value="__default__">Varsayılan</option>
        <option value="karanlik">Karanlık</option>
        <option value="gece">Gece</option>
        <option value="matrix">Matrix</option>
      </select>
      <button id="btn-theme-apply-preset" type="button" title="Seçili hazır temayı uygular">Uygula</button>
    </div>

    <div id="theme-panel-body"></div>
    <div id="theme-panel-footer">
      <button id="btn-theme-reset-all" type="button" title="Tüm tema / renk düzenini, uygulama varsayılanına döndürür">Varsayılanlara dön!</button>
      <div class="rightside">
        <button id="btn-theme-cancel" type="button" title="Değişiklikleri kaydetmeden panelden çıkar">İptal</button>
        <button id="btn-theme-ok" type="button" title="Değişiklikleri uygular ve paneli kapatır">Tamam</button>
      </div>
    </div>
  `;

        document.body.appendChild(panelEl);
        bodyEl = panelEl.querySelector('#theme-panel-body');



        tableEl = document.createElement('table');
        tableEl.innerHTML = `
    <thead>
      <tr>
        <th class="col-label">Alan Adı</th>
        <th>Metin / İkon</th>
        <th>Çerçeve / Çizgi</th>
        <th>Arka Plan</th>
      </tr>
      </thead>
    <tbody></tbody>
  `;
        bodyEl.appendChild(tableEl);

        // Drag logic
        makeDraggable(panelEl, panelEl.querySelector('#theme-panel-draggable'));

        // Buttons
        panelEl.querySelector('#btn-theme-close').addEventListener('click', () => {
          cancelChanges();
          closePanel();
        });
        panelEl.querySelector('#btn-theme-ok').addEventListener('click', () => {
          commitChanges();
          closePanel();
        });
        panelEl.querySelector('#btn-theme-cancel').addEventListener('click', () => {
          cancelChanges();
          closePanel();
        });
        panelEl.querySelector('#btn-theme-reset-all').addEventListener('click', () => {
          applyResetAllPreview();
        });

        // Preset themes
        const presetSel = panelEl.querySelector('#theme-preset-select');
        const presetBtn = panelEl.querySelector('#btn-theme-apply-preset');

        // panel açıldığında seçimi "Mevcut"ta bırak
        if (presetSel) presetSel.value = '__current__';

        if (presetBtn && presetSel) {
          presetBtn.addEventListener('click', () => {
            const key = presetSel.value;

            if (key === '__current__') return;

            // Base seçimi: preset seçince base değişir, overrides temizlenir.
            if (key === '__default__') {
              applyBaseTheme('default');
              applyThemeOverridesCss('');
              // UI: artık özel değil, varsayılan
              presetSel.value = '__default__';
              return;
            }

            const entry = BUILTIN_THEMES[key];
            if (!entry || !entry.css) {
              alert('Seçilen tema bulunamadı veya geçersiz.');
              return;
            }

            applyBaseTheme(key);
            applyThemeOverridesCss('');
            // UI: artık özel değil, seçili base
            presetSel.value = key;
          });
        }

      }

      function renderTable() {
        const tbody = tableEl.querySelector('tbody');
        tbody.innerHTML = '';

        // dynamic extra columns , sıralama değişse de verileri doğru sırala
        const baseCols = new Set(['text', 'bd', 'bg']);
        const extraFields = new Set();
        for (const row of COLOR_ROWS) {
          for (const f of row.fields) if (!baseCols.has(f)) extraFields.add(f);
        }

        for (const row of COLOR_ROWS) {
          const tr = document.createElement('tr');


          // INFO SATIRI: tek hücre, colspan=4
          if (row.fields === 'sub' || row.fields === 'warn') {
            const td = document.createElement('td');
            td.colSpan = 4;
            td.textContent = row.label || '';
            if (row.fields === 'warn') td.className = 'warning-info';
            tr.appendChild(td);
            tbody.appendChild(tr);

            continue;                        // <- diğer td’leri üretmez
          }

          const thLabel = document.createElement('th');
          thLabel.className = 'col-label';
          thLabel.textContent = row.label;
          tr.appendChild(thLabel);

          // 3 ana sütun
          tr.appendChild(makeCellTd(row, 'text'));
          tr.appendChild(makeCellTd(row, 'bd'));
          tr.appendChild(makeCellTd(row, 'bg'));
          tbody.appendChild(tr);
        }
      }



      function makeCellTd(row, field) {
        const td = document.createElement('td');

        if (!row.fields.includes(field)) {
          td.textContent = '';
          return td;
        }

        const st = initCellState(row, field);
        if (!st) {
          td.textContent = '';
          return td;
        }
        const key = cellKey(row.id, field);



        const input = document.createElement('input');
        input.type = 'color';
        input.value = rgbToHex(st.rgb);
        input.dataset.cell = key;



        input.addEventListener('input', (e) => {
          const rgb = hexToRgb(e.target.value);
          const state = cellState.get(key);
          if (!state) return;

          state.rgb = { ...rgb };
          state.touched = true;

          // preview apply (pending reset olsa bile preview yazabilir; reset anlamı iptal değil, bekleyen işlem)
          setPreviewValue(row, field, rgb);

          // En ufak değişiklikte artık "Özel" olarak işaretle
          const presetSel = document.getElementById('theme-preset-select');
          if (presetSel && presetSel.value !== '__current__') {
            presetSel.value = '__current__';
          }

        });


        td.appendChild(input);
        return td;
      }

      /* ---------------- DRAG ---------------- */
      function makeDraggable(panel, handle) {
        let isDown = false;
        let startX = 0, startY = 0;
        let startLeft = 0, startTop = 0;
        let activePointerId = null;

        function getPoint(e) {
          // PointerEvent ise clientX/clientY var
          return { x: e.clientX, y: e.clientY };
        }

        function onDown(e) {
          // sadece primary pointer (tek parmak / ana dokunuş) ile sürükle
          if (e.isPrimary === false) return;

          isDown = true;
          activePointerId = e.pointerId;

          const rect = panel.getBoundingClientRect();
          const p = getPoint(e);

          startX = p.x;
          startY = p.y;
          startLeft = rect.left;
          startTop = rect.top;

          // ortadan konumlama (transform) -> kesin left/top'a geç
          panel.style.transform = 'none';
          panel.style.left = `${rect.left}px`;
          panel.style.top = `${rect.top}px`;
          panel.style.right = 'auto';
          panel.style.bottom = 'auto';

          // pointer capture: parmak handle'dan çıksa bile drag devam eder
          handle.setPointerCapture(activePointerId);

          e.preventDefault();
        }

        function onMove(e) {
          if (!isDown) return;
          if (activePointerId !== null && e.pointerId !== activePointerId) return;

          const p = getPoint(e);
          const dx = p.x - startX;
          const dy = p.y - startY;

          const newLeft = Math.max(8, Math.min(window.innerWidth - 40, startLeft + dx));
          const newTop = Math.max(8, Math.min(window.innerHeight - 40, startTop + dy));

          panel.style.left = `${newLeft}px`;
          panel.style.top = `${newTop}px`;

          e.preventDefault();
        }

        function onUp(e) {
          if (activePointerId !== null && e.pointerId !== activePointerId) return;

          isDown = false;
          activePointerId = null;
        }

        // Pointer Events (mobil + desktop)
        handle.addEventListener('pointerdown', onDown, { passive: false });
        handle.addEventListener('pointermove', onMove, { passive: false });
        handle.addEventListener('pointerup', onUp);
        handle.addEventListener('pointercancel', onUp);

        // İsterseniz mouse fallback’ı kaldırabilirsiniz; pointer events modern tarayıcılarda yeterli.
      }

      /* ---------------- OPEN/CLOSE ---------------- */
      function openPanel() {
        buildPanel();

        // Load base + theme
        recomputeBaseMap();

        const themeCss = loadThemeFromStorage();
        themeMap = parseCssText(themeCss);

        // Preset seçimi: overrides varsa "Mevcut (Özel)", yoksa base'e göre seç.
        try {
          const presetSel = document.getElementById('theme-preset-select');
          const baseId = getStoredBaseTheme();
          const hasOverrides = (themeCss || '').trim().length > 0;
          if (presetSel) {
            if (hasOverrides) presetSel.value = '__current__';
            else if (baseId && baseId !== 'default') presetSel.value = baseId;
            else presetSel.value = '__default__';
          }
        } catch { }

        // snapshot for reset-all cancel
        initialThemeCssSnapshot = themeCss;
        pendingResetAll = false;

        // reset state
        cellState.clear();
        clearPreview();

        renderTable();

        // body height: panelin kalan alanına göre esnesin
        // (panel resize vertical olduğu için body doğal şekilde scroll alır)
        panelEl.classList.add('is-open');
        bodyEl.style.maxHeight = 'calc(100vh - 160px)';
      }

      function closePanel() {
        if (!panelEl) return;
        panelEl.classList.remove('is-open');
      }

      /* ---------------- INIT BUTTON ---------------- */
      document.addEventListener('DOMContentLoaded', () => {
        // theme’i sayfa açılışında uygula (base + overrides)
        applyThemeFromStorage();

        const btn = document.getElementById('btn-color-settings');
        if (!btn) return;
        btn.addEventListener('click', () => {
          openPanel();
        });
      });

      // Seçici yardımcı fonksiyon
      // root parametresi verilirse o element içinde arama yapar
      function qs(sel, root) {
        return (root || document).querySelector(sel);
      }

      // Random bir zincir ID üretir
      // 'c' + 36 tabanlı rastgele string
      function rid() {
        return 'c' + Math.random().toString(36).slice(2, 10);
      }

      // Tarih & saat formatı → DD.MM.YYYY HH:MM (GMT±X)
      function formatNowLocal_DDMMYYYY_HHMM_GMT() {
        var d = new Date();
        var DD = String(d.getDate()).padStart(2, '0');
        var MM = String(d.getMonth() + 1).padStart(2, '0');
        var YYYY = d.getFullYear();
        var HH = String(d.getHours()).padStart(2, '0');
        var MI = String(d.getMinutes()).padStart(2, '0');

        // Kullanıcının zaman dilimi farkını GMT formatında göster
        var tzOffsetMinutes = d.getTimezoneOffset();
        var sign = tzOffsetMinutes <= 0 ? '+' : '-';
        var absMinutes = Math.abs(tzOffsetMinutes);
        var tzH = Math.floor(absMinutes / 60);
        var tzM = absMinutes % 60;
        var tzStr = 'GMT' + sign + tzH + (tzM ? ':' + String(tzM).padStart(2, '0') : '');

        return DD + '.' + MM + '.' + YYYY + ' ' + HH + ':' + MI + ' (' + tzStr + ')';
      }

      // Date → ISO Date (YYYY-MM-DD)
      // (Saat ignore edilerek tarih karşılaştırmalarını temiz tutar)
      function toISO(d) {
        var y = d.getFullYear();
        var m = String(d.getMonth() + 1).padStart(2, '0');
        var day = String(d.getDate()).padStart(2, '0');
        return y + '-' + m + '-' + day;
      }

      // TR formatında kısa tarih yazdırma
      function fmtTR(d) {
        return d.toLocaleDateString('tr-TR', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
        });
      }

      // İki tarih arasındaki TÜM günleri (dahil) listeleyen yardımcı fonksiyon
      // Start ve end ters gelirse, yer değiştiriyor.
      function daysBetween(start, end) {
        // Sadece tarih kısmını kullanmak için saat/min/saniyeyi 0'lıyoruz
        var S = new Date(start.getFullYear(), start.getMonth(), start.getDate());
        var E = new Date(end.getFullYear(), end.getMonth(), end.getDate());
        if (E < S) {
          var t = S;
          S = E;
          E = t;
        }
        var out = [];
        var cur = new Date(S);
        while (cur <= E) {
          out.push(new Date(cur));
          cur.setDate(cur.getDate() + 1); // 1 gün ileri
        }
        return out;
      }

      // Seçili haftaiçi günlerine göre tarih listesini filtreler
      // picked: [bool,bool,...] uzunluğu 7, Pazartesi bazlı index
      function filterByWeekdays(arr, picked) {
        return arr.filter(function (d) {
          // JS getDay(): 0 Pazar, 1 Pazartesi ...
          // Bizim dizimiz: 0 Pazartesi, 6 Pazar. Bu yüzden (day+6)%7 shift yapıyoruz
          return picked[(d.getDay() + 6) % 7];
        });
      }

      // Checkbox'lardan seçili günleri okur (wd0..wd6)
      function readSelectedWeekdays() {
        var out = [];
        for (var i = 0; i < 7; i++) {
          var el = document.getElementById('wd' + i);
          out.push(el ? !!el.checked : false);
        }
        return out;
      }

      // True olan gün sayısını hesaplar
      function countSelectedWeekdays(picked) {
        var c = 0;
        for (var i = 0; i < picked.length; i++) {
          if (picked[i]) c++;
        }
        return c;
      }

      // Haftanın tüm günleri seçili mi / hiç seçilmemiş mi uyarısını yönetir
      function updateAllSelectedNote() {
        var note = document.getElementById('all-selected-note');
        var weekdayErr = document.getElementById('weekdays-error');
        if (!note || !weekdayErr) return;

        var picked = readSelectedWeekdays();
        var nSelected = countSelectedWeekdays(picked);

        weekdayErr.style.display = 'none';
        weekdayErr.textContent = '';

        if (nSelected === 0) {
          note.style.display = 'none';

          // Son tetikleyici "weekday" ise, kullanıcıya en az bir gün seçmesini söyle
          if (lastTrigger === 'weekday') {
            weekdayErr.textContent = 'Lütfen en az bir gün seçin.';
            weekdayErr.style.display = 'inline-block';
            scheduleErrorAutoHide();
          }
        } else if (nSelected === 7) {
          // Tüm günler seçili → bilgilendirici not göster
          note.style.display = 'inline-block';
        } else {
          note.style.display = 'none';
        }
      }

      // Input'lardan tam sayı okur, min/max/step ve fallback uygulayarak normalize eder
      function readIntClamped(input, opts) {
        if (!input) return (opts && typeof opts.fallback === 'number') ? opts.fallback : 0;

        opts = opts || {};
        var min = (typeof opts.min === 'number') ? opts.min : Number.NEGATIVE_INFINITY;
        var max = (typeof opts.max === 'number') ? opts.max : Number.POSITIVE_INFINITY;
        var step = (typeof opts.step === 'number') ? opts.step : 0;
        var fallback = (typeof opts.fallback === 'number') ? opts.fallback : min;

        var v = parseFloat(input.value);
        if (!isFinite(v)) v = fallback;

        v = Math.round(v);

        if (v < min) v = min;
        if (v > max) v = max;

        // step > 1 ise değeri step grid’ine oturtur (ör: 5’er 5’er)
        if (step && step > 1) {
          v = min + Math.round((v - min) / step) * step;
          if (v < min) v = min;
          if (v > max) v = max;
        }

        input.value = String(v);
        return v;
      }

      // Count modundaki layout inputlarını (rows/cols) güncel halka sayısına göre sınırlar
      function syncLayoutInputsCountMode() {
        if (!colsInput || !rowsInput) return;

        var maxVal = (n && n > 0) ? n : 1;

        colsInput.min = '1';
        colsInput.max = String(maxVal);
        colsInput.step = '1';
        colsInput.setAttribute('min', '1');
        colsInput.setAttribute('max', String(maxVal));
        colsInput.setAttribute('step', '1');

        rowsInput.min = '1';
        rowsInput.max = String(maxVal);
        rowsInput.step = '1';
        rowsInput.setAttribute('min', '1');
        rowsInput.setAttribute('max', String(maxVal));
        rowsInput.setAttribute('step', '1');
      }

      // LocalStorage anahtarımız
      var STORE_KEY = 'do-not-break-the-chain-v1';

      // LocalStorage'tan zincirleri okur. Boşsa default yapı döner.
      function getStore() {
        try {
          var raw = localStorage.getItem(STORE_KEY);
          if (!raw) return { order: [], items: {} };
          var obj = JSON.parse(raw);
          return {
            // order yoksa items key'lerinden order üret
            order: Array.isArray(obj.order) ? obj.order : Object.keys(obj.items || {}),
            items: obj.items || {},
          };
        } catch (e) {
          // Bozuk JSON / erişim hatası vb. → güvenli default
          return { order: [], items: {} };
        }
      }

      // Store'u LocalStorage'a yazar
      function setStore(s) {
        try {
          localStorage.setItem(STORE_KEY, JSON.stringify(s));
        } catch (e) {
          // Storage dolu / private mode vb. hata durumunda sessizce geç
        }
      }

      // İçe aktarılan store'u mevcut store ile birleştirir
      // Aynı ID denk gelirse yeni ID üretir.
      function mergeStores(current, imported) {
        if (!imported || !imported.items) return current;
        var result = {
          order: current.order.slice(),
          items: Object.assign({}, current.items),
        };

        var importedOrder = imported.order || Object.keys(imported.items);

        for (var i = 0; i < importedOrder.length; i++) {
          var oldId = importedOrder[i];
          var ch = imported.items[oldId];
          if (!ch) continue;

          var newId = oldId;
          // ID çakışırsa random yeni ID üret
          if (result.items[newId]) {
            newId = rid();
          }

          ch.id = newId;
          result.items[newId] = ch;
          result.order.push(newId);
        }

        return result;
      }

      // İçe aktarılan JSON yapısının temel tutarlılığını kontrol eder
      // Bu fonksiyon, bozuk/eksik backup dosyalarına karşı savunma hattı.
      function validateImportedStore(imported) {
        if (!imported || typeof imported !== 'object') {
          return { ok: false, reason: 'notObject' };
        }

        // Tema var mı? (theme.css doluysa tema var kabul et)
        var importedThemeCss =
          imported && imported.theme && imported.theme.css ? String(imported.theme.css).trim() : '';
        var hasTheme = importedThemeCss.length > 0;

        if (!imported.items || typeof imported.items !== 'object') {
          // İsterseniz burada da hasTheme true ise items olmasa bile kabul edebilirsiniz.
          return { ok: false, reason: 'missingItems' };
        }

        var itemKeys = Object.keys(imported.items);

        // Zincir yok ama tema varsa -> OK
        if (itemKeys.length === 0) {
          return hasTheme ? { ok: true } : { ok: false, reason: 'noChainorTheme' };
        }

        var hasAtLeastOneValid = false;

        for (var i = 0; i < itemKeys.length; i++) {
          var key = itemKeys[i];
          var ch = imported.items[key];

          if (!ch || typeof ch !== 'object') return { ok: false, reason: 'invalidChainObject' };
          if (!ch.id || typeof ch.id !== 'string' || !ch.id.trim()) return { ok: false, reason: 'missingId' };

          var total = 0;

          if (ch.kind === 'dated') {
            if (!Array.isArray(ch.dates) || ch.dates.length === 0) return { ok: false, reason: 'invalidDates' };
            total = ch.dates.length;
          } else if (ch.kind === 'count') {
            if (typeof ch.total === 'number' && isFinite(ch.total)) total = ch.total;
            else if (Array.isArray(ch.parts)) total = ch.parts.length;
            else return { ok: false, reason: 'missingTotal' };
          } else {
            return { ok: false, reason: 'invalidKind' };
          }

          if (!total || total < 1 || total > MAX_RINGS) return { ok: false, reason: 'invalidTotal' };

          hasAtLeastOneValid = true;
        }

        // Hiç geçerli zincir yok ama tema varsa -> OK
        if (!hasAtLeastOneValid) {
          return hasTheme ? { ok: true } : { ok: false, reason: 'noChainorTheme' };
        }

        return { ok: true };
      }

      // Tüm hata span'lerini (isim/tarih/gün/backup) gizler ve mesajlarını sıfırlar
      function hideAllErrorSpans() {
        if (nameError) {
          nameError.style.display = 'none';
          nameError.textContent = '';
        }
        if (dateErrors) {
          dateErrors.style.display = 'none';
          dateErrors.textContent = '';
        }
        if (weekdaysError) {
          weekdaysError.style.display = 'none';
          weekdaysError.textContent = '';
        }
        if (backupError) {
          backupError.style.display = 'none';
          backupError.textContent = '';
        }
      }

      // Hata mesajlarını belli bir süre sonra otomatik gizlemek için timeout ayarlar
      function scheduleErrorAutoHide() {
        if (errorHideTimeout) {
          clearTimeout(errorHideTimeout);
        }
        errorHideTimeout = setTimeout(function () {
          hideAllErrorSpans();
        }, 15000);
      }

      // Formdaki input'ların "hata" sınıfını yönetir (kırmızı glow mantığı)
      function updateGlowState() {
        if (!hasValidationTriggered) {
          // Validation henüz tetiklenmediyse hiçbir input'u kırmızı yapma
          if (chainName) chainName.classList.remove('input-error');
          if (startDate) startDate.classList.remove('input-error');
          if (endDate) endDate.classList.remove('input-error');
          if (weekdays) weekdays.classList.remove('input-error');
          if (chainCount) chainCount.classList.remove('input-error');
          return;
        }

        var hasAnyError = false;

        // Zincir adı boş mu kontrolü
        if (chainName) {
          var nameVal = (chainName.value || '').trim();
          if (!nameVal) {
            chainName.classList.add('input-error');
            hasAnyError = true;
          } else {
            chainName.classList.remove('input-error');
          }
        }

        if (currentKind === 'dated') {
          var sVal = startDate && startDate.value;
          var eVal = endDate && endDate.value;
          var picked = readSelectedWeekdays();
          var nSelected = countSelectedWeekdays(picked);
          var bothDatesFilled = !!(sVal && eVal);
          var orderError = false;
          var maxExceeded = false;

          if (bothDatesFilled) {
            var s = new Date(sVal + 'T00:00:00');
            var e = new Date(eVal + 'T00:00:00');

            if (e < s) {
              orderError = true;
            } else if (nSelected > 0) {
              var allDays = daysBetween(s, e);
              var filteredDates = filterByWeekdays(allDays, picked);
              if (filteredDates.length > MAX_RINGS) {
                maxExceeded = true;
              }
            }
          }

          // Başlangıç/bitiş tarihleri hatalıysa input'u kırmızıya al
          if (startDate) {
            if (orderError || maxExceeded) {
              startDate.classList.add('input-error');
              hasAnyError = true;
            } else {
              startDate.classList.remove('input-error');
            }
          }

          if (endDate) {
            if (orderError || maxExceeded) {
              endDate.classList.add('input-error');
              hasAnyError = true;
            } else {
              endDate.classList.remove('input-error');
            }
          }

          // Hiç gün seçilmemişse veya MAX_RINGS aşılmışsa gün kutusunu da işaretle
          if (weekdays) {
            if (nSelected === 0 || maxExceeded) {
              weekdays.classList.add('input-error');
              hasAnyError = true;
            } else {
              weekdays.classList.remove('input-error');
            }
          }
        } else {
          // Count modunda sadece halka sayısı kontrol edilir
          if (chainCount) {
            var totalCount = parseInt(chainCount.value, 10) || 0;
            if (!totalCount || totalCount < 1 || totalCount > MAX_RINGS) {
              chainCount.classList.add('input-error');
              hasAnyError = true;
            } else {
              chainCount.classList.remove('input-error');
            }
          }
        }

        // Eğer hiçbir hata kalmadıysa validation flag'ini sıfırla
        if (!hasAnyError) {
          hasValidationTriggered = false;
        }
      }

      // Zincir adı için canlı hata temizleme
      if (chainName && nameError) {
        chainName.addEventListener('input', function () {
          nameError.style.display = 'none';
          nameError.textContent = '';
          chainName.classList.remove('input-error');
          updateGlowState();
        });
      }

      // Ekranı "tarihli" / "sayı" moduna göre düzenler (hangi alanlar görünsün)
      function syncModeUI() {
        var mode = currentKind;
        var startLabel = startDate ? startDate.parentElement : null;
        var endLabel = endDate ? endDate.parentElement : null;

        if (mode === 'dated') {
          if (weekdaysLabel) weekdaysLabel.style.display = '';
          if (weekdays) weekdays.style.display = '';
          if (chainCountLabel) chainCountLabel.style.display = 'none';
          if (startLabel) startLabel.style.display = '';
          if (endLabel) endLabel.style.display = '';
        } else {
          if (weekdaysLabel) weekdaysLabel.style.display = 'none';
          if (weekdays) weekdays.style.display = 'none';
          if (chainCountLabel) chainCountLabel.style.display = '';
          if (startLabel) startLabel.style.display = 'none';
          if (endLabel) endLabel.style.display = 'none';
        }
      }

      // Radio butonlardan aktif modu okur
      function getSelectedMode() {
        for (var i = 0; i < modeRadios.length; i++) {
          if (modeRadios[i].checked) return modeRadios[i].value === 'count' ? 'count' : 'dated';
        }
        return 'dated';
      }

      // Mod değişince layout + sayılar güncellenir
      function onModeChange() {
        currentKind = getSelectedMode();
        syncModeUI();
        updateCount();
        if (currentKind === 'count') {
          syncLayoutInputsCountMode();
        }
      }

      // Tüm radio butonlarına mod değişim listener'ı bağla
      for (var mr = 0; mr < modeRadios.length; mr++) {
        modeRadios[mr].addEventListener('change', onModeChange);
      }

      // Layout açıklama textini günceller (satır x sütun vs.)
      function updateLayoutText() {
        if (!layoutInfo) return;

        if (!n || n < 1) {
          layoutInfo.textContent = '';
          return;
        }

        var totalCells = rows * cols;
        var empty = totalCells - n;
        if (empty < 0) empty = 0;

        layoutInfo.textContent =
          'Düzen: ' +
          rows +
          ' satır × ' +
          cols +
          ' sütun = ' +
          totalCells +
          ' toplam hücre (Son satırda ' +
          empty +
          ' boş hücre olacaktır.)';
      }

      // COUNT modunda n halkaya en uygun (yaklaşık kare) layout'u hesaplar
      function recomputeBestLayoutCountMode() {
        if (!n || n < 1) {
          n = 0;
          cols = 1;
          rows = 1;
          if (colsInput) colsInput.value = String(cols);
          if (rowsInput) rowsInput.value = String(rows);
          if (showCount) showCount.textContent = '0';
          updateLayoutText();
          return;
        }

        var bestCols = 1;
        var bestRows = n;
        var bestDiff = Infinity;

        // 1'den n'e kadar tüm sütun sayıları denenip, satır-sütun farkı en küçük olan kombinasyon seçiliyor
        for (var c = 1; c <= n; c++) {
          var r = Math.ceil(n / c);
          var diff = Math.abs(r - c);
          if (diff < bestDiff || (diff === bestDiff && c > bestCols)) {
            bestDiff = diff;
            bestCols = c;
            bestRows = r;
          }
        }

        cols = bestCols;
        rows = bestRows;

        if (colsInput) colsInput.value = String(cols);
        if (rowsInput) rowsInput.value = String(rows);
        if (showCount) showCount.textContent = String(n);
        updateLayoutText();
      }

      // TARİHLİ MOD için toplam halka sayısını ve layout'u hesaplar
      // skipLayout = true ise sadece n / currentDates hesaplanır, layout yeniden optimize edilmez
      function updateCountDatedMode(skipLayout) {
        currentDates = [];

        var sVal = startDate && startDate.value;
        var eVal = endDate && endDate.value;

        if (dateErrors) {
          dateErrors.style.display = 'none';
          dateErrors.textContent = '';
        }

        var picked = readSelectedWeekdays();
        var nSelected = countSelectedWeekdays(picked);

        var total = 0;
        n = 0;

        // Tarihlerden biri yoksa: n=0, layout temizlenir
        if (!sVal || !eVal) {
          currentDates = [];
          if (showCount) showCount.textContent = '0';
          layoutInfo.textContent = '';
          cols = 0;
          rows = 0;
          syncLayoutInputs(nSelected);
          return;
        }

        var s = new Date(sVal + 'T00:00:00');
        var e = new Date(eVal + 'T00:00:00');

        // Bitiş başlangıçtan önce ise hata
        if (e < s) {
          currentDates = [];
          n = 0;
          if (showCount) showCount.textContent = '0';
          layoutInfo.textContent = '';
          cols = 0;
          rows = 0;
          syncLayoutInputs(nSelected);

          if (dateErrors) {
            dateErrors.textContent = 'Bitiş tarihi, başlangıçtan önce olamaz!';
            dateErrors.style.display = 'inline-block';
            scheduleErrorAutoHide();
          }
          return;
        }

        // Hiç gün seçili değilse: n=0, layout temizlenir
        if (nSelected === 0) {
          currentDates = [];
          n = 0;
          if (showCount) showCount.textContent = '0';
          layoutInfo.textContent = '';
          cols = 0;
          rows = 0;
          syncLayoutInputs(nSelected);
          return;
        }

        // Tarih aralığındaki tüm günleri al + seçili haftaiçine göre filtrele
        var allDays = daysBetween(s, e);
        var filteredDates = filterByWeekdays(allDays, picked);
        currentDates = filteredDates.map(toISO);
        total = filteredDates.length;

        // Global halka limiti aşılırsa kullanıcı uyarılır
        if (total > MAX_RINGS) {
          n = 0;
          if (showCount) showCount.textContent = String(total);
          layoutInfo.textContent = '';
          cols = 0;
          rows = 0;
          syncLayoutInputs(nSelected);

          if (dateErrors) {
            dateErrors.textContent =
              'Toplam halka sayısı ' + MAX_RINGS +
              ' sınırını aşıyor. (şu an: ' + total +
              ') Lütfen tarih aralığını veya seçili günleri daraltın.';
            dateErrors.style.display = 'inline-block';
            scheduleErrorAutoHide();
          }
          return;
        }

        n = total;
        if (showCount) showCount.textContent = String(n);

        if (!n || n <= 0) {
          cols = 0;
          rows = 0;
          layoutInfo.textContent = '';
          syncLayoutInputs(nSelected);
          return;
        }

        // Sadece sayıları güncelle, layout'u elleyeceksen skipLayout=true ile gel
        if (skipLayout) {
          updateLayoutText();
          return;
        }

        // Varsayılan: tek sütun (hemen değişecek geçici değer), tüm halkalar alt alta
        cols = 1;
        rows = n;
        var bestDiff = Infinity;

        // Seçili gün sayısı küçükse özel hizalama mantığı
        if (nSelected > 0 && n <= nSelected) {
          // Örn: 3 gün seçili, 2 halka → sütun sayısı seçili gün sayısı
          cols = nSelected;
          rows = Math.ceil(n / cols);
        } else {
          // Aksi halde: kolon artırıp en kareye yakın yapıyı bulmaya çalış
          var c = 1;
          while (c <= n) {
            // Eğer nSelected>0 ise, sütun sayısı seçili gün sayısının katı olmalı
            if (nSelected === 0 || c % nSelected === 0) {
              var r = Math.ceil(n / c);
              var diff = Math.abs(r - c);

              if (diff < bestDiff || (diff === bestDiff && c > cols)) {
                bestDiff = diff;
                cols = c;
                rows = r;
              }
            }
            c++;
          }
        }

        if (colsInput) colsInput.value = String(cols);
        if (rowsInput) rowsInput.value = String(rows);

        // Kolon sayısına göre layout'u yeniden hesapla (mutlak kolon mantığı)
        computeLayoutFromColsAbsolute(nSelected, cols);
        syncLayoutInputs(nSelected);
        if (showCount) showCount.textContent = String(n);
      }

      // SAYI MODU için n ve layout'u günceller
      function updateCountCountMode(skipLayout) {
        n = readIntClamped(chainCount, {
          min: 1,
          max: MAX_RINGS,
          step: 1,
          fallback: 1
        });

        if (!n || n < 1) {
          n = 0;
          cols = 1;
          rows = 1;
          if (colsInput) colsInput.value = String(cols);
          if (rowsInput) rowsInput.value = String(rows);
          if (showCount) showCount.textContent = '0';
          updateLayoutText();
          syncLayoutInputsCountMode();
          return;
        }

        // Layout'la oynamadan sadece sayıyı güncellemek istenirse
        if (skipLayout) {
          if (showCount) showCount.textContent = String(n);
          syncLayoutInputsCountMode();
          return;
        }

        // En uygun kareye yakın layout'u yeniden hesapla
        recomputeBestLayoutCountMode();
        syncLayoutInputsCountMode();
      }

      // COUNT modunda sadece kolon sayısını elle değiştirince layout güncelle
      function updateColsCountMode() {
        if (!n || n < 1) return;

        cols = readIntClamped(colsInput, {
          min: 1,
          max: n,
          step: 1,
          fallback: cols || 1
        });

        rows = Math.ceil(n / cols);
        rowsInput.value = String(rows);
        showCount.textContent = String(n);
        updateLayoutText();
      }

      // COUNT modunda sadece satır sayısını elle değiştirince layout güncelle
      function updateRowsCountMode() {
        if (!n || n < 1) return;

        rows = readIntClamped(rowsInput, {
          min: 1,
          max: n,
          step: 1,
          fallback: rows || 1
        });

        cols = Math.ceil(n / rows);
        colsInput.value = String(cols);
        showCount.textContent = String(n);
        updateLayoutText();
      }

      // Tarihli modda, seçili gün sayısına göre kolon konfigürasyonunu hesaplar
      function getLayoutConfig(nSelected) {
        // stepCols: kaç kolon aralıkla artabilir (ör: 3 gün seçiliyse 3, 6, 9 ...)
        var stepCols = nSelected && nSelected > 0 ? nSelected : 1;
        var minCols = stepCols;
        var maxCols = n && n > 0 ? n : stepCols;
        if (maxCols < minCols) maxCols = minCols;
        return { stepCols: stepCols, minCols: minCols, maxCols: maxCols };
      }

      // İzin verilen kolon sayılarını (liste halinde) üretir
      function getAllowedColsList(cfg) {
        var list = [];
        var c = cfg.minCols;
        while (c <= cfg.maxCols) {
          list.push(c);
          c += cfg.stepCols;
        }
        if (list.length === 0) {
          list.push(cfg.maxCols);
        } else if (list[list.length - 1] !== cfg.maxCols) {
          list.push(cfg.maxCols);
        }
        return list;
      }

      // Tarihli modda rows/cols inputlarının min/max ve textlerini senkronize eder
      function syncLayoutInputs(nSelected) {
        var cfg = getLayoutConfig(nSelected);
        var colsMin = cfg.minCols;
        var colsMax = cfg.maxCols;

        if (!n || n <= 0) {
          colsInput.min = colsMin;
          colsInput.max = colsMax;
          colsInput.step = 1;
          colsInput.setAttribute('min', String(colsMin));
          colsInput.setAttribute('max', String(colsMax));
          colsInput.setAttribute('step', '1');
          colsInput.value = '';

          rowsInput.min = 1;
          rowsInput.max = 1;
          rowsInput.step = 1;
          rowsInput.setAttribute('min', '1');
          rowsInput.setAttribute('max', '1');
          rowsInput.setAttribute('step', '1');
          rowsInput.value = '';

          layoutInfo.textContent = '';
          return;
        }

        // Eğer global cols değeri sınırların dışında ise içeri çek
        if (!cols || cols < colsMin) cols = colsMin;
        if (cols > colsMax) cols = colsMax;

        var rowsMin = 1;
        var rowsMax = Math.ceil(n / colsMin);
        if (!rows || rows < rowsMin) rows = rowsMin;
        if (rows > rowsMax) rows = rowsMax;

        colsInput.min = colsMin;
        colsInput.max = colsMax;
        colsInput.step = 1;
        colsInput.setAttribute('min', String(colsMin));
        colsInput.setAttribute('max', String(colsMax));
        colsInput.setAttribute('step', '1');
        colsInput.value = String(cols);

        rowsInput.min = rowsMin;
        rowsInput.max = rowsMax;
        rowsInput.step = 1;
        rowsInput.setAttribute('min', String(rowsMin));
        rowsInput.setAttribute('max', String(rowsMax));
        rowsInput.setAttribute('step', '1');
        rowsInput.value = String(rows);

        layoutInfo.textContent = n
          ? 'Düzen: ' +
          rows +
          ' satır × ' +
          cols +
          ' sütun = ' +
          rows * cols +
          ' toplam hücre (Son satırda ' + (rows * cols - n) + ' boş hücre olacaktır.)'
          : '';
      }

      // Tarihli modda, kolon sayısını mutlak bir aday üzerinden en yakın izinli değere çeker
      function computeLayoutFromColsAbsolute(nSelected, colsCandidate) {
        var cfg = getLayoutConfig(nSelected);
        var allowed = getAllowedColsList(cfg);

        var cand = parseInt(colsCandidate, 10);
        if (!cand || cand < cfg.minCols) cand = cfg.minCols;
        if (cand > cfg.maxCols) cand = cfg.maxCols;

        var chosen = allowed[0];
        if (cand <= allowed[0]) {
          chosen = allowed[0];
        } else if (cand >= allowed[allowed.length - 1]) {
          chosen = allowed[allowed.length - 1];
        } else {
          for (var i = 0; i < allowed.length; i++) {
            if (allowed[i] >= cand) {
              chosen = allowed[i];
              break;
            }
          }
        }

        cols = chosen;
        rows = Math.ceil(n / cols);
      }

      // Mod'a göre n ve layout'u günceller, placeholder metnini de değiştirir
      function updateCount(skipLayout) {
        if (currentKind === 'count') {
          updateCountCountMode(skipLayout);
          document.getElementById('chain-name').placeholder =
            'Örnek: 167 videoluk Udemy kursumu bitireceğim!';
        } else {
          updateCountDatedMode(skipLayout);
          document.getElementById('chain-name').placeholder =
            'Örnek: Her gün 1 saat kitap okuyacağım!';
        }
      }

      // Kullanıcı tarihl i moddayken kolon inputunu değiştirince çağrılır
      function updateCols() {
        if (currentKind === 'count') {
          updateColsCountMode();
          return;
        }

        if (!n) return;

        var picked = readSelectedWeekdays();
        var nSelected = countSelectedWeekdays(picked);
        var cfg = getLayoutConfig(nSelected);
        var allowed = getAllowedColsList(cfg);

        var prev = typeof cols === 'number' && cols > 0 ? cols : allowed[0];

        var raw = readIntClamped(colsInput, {
          min: cfg.minCols,
          max: cfg.maxCols,
          step: 1,
          fallback: prev
        });

        // Kullanıcı kolon sayısını artırdı mı azalttı mı?
        var dir = 0;
        if (raw > prev) dir = +1;
        else if (raw < prev) dir = -1;

        var newCols;

        if (dir === 0) {
          // Aynı değere yazdıysa: en yakın izinli değere yuvarla
          if (raw <= allowed[0]) {
            newCols = allowed[0];
          } else if (raw >= allowed[allowed.length - 1]) {
            newCols = allowed[allowed.length - 1];
          } else {
            newCols = allowed[0];
            for (var i = 0; i < allowed.length; i++) {
              if (allowed[i] >= raw) {
                newCols = allowed[i];
                break;
              }
            }
          }
        } else {
          // Kullanıcı yukarı/ aşağı ok ile değiştiriyorsa: izinli listede bir ileri/bir geri git
          var idx = 0;
          for (var j = 0; j < allowed.length; j++) {
            if (allowed[j] <= prev) idx = j;
          }
          idx += dir;
          if (idx < 0) idx = 0;
          if (idx >= allowed.length) idx = allowed.length - 1;
          newCols = allowed[idx];
        }

        cols = newCols;
        rows = Math.ceil(n / cols);

        syncLayoutInputs(nSelected);
        showCount.textContent = String(n);
      }

      // Kullanıcı tarihl i moddayken satır inputunu değiştirince çağrılır
      function updateRows() {
        if (currentKind === 'count') {
          updateRowsCountMode();
          return;
        }

        if (!n) return;

        var picked = readSelectedWeekdays();
        var nSelected = countSelectedWeekdays(picked);
        var cfg = getLayoutConfig(nSelected);
        var allowed = getAllowedColsList(cfg);

        var prevRows = rows || 1;

        var rowsMin = 1;
        var rowsMax = Math.ceil(n / cfg.minCols);

        var raw = readIntClamped(rowsInput, {
          min: rowsMin,
          max: rowsMax,
          step: 1,
          fallback: prevRows
        });

        var dir = 0;
        if (raw > prevRows) dir = +1;
        else if (raw < prevRows) dir = -1;

        // allowed kolonlardan türetilen olası satır sayıları (aynı satır sayısına denk gelen tüm kolon kombinasyonları)
        var rowsOptions = [];
        for (var i = 0; i < allowed.length; i++) {
          var r = Math.ceil(n / allowed[i]);
          if (rowsOptions.indexOf(r) === -1) rowsOptions.push(r);
        }
        rowsOptions.sort(function (a, b) {
          return a - b;
        });

        var targetRows = prevRows;

        if (dir > 0) {
          // Satır sayısını yukarı çek → bir sonraki uygun rowsOptions
          for (var i1 = 0; i1 < rowsOptions.length; i1++) {
            if (rowsOptions[i1] > prevRows) {
              targetRows = rowsOptions[i1];
              break;
            }
          }
        } else if (dir < 0) {
          // Satır sayısını aşağı çek → bir önceki uygun rowsOptions
          for (var i2 = rowsOptions.length - 1; i2 >= 0; i2--) {
            if (rowsOptions[i2] < prevRows) {
              targetRows = rowsOptions[i2];
              break;
            }
          }
        } else {
          // Aynı değere yazıldıysa: en yakın rowsOptions elemanını seç
          var best = rowsOptions[0];
          var bestDiff = Math.abs(best - raw);
          for (var i4 = 1; i4 < rowsOptions.length; i4++) {
            var diff = Math.abs(rowsOptions[i4] - raw);
            if (diff < bestDiff) {
              bestDiff = diff;
              best = rowsOptions[i4];
            }
          }
          targetRows = best;
        }

        // Hedef satır sayısında, boş hücreyi minimize eden en iyi kolon kombinasyonunu bul
        var bestCols = null;
        var minEmpty = Infinity;

        for (var k = 0; k < allowed.length; k++) {
          var c = allowed[k];
          var rVal = Math.ceil(n / c);
          if (rVal === targetRows) {
            var empty = targetRows * c - n;
            if (empty < minEmpty) {
              minEmpty = empty;
              bestCols = c;
            }
          }
        }

        // Hiç tam eşleşme yoksa: hedef satır sayısına en yakın kolon sayısını seç
        if (bestCols == null) {
          var baseCols = Math.ceil(n / targetRows);
          var best2 = allowed[0];
          var bestDiff2 = Math.abs(best2 - baseCols);
          for (var j2 = 1; j2 < allowed.length; j2++) {
            var d2 = Math.abs(allowed[j2] - baseCols);
            if (d2 < bestDiff2) {
              bestDiff2 = d2;
              best2 = allowed[j2];
            }
          }
          bestCols = best2;
        }

        cols = bestCols;
        rows = targetRows;

        syncLayoutInputs(nSelected);
        showCount.textContent = String(n);
      }

      // Halka sayısı inputu (COUNT modu) değiştikçe n ve glow güncellenir
      if (chainCount) {
        chainCount.addEventListener('input', function () {
          if (currentKind === 'count') updateCountCountMode();
          updateGlowState();
        });
        chainCount.addEventListener('change', function () {
          if (currentKind === 'count') updateCountCountMode();
          updateGlowState();
        });
      }

      // Kolon inputu değişirse layout hesaplanır
      if (colsInput) {
        colsInput.addEventListener('input', updateCols);
        colsInput.addEventListener('change', updateCols);
      }

      // Satır inputu değişirse layout hesaplanır
      if (rowsInput) {
        rowsInput.addEventListener('input', updateRows);
        rowsInput.addEventListener('change', updateRows);
      }

      // Başlangıç tarihi değişince: sayıyı, notu ve glow'u güncelle
      if (startDate) {
        startDate.addEventListener('change', function () {
          lastTrigger = 'date';
          updateCount();
          updateAllSelectedNote();
          updateGlowState();
        });
        startDate.addEventListener('input', function () {
          lastTrigger = 'date';
          updateCount();
          updateAllSelectedNote();
          updateGlowState();
        });
      }

      // Bitiş tarihi değişince: sayıyı, notu ve glow'u güncelle
      if (endDate) {
        endDate.addEventListener('change', function () {
          lastTrigger = 'date';
          updateCount();
          updateAllSelectedNote();
          updateGlowState();
        });
        endDate.addEventListener('input', function () {
          lastTrigger = 'date';
          updateCount();
          updateAllSelectedNote();
          updateGlowState();
        });
      }

      // Haftanın 7 günü için checkbox listener'ları
      for (var wi = 0; wi < 7; wi++) {
        (function (idx) {
          var el = document.getElementById('wd' + idx);
          if (!el) return;
          el.addEventListener('change', function () {
            lastTrigger = 'weekday';
            updateAllSelectedNote();
            if (currentKind === 'dated') updateCountDatedMode();
            updateGlowState();
          });
        })(wi);
      }

      // Eski / eksik alanlara sahip zincir objelerini yeni formata normalize eder
      function normalizeChain(ch) {
        if (!ch.kind) {
          if (Array.isArray(ch.dates)) ch.kind = 'dated';
          else ch.kind = 'count';
        }

        if (ch.kind === 'dated') {
          if (!Array.isArray(ch.dates)) ch.dates = [];
          ch.total = ch.dates.length;

          // cfg yoksa varsayılan tek satır düzeni kur
          if (!ch.cfg) {
            var t = ch.total || 1;
            ch.cfg = { rows: 1, cols: t };
          }
          // picked yoksa eski weekdays veya tüm günleri seçili kabul et
          if (!ch.cfg.picked) {
            if (Array.isArray(ch.weekdays)) ch.cfg.picked = ch.weekdays.slice();
            else ch.cfg.picked = [true, true, true, true, true, true, true];
          }
          if (!ch.marks) ch.marks = {};
          return;
        }

        // COUNT türü zincir için normalize
        if (!ch.cfg) {
          var tot = (typeof ch.total === 'number' && ch.total > 0) ? ch.total : 1;
          ch.cfg = { rows: 1, cols: tot };
        }
        if (typeof ch.total !== 'number' || ch.total < 1) {
          if (Array.isArray(ch.parts) && ch.parts.length) {
            ch.total = ch.parts.length;
          } else {
            ch.total = (ch.cfg.rows || 1) * (ch.cfg.cols || 1);
          }
        }
        if (!Array.isArray(ch.parts) || ch.parts.length < ch.total) {
          ch.parts = [];
          for (var i = 0; i < ch.total; i++) {
            ch.parts.push(i + 1);
          }
        }
        if (!ch.marks) ch.marks = {};
      }

      // Hücre içine rastgele jitter’lı bir X işareti çizer (SVG)
      function make_Xmark() {
        var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.setAttribute('class', 'x-mark');
        svg.setAttribute('viewBox', '0 0 100 100');
        svg.setAttribute('preserveAspectRatio', 'none');
        svg.setAttribute('fill', 'none');

        function jitter() {
          return (Math.random() - 0.5) * 8;
        }

        // İki nokta arasında hafif eğrilikli bir bezier çizgisi tanımlar
        function curve(a, b) {
          var mid = [(a[0] + b[0]) / 2 + jitter(), (a[1] + b[1]) / 2 + jitter()];
          var c1 = [(a[0] * 2 + mid[0]) / 3 + jitter(), (a[1] * 2 + mid[1]) / 3 + jitter()];
          var c2 = [(b[0] * 2 + mid[0]) / 3 + jitter(), (b[1] * 2 + mid[1]) / 3 + jitter()];
          return (
            'M ' +
            a[0] +
            ',' +
            a[1] +
            ' C ' +
            c1[0] +
            ',' +
            c1[1] +
            ' ' +
            c2[0] +
            ',' +
            c2[1] +
            ' ' +
            b[0] +
            ',' +
            b[1]
          );
        }

        var p1 = document.createElementNS(svg.namespaceURI, 'path');
        p1.setAttribute('d', curve([12, 12], [88, 88]));
        p1.setAttribute('stroke-linecap', 'round');

        var p2 = document.createElementNS(svg.namespaceURI, 'path');
        p2.setAttribute('d', curve([88, 12], [12, 88]));
        p2.setAttribute('stroke-linecap', 'round');

        svg.appendChild(p1);
        svg.appendChild(p2);
        return svg;
      }

      // Hücreye tıklanınca X'i toggle eder ve store’a kaydeder
      function onCellClick(ev) {
        var td = ev.currentTarget;
        var id = td.dataset.id;
        var idx = td.dataset.idx;

        var s = getStore();
        if (!s.items) s.items = {};
        var ch = s.items[id];

        var existing = td.querySelector('svg.x-mark');

        // Teorik: Zincir store’da yoksa sadece görsel toggle yapar (kalıcı olmaz)
        if (!ch) {
          if (existing) existing.remove();
          else td.appendChild(make_Xmark());
          return;
        }

        if (!ch.marks) ch.marks = {};

        // Varsa kaldır, yoksa ekle
        if (existing) {
          existing.remove();
          delete ch.marks[idx];
        } else {
          ch.marks[idx] = 1;
          td.appendChild(make_Xmark());
        }
        setStore(s);
      }

      // COUNT türü zincir için tablo oluşturur
      function buildTableCount(ch) {
        normalizeChain(ch);

        var table = document.createElement('table');
        var cols = ch.cfg.cols;
        var rows = ch.cfg.rows;
        var N = ch.total;

        for (var r = 0; r < rows; r++) {
          var tr = document.createElement('tr');

          for (var c2 = 0; c2 < cols; c2++) {
            var td = document.createElement('td');


            var idx = r * cols + c2;

            if (idx < N) {


              td.textContent = String(idx + 1);


              td.dataset.id = ch.id;
              td.dataset.idx = String(idx);
              td.title = String(idx + 1) + '. halka';

              // Daha önce işaretlendiyse X'i tekrar çiz
              if (ch.marks && ch.marks[idx]) {
                td.appendChild(make_Xmark());
              }

              td.addEventListener('click', onCellClick);
            } else {
              // Boş hücreler (satır sonu dolsun diye)
              td.classList.add('empty-cell');
            }

            tr.appendChild(td);
          }

          table.appendChild(tr);
        }

        return table;
      }

      // TARİHLİ tür zincir için tablo oluşturur
      function buildTableDated(ch) {
        normalizeChain(ch);

        var table = document.createElement('table');
        var cols = ch.cfg.cols;
        var rows = ch.cfg.rows;
        var N = ch.dates.length;

        var picked = ch.cfg.picked || [true, true, true, true, true, true, true];

        // Seçili günlerin index ve isimlerini toplar
        var selectedDayIndices = [];
        var selectedDayNames = [];
        for (var di = 0; di < 7; di++) {
          if (picked[di]) {
            selectedDayIndices.push(di);
            selectedDayNames.push(DAY_NAMES[di]);
          }
        }

        var k = selectedDayIndices.length;
        var orderedDayNames = selectedDayNames.slice();
        if (N > 0 && k > 0) {
          // İlk tarihin haftaiçi index'ine göre başlığın gün sırasını rotasyonla hizalar
          var firstDate = new Date(ch.dates[0] + 'T00:00:00');
          var wd0 = (firstDate.getDay() + 6) % 7;
          var pos = -1;
          for (var t = 0; t < selectedDayIndices.length; t++) {
            if (selectedDayIndices[t] === wd0) {
              pos = t;
              break;
            }
          }
          if (pos !== -1) {
            orderedDayNames = [];
            for (var ii = 0; ii < k; ii++) {
              orderedDayNames.push(selectedDayNames[(pos + ii) % k]);
            }
          }
        }

        // İlk satır: yıl + sütun başlıklarında seçili gün isimleri
        var tr1 = document.createElement('tr');
        var pad = document.createElement('th');

        var firstYear = N > 0 ? new Date(ch.dates[0] + 'T00:00:00').getFullYear() : '';
        pad.textContent = firstYear;
        tr1.appendChild(pad);

        for (var c = 0; c < cols; c++) {
          var th = document.createElement('th');
          th.textContent = orderedDayNames.length ? orderedDayNames[c % orderedDayNames.length] : '';
          tr1.appendChild(th);
        }

        table.appendChild(tr1);

        // Diğer satırlar: sol tarafta ay isimleri, hücrelerde gün numaraları
        for (var r = 0; r < rows; r++) {
          var tr = document.createElement('tr');
          var rh = document.createElement('th');
          var startIdx = r * cols;
          var endIdx = Math.min(startIdx + cols, N);
          var labels = [];

          // Satırda yer alan ay adlarını (benzersiz) bul
          for (var i = startIdx; i < endIdx; i++) {
            var iso = ch.dates[i];
            if (!iso) continue;
            var nm = new Date(iso + 'T00:00:00').toLocaleDateString('tr-TR', { month: 'long' });
            if (labels.indexOf(nm) === -1) labels.push(nm);
          }
          rh.textContent = labels.length ? labels.join(', ') : '';
          tr.appendChild(rh);

          for (var c2 = 0; c2 < cols; c2++) {
            var td = document.createElement('td');


            var idx = r * cols + c2;
            if (idx < N && ch.dates[idx]) {
              var dd = new Date(ch.dates[idx] + 'T00:00:00');

              td.textContent = String(dd.getDate());

              // Tooltip olarak tam TR tarih formatı
              td.title = dd.toLocaleDateString('tr-TR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
              });

              td.dataset.id = ch.id;
              td.dataset.idx = String(idx);

              if (ch.marks && ch.marks[idx]) {
                td.appendChild(make_Xmark());
              }

              td.addEventListener('click', onCellClick);

              // Yıl / ay geçişlerinde görsel ayraç sınıfları
              if (idx + 1 < N && ch.dates[idx + 1]) {
                var nextDate = new Date(ch.dates[idx + 1] + 'T00:00:00');
                if (nextDate.getFullYear() !== dd.getFullYear()) {
                  td.classList.add('year-break-right');
                } else if (nextDate.getMonth() !== dd.getMonth()) {
                  td.classList.add('month-break-right');
                }
              }
              if (idx > 0) {
                var prevDate = new Date(ch.dates[idx - 1] + 'T00:00:00');
                if (prevDate.getFullYear() !== dd.getFullYear()) {
                  td.classList.add('year-break-left');
                } else if (prevDate.getMonth() !== dd.getMonth()) {
                  td.classList.add('month-break-left');
                }
              }
            } else {
              td.classList.add('empty-cell');
            }

            tr.appendChild(td);
          }

          table.appendChild(tr);
        }

        return table;
      }

      // Zincirin türüne göre doğru tablo oluşturucuya yönlendirir
      function buildTable(ch) {
        if (ch.kind === 'dated') return buildTableDated(ch);
        return buildTableCount(ch);

      }
      // ----------------------------
      // Görünüme göre grid üretir
      // ----------------------------
      function buildGrid(ch, wrapEl) {
        if (viewMode === 'snake') return buildSnake(ch, wrapEl);
        return buildTable(ch);
      }

      // ----------------------------
      // YILAN: ortak üretici
      // - wrapEl: grid-wrap (ölçüm için)
      // ----------------------------
      function buildSnake(ch, wrapEl) {
        normalizeChain(ch);

        var snake = document.createElement('div');
        snake.className = 'snake-container';

        // ring-size: var(--cell-size) ile aynı olsun
        var rootStyle = getComputedStyle(document.documentElement);
        var size = parseFloat(rootStyle.getPropertyValue('--cell-size') * 1.25) || 80;

        // gap: CSS'teki --snake-gap
        var gap = parseFloat(getComputedStyle(snake).getPropertyValue('--snake-gap')) || 0;

        var cellW = (function measureRingCellWidth() {
          try {
            var probeWrap = document.createElement('div');
            probeWrap.className = 'chain';
            probeWrap.style.position = 'absolute';
            probeWrap.style.visibility = 'hidden';
            probeWrap.style.pointerEvents = 'none';
            probeWrap.style.left = '-10000px';
            probeWrap.style.top = '-10000px';

            var probe = document.createElement('div');
            probe.className = 'circle-cell';
            probeWrap.appendChild(probe);
            document.body.appendChild(probeWrap);

            var w = probe.getBoundingClientRect().width;
            probeWrap.remove();
            return w || (size * 1.25);
          } catch (e) {
            return size * 1.25;
          }
        })();

        function computeCols(w) {
          return Math.max(1, Math.floor((w + gap) / (cellW + gap)));
        }


        function fullRowWidth(cols) {
          return cols * cellW + (cols - 1) * gap;
        }

        function makeCell(idx) {
          var el = document.createElement('div');
          el.className = 'circle-cell';

          el.dataset.id = ch.id;
          el.dataset.idx = String(idx);


          function addMonthLabel(text) {
            if (!text) return;
            var lab = document.createElement('div');
            lab.className = 'month-label';
            lab.textContent = text;
            el.appendChild(lab);
          }

          // COUNT: sayısal değer
          if (ch.kind !== 'dated') {
            el.textContent = String(idx + 1);
            // hover: "3. halka" gibi
            el.title = String(idx + 1) + '. halka';
          } else {
            // DATED: hücrede sadece gün (örn. 14) görünsün; hover'da tam tarih
            var dd = new Date(ch.dates[idx] + 'T00:00:00');

            // hücre içeriği: sadece gün
            el.textContent = String(dd.getDate());

            // hover: "14 Aralık 2024 Pazartesi" (tam tarih)
            el.title = dd.toLocaleDateString('tr-TR', {
              weekday: 'long',
              year: 'numeric',
              month: 'long',
              day: 'numeric',
            });

            // Yıl / ay geçişlerinde görsel ayraç sınıfları + ay etiketi
            var isMonthStart = (idx === 0);
            var includeYear = (idx === 0);

            if (idx > 0 && ch.dates[idx - 1]) {
              var prevDate = new Date(ch.dates[idx - 1] + 'T00:00:00');
              if (prevDate.getFullYear() !== dd.getFullYear()) {
                el.classList.add('year-break-left');
                isMonthStart = true;
                includeYear = true;
              } else if (prevDate.getMonth() !== dd.getMonth()) {
                el.classList.add('month-break-left');
                isMonthStart = true;
              }
            }

            if (isMonthStart) {
              var monthName = dd.toLocaleDateString('tr-TR', { month: 'long' });
              addMonthLabel(includeYear ? (monthName + ' ' + dd.getFullYear()) : monthName);
            }
          }

          if (ch.marks && ch.marks[idx]) {
            el.appendChild(make_Xmark());
          }

          el.addEventListener('click', onCellClick);
          return el;
        }

        function renderSnake() {
          snake.innerHTML = '';

          var total = (ch.kind === 'dated' && Array.isArray(ch.dates)) ? ch.dates.length : ch.total;
          total = total || 0;

          var w = wrapEl ? wrapEl.clientWidth : snake.parentElement.clientWidth;
          var cols = computeCols(w);

          // GAP=0 kopma fix: snake genişliğini satır genişliğine kilitle
          snake.style.width = Math.min(fullRowWidth(cols), w) + 'px';


          var remaining = total;
          var leftToRight = true;
          var idx = 0;



          while (remaining > 0) {
            // DOLU SATIR
            var count = Math.min(cols, remaining);
            var row = document.createElement('div');
            row.className = 'snake-row';
            row.style.flexDirection = leftToRight ? 'row' : 'row-reverse';

            for (var i = 0; i < count; i++) {
              row.appendChild(makeCell(idx++));
            }

            snake.appendChild(row);
            remaining -= count;
            if (remaining <= 0) break;

            // TEKLİ SATIR (bir önceki satırın bittiği uçta)
            var srow = document.createElement('div');
            srow.className = 'snake-row';
            srow.style.justifyContent = leftToRight ? 'flex-end' : 'flex-start';
            srow.appendChild(makeCell(idx++));
            snake.appendChild(srow);
            remaining -= 1;

            leftToRight = !leftToRight;
          }
        }

        renderSnake();

        // responsive: wrap genişliği değişince yeniden çiz
        if (wrapEl && window.ResizeObserver) {
          var ro = new ResizeObserver(renderSnake);
          ro.observe(wrapEl);
        } else {
          window.addEventListener('resize', renderSnake);
        }

        return snake;
      }

      // Üstteki scroll bar ile alttaki grid scroll'unu senkronize eder
      function setupGridScrollSync(outer) {
        var wrap = outer.querySelector('.grid-wrap');
        var bottomScroll = outer.querySelector('.grid-scroll-bottom');
        var topInner = outer.querySelector('.grid-scroll-inner');

        if (!wrap || !bottomScroll || !topInner) return;

        function syncWidth() {
          topInner.style.width = wrap.scrollWidth + 'px';
        }
        syncWidth();

        wrap.addEventListener('scroll', function () {
          bottomScroll.scrollLeft = wrap.scrollLeft;
        });
        bottomScroll.addEventListener('scroll', function () {
          wrap.scrollLeft = bottomScroll.scrollLeft;
        });

        // Grid genişliği değişirse (responsive) üst bar genişliğini de güncelle
        if (window.ResizeObserver) {
          var ro = new ResizeObserver(syncWidth);
          ro.observe(wrap);
        } else {
          window.addEventListener('resize', syncWidth);
        }
      }

      // Zinciri store'dan siler ve ekranı yeniden çizer
      function delChain(id) {
        var s = getStore();
        if (!s.items || !s.items[id]) return;

        delete s.items[id];
        s.order = s.order.filter(function (x) {
          return x !== id;
        });

        setStore(s);
        renderAll();
      }

      // Tek bir zincir için kart (başlık + grid) oluşturur
      function renderCard(ch) {
        normalizeChain(ch);

        var card = document.createElement('section');
        card.className = 'chain';
        card.dataset.id = ch.id;

        var head = document.createElement('div');
        head.className = 'chain-head';

        var left = document.createElement('div');

        var title = document.createElement('div');
        title.className = 'chain-title';
        title.textContent = ch.name || 'Zincir';
        left.appendChild(title);

        var info = document.createElement('div');
        info.className = 'chain-info';

        function addInfoLine(text) {
          var line = document.createElement('div');
          line.textContent = text;
          info.appendChild(line);
        }

        // Tarihli zincirde ekstra tarih aralığı bilgisi göster
        if (ch.kind === 'dated' && Array.isArray(ch.dates) && ch.dates.length) {
          var first = new Date(ch.dates[0] + 'T00:00:00');
          var last = new Date(ch.dates[ch.dates.length - 1] + 'T00:00:00');
          var rangeText = fmtTR(first) + ' – ' + fmtTR(last);

          addInfoLine('Toplam halka: ' + ch.dates.length);

          addInfoLine('Tarih aralığı: ' + rangeText);

          if (ch.created) {
            addInfoLine('Oluşturulma tarihi: ' + ch.created);
          }
        }

        else {
          // COUNT zincir: sadece toplam halka + oluşturulma tarihi
          var tot = (typeof ch.total === 'number' && ch.total > 0)
            ? ch.total
            : (Array.isArray(ch.parts) ? ch.parts.length : 0);

          addInfoLine('Toplam halka: ' + tot);

          if (ch.created) {
            addInfoLine('Oluşturulma tarihi: ' + ch.created);
          }
        }

        left.appendChild(info);
        head.appendChild(left);

        var actions = document.createElement('div');

        var delBtn = document.createElement('button');
        delBtn.type = 'button';
        delBtn.title = "Bu sekmedeki zinciri siler";
        delBtn.id = "btn-delete";
        delBtn.innerHTML = `<i class="fa-solid fa-trash"></i>Zinciri<span data-line-break>sil</span>`;

        delBtn.addEventListener('click', function () {
          if (confirm('Bu zinciri silmek istiyor musunuz?')) {
            delChain(ch.id);
          }
        });

        actions.appendChild(delBtn);
        head.appendChild(actions);
        card.appendChild(head);


        if (viewMode === 'table') {
          var outer = document.createElement('div');
          outer.className = 'table-container';

          var bottomScroll = document.createElement('div');
          bottomScroll.className = 'grid-scroll-bottom';

          var topInner = document.createElement('div');
          topInner.className = 'grid-scroll-inner';
          bottomScroll.appendChild(topInner);

          var wrap = document.createElement('div');
          wrap.className = 'grid-wrap';

          wrap.appendChild(buildGrid(ch, wrap));

          outer.appendChild(bottomScroll);
          outer.appendChild(wrap);
          card.appendChild(outer);

          setupGridScrollSync(outer);
        } else {
          // snake: tablo wrapper'larını tamamen dışla
          card.appendChild(buildGrid(ch, card));
        }

        return card;

      }

      // Aktif zincir sekmesini ve kartını seçer, gerekirse scroll yapar
      function setActiveChain(id, opts) {
        opts = opts || {};
        activeChainId = id;

        var tabs = chainList.querySelectorAll('.chain-tab');
        for (var i = 0; i < tabs.length; i++) {
          var tab = tabs[i];
          if (tab.dataset.id === id) {
            tab.classList.add('active');
          } else {
            tab.classList.remove('active');
          }
        }

        var cards = chainList.querySelectorAll('.chain');
        for (var j = 0; j < cards.length; j++) {
          var card = cards[j];
          if (card.dataset.id === id) {
            card.style.display = '';

            if (!opts.noScroll) {
              var chainTabs = chainList.querySelector('.tab-box');
              if (chainTabs) {
                var tabsHeight = chainTabs.getBoundingClientRect().height || 0;
                var cardTop = card.getBoundingClientRect().top + window.pageYOffset;
                var offset = tabsHeight + 10;

                window.scrollTo({
                  top: cardTop - offset,
                  behavior: 'smooth'
                });
              } else {
                card.scrollIntoView({
                  behavior: 'smooth',
                  block: 'start'
                });
              }
            }

          } else {
            card.style.display = 'none';
          }
        }
      }

      // Tüm zincirleri store'dan okuyup sekmeleri ve kartları yeniden çizer
      function renderAll() {
        var s = getStore();
        chainList.innerHTML = '';

        if (!s.order.length) {
          activeChainId = null;
          return;
        }

        var tabsBar = document.createElement('div');
        tabsBar.className = 'tab-box';

        var container = document.createElement('div');

        var firstId = null;

        for (var i = 0; i < s.order.length; i++) {
          var id = s.order[i];
          var ch = s.items[id];
          if (!ch) continue;

          normalizeChain(ch);
          if (!firstId) firstId = id;

          var tab = document.createElement('button');
          tab.type = 'button';
          tab.className = 'chain-tab';
          tab.dataset.id = id;
          tab.textContent = 'Zincir ' + (i + 1);

          (function (cid) {
            tab.addEventListener('click', function () {
              setActiveChain(cid);
            });
          })(id);

          tabsBar.appendChild(tab);

          var card = renderCard(ch);
          card.style.display = 'none';
          container.appendChild(card);
        }

        chainList.appendChild(tabsBar);
        chainList.appendChild(container);

        if (!activeChainId || !s.items[activeChainId]) {
          activeChainId = firstId;
        }
        setActiveChain(activeChainId, { noScroll: true });
      }

      // Zincir oluşturulmadan önce kullanıcı girdilerini kontrol eder (isim, tarih, gün, sayı)
      function validateBeforeCreate() {
        var mode = currentKind = getSelectedMode();
        var nameVal = (chainName && chainName.value ? chainName.value : '').trim();

        if (nameError) {
          nameError.style.display = 'none';
          nameError.textContent = '';
        }
        if (dateErrors) {
          dateErrors.style.display = 'none';
          dateErrors.textContent = '';
        }
        if (weekdaysError) {
          weekdaysError.style.display = 'none';
          weekdaysError.textContent = '';
        }
        if (chainName) {
          chainName.classList.remove('input-error');
        }
        if (chainCount) {
          chainCount.classList.remove('input-error');
        }

        var hasError = false;
        var primaryAlertMessage = null;

        // İsim boşsa
        if (!nameVal) {
          hasError = true;
          if (nameError) {
            nameError.textContent = 'Lütfen zincir adını girin.';
            nameError.style.display = 'inline-block';
            scheduleErrorAutoHide();
          }
          if (chainName) {
            chainName.classList.add('input-error');
            chainName.focus();
          }
          if (!primaryAlertMessage) {
            primaryAlertMessage = 'Lütfen zincir adını girin.';
          }
        }

        if (mode === 'dated') {
          var sVal = startDate && startDate.value;
          var eVal = endDate && endDate.value;
          var picked = readSelectedWeekdays();
          var nSelected = countSelectedWeekdays(picked);

          var hasMissingDates = false;
          var hasOrderError = false;

          if (!sVal || !eVal) {
            hasError = true;
            hasMissingDates = true;
            if (!primaryAlertMessage) {
              primaryAlertMessage = 'Lütfen başlangıç ve bitiş tarihlerini girin.';
            }
          }

          var s, e;
          if (!hasMissingDates) {
            s = new Date(sVal + 'T00:00:00');
            e = new Date(eVal + 'T00:00:00');

            if (e < s) {
              hasError = true;
              hasOrderError = true;
              if (dateErrors) {
                dateErrors.textContent = 'Bitiş tarihi, başlangıçtan önce olamaz!';
                dateErrors.style.display = 'inline-block';
                scheduleErrorAutoHide();
              }
              if (!primaryAlertMessage) {
                primaryAlertMessage = 'Bitiş tarihi, başlangıçtan önce olamaz!';
              }
            }
          }

          if (nSelected === 0) {
            hasError = true;
            if (weekdaysError) {
              weekdaysError.textContent = 'Lütfen en az bir gün seçin.';
              weekdaysError.style.display = 'inline-block';
              scheduleErrorAutoHide();
            }
            if (!primaryAlertMessage) {
              primaryAlertMessage = 'Lütfen en az bir gün seçin.';
            }
          }

          if (!hasMissingDates && !hasOrderError && nSelected > 0) {
            var allDays = daysBetween(s, e);
            var filteredDates = filterByWeekdays(allDays, picked);
            var total = filteredDates.length;

            if (total > MAX_RINGS) {
              hasError = true;
              if (dateErrors) {
                dateErrors.textContent =
                  'Toplam halka sayısı ' + MAX_RINGS +
                  ' sınırını aşıyor (Şu an: ' + total +
                  '). Lütfen tarih aralığını veya seçili günleri daraltın.';
                dateErrors.style.display = 'inline-block';
                scheduleErrorAutoHide();
              }
              if (!primaryAlertMessage) {
                primaryAlertMessage =
                  'Toplam halka sayısı ' + MAX_RINGS +
                  ' sınırını aşıyor (Şu an: ' + total +
                  '). Lütfen tarih aralığını veya seçili günleri daraltın.';
              }
            }

            if (total <= 0) {
              hasError = true;
              if (!primaryAlertMessage) {
                primaryAlertMessage =
                  'Seçtiğiniz tarih ve gün kombinasyonunda hiç halka oluşmuyor. Lütfen aralığı veya günleri değiştirin.';
              }
            }
          }

        } else {
          var totalCount = parseInt(chainCount && chainCount.value, 10) || 0;
          if (!totalCount || totalCount < 1 || totalCount > MAX_RINGS) {
            hasError = true;
            if (chainCount) {
              chainCount.classList.add('input-error');
              chainCount.focus();
            }
            if (!primaryAlertMessage) {
              primaryAlertMessage =
                'Lütfen 1 ile ' + MAX_RINGS + ' arasında olan geçerli bir halka sayısı girin.';
            }
          }
        }

        if (hasError) {
          if (primaryAlertMessage) {
            alert(primaryAlertMessage);
          }
          return false;
        }
        return true;
      }

      // "Zincir Ekle" butonunun click handler'ı
      if (btnAddChain) {
        btnAddChain.addEventListener('click', function () {
          if (nameError) {
            nameError.style.display = 'none';
            nameError.textContent = '';
          }
          if (chainName) {
            chainName.classList.remove('input-error');
          }
          if (dateErrors) {
            dateErrors.style.display = 'none';
            dateErrors.textContent = '';
          }

          hasValidationTriggered = true;
          updateGlowState();

          if (!validateBeforeCreate()) {
            updateGlowState();
            return;
          }

          // skipLayout = true → sayıları güncelle, layout'u elle tut (inputtan)
          updateCount(true);

          if (!n || n < 1) {
            if (currentKind === 'dated') {
              alert('Lütfen geçerli bir tarih aralığı girin veya en az bir gün seçin.');
            } else {
              alert('Lütfen 1 ile ' + MAX_RINGS + ' arasında geçerli bir halka sayısı girin.');
            }
            updateGlowState();
            return;
          }

          currentKind = getSelectedMode();

          var colsVal = parseInt(colsInput && colsInput.value, 10) || 1;
          var rowsVal = parseInt(rowsInput && rowsInput.value, 10) || 1;
          if (colsVal < 1) colsVal = 1;
          if (rowsVal < 1) rowsVal = 1;
          if (rowsVal * colsVal < n) {
            rowsVal = Math.ceil(n / colsVal);
          }

          var nameVal = (chainName && chainName.value ? chainName.value : '').trim();
          var ch;

          if (currentKind === 'dated') {
            var sVal = startDate && startDate.value;
            var eVal = endDate && endDate.value;
            var picked = readSelectedWeekdays();

            // Tarihli zincir objesini oluştur
            ch = {
              id: rid(),
              kind: 'dated',
              name: nameVal,
              cfg: {
                rows: rowsVal,
                cols: colsVal,
                start: sVal,
                end: eVal,
                picked: picked
              },
              dates: currentDates.slice(),
              startDate: sVal,
              endDate: eVal,
              weekdays: picked,
              marks: {},
              created: formatNowLocal_DDMMYYYY_HHMM_GMT(),
            };
          } else {
            var total = n;
            if (total > MAX_RINGS) total = MAX_RINGS;
            var parts = [];
            for (var i = 0; i < total; i++) {
              parts.push(i + 1);
            }
            // Sayıya dayalı zincir objesi
            ch = {
              id: rid(),
              kind: 'count',
              name: nameVal,
              cfg: { rows: rowsVal, cols: colsVal },
              total: total,
              parts: parts,
              marks: {},
              created: formatNowLocal_DDMMYYYY_HHMM_GMT(),
            };
          }

          var st = getStore();
          if (!st.items) st.items = {};
          if (!Array.isArray(st.order)) st.order = [];
          st.items[ch.id] = ch;
          st.order.push(ch.id);
          setStore(st);

          activeChainId = ch.id;
          renderAll();
          setActiveChain(ch.id);

          if (backupError) {
            backupError.style.display = 'none';
            backupError.textContent = '';
          }
          if (chainName) chainName.value = '';
        });
      }

      // Yedek indir butonu
      if (btnBackupDownload) {
        btnBackupDownload.addEventListener('click', function () {
          var s = getStore();
          var hasChain = s && Array.isArray(s.order) && s.order.length > 0;

          // Tema var mı?
          // - overrides varsa mutlaka var
          // - overrides olmasa bile base varsayılan değilse var (istenen davranış)
          var baseTheme = (localStorage.getItem(THEME_BASE_KEY) || 'default').trim() || 'default';
          var themeCss = (localStorage.getItem(STORAGE_KEY) || '').trim();
          var hasTheme = themeCss.length > 0 || baseTheme !== 'default';

          // Ne zincir var ne tema -> indirme yok
          if (!hasChain && !hasTheme) {
            backupError.textContent = 'Yedeği alınacak zincir veya tema bulunamadı.';
            backupError.style.display = 'inline-block';
            scheduleErrorAutoHide();
            alert('İndirilecek zincir / tema yok.');
            return;
          }

          // Buradan sonrası: payload üretip indirme (zincir yoksa bile tema için indirebilecek)
          var payload = JSON.parse(JSON.stringify(s || { order: [], items: {} }));

          if (hasTheme) {
            payload.theme = { base: baseTheme, overridesCss: themeCss };
          }

          var dataStr = JSON.stringify(payload, null, 2);

          var blob = new Blob([dataStr], { type: 'application/json' });
          var url = URL.createObjectURL(blob);
          var a = document.createElement('a');
          a.href = url;
          a.download = 'Yeni Zincirlerim.json';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        });
      }

      // Yedekten yükleme butonu + file inputu
      if (btnLoadFile && fileInput) {
        btnLoadFile.addEventListener('click', function () {
          fileInput.value = '';
          fileInput.click();
        });

        fileInput.addEventListener('change', function (ev) {
          var file = ev.target.files && ev.target.files[0];
          if (!file) return;

          var reader = new FileReader();
          reader.onload = function (e) {
            var imported;

            try {
              imported = JSON.parse(e.target.result);
            } catch (err) {
              alert('Yüklemeye çalıştığınız dosyanın yapısı JSON formatında değil veya bozuk.');
              return;
            }

            var v = validateImportedStore(imported);
            if (!v.ok) {
              // Hata nedenine göre kullanıcıya daha anlamlı mesaj göster
              switch (v.reason) {
                case 'missingItems':
                  alert('Dosya yapısı beklenen formatta değil (items alanı bulunamadı).');
                  break;

                case 'invalidChainObject':
                  alert('Bazı zincir kayıtları beklenen formatta değil (geçersiz zincir nesnesi).');
                  break;

                case 'missingId':
                  alert('Bazı zincir kayıtlarında kimlik (id) bilgisi eksik veya geçersiz.');
                  break;

                case 'invalidDates':
                  alert('Tarihli zincirlerden en az birinde geçersiz veya boş tarih listesi var.');
                  break;

                case 'missingTotal':
                  alert('Bazı tarihsiz zincirlerde halka sayısı bilgisi (total / parts) eksik.');
                  break;

                case 'invalidKind':
                  alert('Beklenmeyen zincir türü (kind) tespit edildi. Dosya formatı desteklenmiyor.');
                  break;

                case 'invalidTotal':
                  alert('Zincirlerden birinin halka sayısı izin verilen sınırların dışında.');
                  break;

                case 'noChainorTheme':
                  alert('Dosya geçerli ancak içinde zincir veya tema kaydı bulunamadı.');
                  break;

                case 'notObject':
                default:
                  alert('Dosya formatı beklenen genel yapıda değil.');
                  break;
              }
              return;
            }

            // Mevcut store ile imported store'u birleştir
            var current = getStore();
            var merged = mergeStores(current, imported);
            setStore(merged);
            // Tema varsa uygula (backup içinden)
            try {
              // Yeni format: { base, overridesCss }
              // Eski format: { css }
              var t = imported && imported.theme ? imported.theme : null;
              var importedBase = t && t.base ? String(t.base).trim() : '';
              var importedOverrides = t && t.overridesCss != null ? String(t.overridesCss).trim() : '';
              var legacyCss = t && t.css ? String(t.css).trim() : '';

              if (legacyCss && !importedBase && !importedOverrides) {
                // legacy: sadece css
                importedOverrides = legacyCss;
              }

              if (importedBase || importedOverrides) {
                applyBaseTheme(importedBase || 'default');
                localStorage.setItem(STORAGE_KEY, importedOverrides);
                themeStyleEl.textContent = importedOverrides;
                themeMap = parseCssText(importedOverrides);
                clearPreview(); // varsa preview çakışmasını temizle
              }
            } catch (e2) {
              // tema hatası zincir yüklemeyi bozmasın
            }

            renderAll();

            if (backupError) {
              backupError.style.display = 'none';
              backupError.textContent = '';
            }

            alert('Yedek dosyası başarıyla yüklendi.');
          };

          reader.readAsText(file, 'utf-8');
        });
      }

      // Formu varsayılan haline döndürür
      function resetCurrentForm() {
        if (errorHideTimeout) {
          clearTimeout(errorHideTimeout);
          errorHideTimeout = null;
        }

        if (nameError) {
          nameError.style.display = 'none';
          nameError.textContent = '';
        }
        if (dateErrors) {
          dateErrors.style.display = 'none';
          dateErrors.textContent = '';
        }
        if (weekdaysError) {
          weekdaysError.style.display = 'none';
          weekdaysError.textContent = '';
        }
        if (backupError) {
          backupError.style.display = 'none';
          backupError.textContent = '';
        }

        if (chainName) { chainName.classList.remove('input-error'); chainName.value = ''; }
        if (startDate) startDate.classList.remove('input-error');
        if (endDate) endDate.classList.remove('input-error');
        if (weekdays) weekdays.classList.remove('input-error');
        if (chainCount) { chainCount.classList.remove('input-error'); chainCount.value = '37'; }

        hasValidationTriggered = false;
        updateGlowState();

        // Modu tekrar "dated" yap
        if (modeRadios && modeRadios.length) {
          for (var i = 0; i < modeRadios.length; i++) {
            modeRadios[i].checked = (modeRadios[i].value === 'dated');
          }
        }
        currentKind = 'dated';
        syncModeUI();

        // Varsayılan tarih aralığı: bugün + 364 gün = yani 1 yıl
        if (startDate && endDate) {
          var today = new Date();
          startDate.value = toISO(today);
          var later = new Date(today);
          later.setDate(later.getDate() + 364);
          endDate.value = toISO(later);
        }

        // Tüm günleri tekrar seçili hale getir
        for (var d = 0; d < 7; d++) {
          var cb = document.getElementById('wd' + d);
          if (cb) cb.checked = true;
        }


        updateAllSelectedNote();
        updateCount();
        updateGlowState();
      }

      // "Formu Sıfırla" butonu
      if (btnReset) {
        btnReset.addEventListener('click', resetCurrentForm);
      }

      if (btnView) {
        var icon = btnView.querySelector('.knob i'); // knob içindeki <i>

        btnView.addEventListener('click', function () {
          // Görünüm (Tablo / Yılan) toggle
          viewMode = (viewMode === 'table') ? 'snake' : 'table';

          // UI: çember kaydır + ikon değiştir
          btnView.classList.toggle('alt', viewMode === 'snake'); // tablo modunda sağda olsun istiyorsan
          if (icon) {
            icon.classList.toggle('fa-worm', viewMode === 'snake');
            icon.classList.toggle('fa-table-cells', viewMode === 'table');
            icon.style.transform = 'rotate(270deg)'; // ikisine de uygula (tablo zaten simetrik)
          }
          renderAll();
        });
      }

      (function () {
        var busy = false;
        var lastKey = "";

        function rerenderIfSnake() {
          if (viewMode !== 'snake') return;
          if (busy) return;

          var key = window.innerWidth + "x" + window.innerHeight;
          if (key === lastKey) return;
          lastKey = key;

          busy = true;
          requestAnimationFrame(function () {
            renderAll();
            setTimeout(function () { busy = false; }, 300);
          });
        }

        window.addEventListener('orientationchange', rerenderIfSnake, { passive: true });
        window.addEventListener('resize', rerenderIfSnake, { passive: true });

        if (window.visualViewport) {
          window.visualViewport.addEventListener('resize', rerenderIfSnake, { passive: true });
        }
      })();


      // Mobil/desktop'da üst paneli gizle/göster
      if (toggleMenu && mainFrame) {
        toggleMenu.addEventListener('click', function () {
          var collapsed = mainFrame.classList.toggle('collapsed');
          toggleMenu.textContent = collapsed ? '▼' : '▲';
        });

      }

      // Sayfa yüklenirken başlangıç ayarları
      currentKind = getSelectedMode();
      syncModeUI();
      updateAllSelectedNote();

      // Başlangıç tarihi: bugün, bitiş: +36 gün
      if (startDate && endDate) {
        var today = new Date();
        startDate.value = toISO(today);
        var later = new Date(today);
        later.setDate(later.getDate() + 364);
        endDate.value = toISO(later);
      }

      // İlk sayım ve var olan zincirleri çiz
      updateCount();
      renderAll();

    })();
  </script>
  <div class="unsupported-display"> Görüntü <br> desteklenmiyor! <br><br>
    Görüntü <br> desteklenmiyor! <br><br> Görüntü <br> desteklenmiyor! <br><br>
    Görüntü <br> desteklenmiyor! <br><br> Görüntü <br> desteklenmiyor! <br><br>
    Görüntü <br> desteklenmiyor!
  </div>
</body>

</html>